// ## 
// ## WEM4 8 Scripting
// ## Kahdeksas
// ## 
// ## Script kahdeksas_sydÃ¤n
// ## 
// ## Release 1.12.2011
// ## 
// ## created by WitchDoctor


#pragma compile


// ABSCHNITT : Fz erstellen 
//
// Winterberger für Em4 by WitchDoc
// Fahrzeuge erstellen und besetzen
// 
// Rotation function by bass-ti
//
//  Revision:
//  02.07.2006 : Alle Fz bekommen eindeutige synth. Kennung nach einheitlichem System
//		 Die Zuordnung zum Parkplatz-VOB geschieht über Indextabelle

		const int MAX_FZ = 450;
		int gate[MAX_FZ];
		int fzactor [MAX_FZ];
		int fzstatus [MAX_FZ];
		int fzstandort [MAX_FZ];
		int fzpriori[MAX_FZ];
		int rtw_c=0;
		int nef_c=0;
		int hubi_c=0;
		
		GameObjectList sirs;
		bool KatSZustand=false;
		float panzer=185.0;
		float speedfac=1.5;
		Person zivi;
		int MAXPAT=10;
		char * fzladfix="0000000000000000000000000";

object kaufen : CommandScript
{
	bool ersatz;

	kaufen()
	{
		ersatz=false;
	}

	bool CheckTarget(GameObject *Caller, Actor *Target, int childID)
	{
		ersatz=true;
		return true;
	}

	void PushActions (GameObject *Caller, Actor *Target, int childID)
	{
		fz_kaufen::fz_erstellen(Caller,Target,childID,0,ersatz);
	}

};

class fz_kaufen : CommandScript
{

	void pumpenstand_anlegen(Vehicle v)
	{
		char *id="          ";
		snprintf(id,10,"PU%u",v.GetID());
		PersonList pl(id);
		if (pl.GetNumPersons()==0)
		{
			// System::Log("Pumpenstand erzeugen %s",v.GetName());
			Person pump=Game::CreatePerson("mod:Prototypes/Persons/Fire Department/manoman.e4p",id);
			if (fzlocal::tankinhalt(&v)<9999) {
				pump.SetMaxHealth(320.0);
				pump.SetHealth(160.0);
			} else {
				pump.SetMaxHealth(1200.0);
				pump.SetHealth(600.0);
			}
			pump.SetCommandable(true);
			pump.AssignCommand("ma_wasser");
			pump.AssignCommand("fl_400l");
			pump.AssignCommand("fl_800l");
			pump.AssignCommand("fl_1200l");
			pump.AssignCommand("fl_1600l");
			pump.AssignCommand("fl_2000l");
			pump.AssignCommand("fl_2400l");
			pump.SetUserData(v.GetID());
			pump.SetClassified(true);
			pump.PushActionWait(ACTION_NEWLIST,0.1);
			if (fzlocal::tankinhalt(&v)>0)
			{
				snprintf(id,10,"TA%u",v.GetID());
				Person tank=Game::CreatePerson("mod:Prototypes/Persons/Fire Department/pumpman.e4p",id);
				tank.SetUserData(v.GetID());
				tank.SetClassified(true);
				tank.SetPosition(pump.GetPosition());
				pump.PushActionLift(ACTION_NEWLIST,&tank);
				tank.SetMaxHealth(fzlocal::tankinhalt(&v));
				tank.SetHealth(fzlocal::tankinhalt(&v));
				// System::Log("%s %u %s",id,int(tank.GetHealth()),v.GetName());
			}
		}
	}

	int fzcode_fw(Vehicle *vec,char * code)
	{
		int fz_code=FZ_FW | FZ_PA;
		switch (vec->GetVehicleType())
		{
			case VT_FIREFIGHTERS_FLB:
				fz_code=FZ_TEC|FZ_FWB;
				vec->AssignCommand("haswe");
				vec->AssignCommand("wama");
				if (vec->HasChild("rettboot")) {
					vec->SetChildEnabled("rettboot",true);
					vec->AssignCommand("beiboot_ab");
					vec->AssignCommand("pass_tausch");
				}			
				break;
			case VT_FIREFIGHTERS_DLK:
				fz_code=fz_code|FZ_DLK;
				break;
			case VT_FIREFIGHTERS_FMB:
				vec->AssignCommand("pass_tausch");
				break;
			case VT_FIREFIGHTERS_TLF:
				if (vec->HasChild("HLF")) {		// HLF mit Monitor identifizieren
					fz_code=fz_code|FZ_LF;
				} else {
					fz_code=fz_code|FZ_TLF|FZ_LF;
					if (fzlocal::tankinhalt(vec)>2999)
						fz_code=fz_code|FZ_GTLF|FZ_TLF|FZ_LF;
					if (fzlocal::tankinhalt(vec)>9000)
						fz_code=fz_code|FZ_SIMBA;
				}
				vec->EnableAutoTarget(false);
				break;
			case VT_FIREFIGHTERS_GTF:
				if (vec->HasChild("HLF")) {		// HLF mit Monitor identifizieren
					fz_code=fz_code|FZ_LF;
				} else 
					if (fzlocal::tankinhalt(vec)>1600)
						fz_code=fz_code|FZ_TLF|FZ_LF;
					else
						fz_code=fz_code|FZ_LF;
				break;
			case VT_FIREFIGHTERS_DEKONP:
			default:
				if (vec->HasChild("gwas"))
					fz_code=fz_code|FZ_GWAS;

				if (vec->HasChild("gwn"))
					fz_code=fz_code|FZ_GWN;

				if (vec->HasChild("dekon"))
					fz_code=fz_code|FZ_DEKON;
				break;				
		}
		
		if (fzlocal::has_equip(vec,5) && fzlocal::has_equip(vec,14))
			fz_code=fz_code|FZ_THL;
		if (fzlocal::has_equip(vec,20))
			vec->SetFlag(OF_HAS_JUMPPAD);
		return fz_code;
	}

	int fzcode_rd(Vehicle *vec,char * code)
	{
		int fz_code=FZ_RD;
		if (int(code[5])==73)
			fz_code=fz_code|FZ_ITH;
		switch (vec->GetVehicleType())
		{
			case VT_AMBULANCE_NEF:
				fz_code=fz_code|FZ_NA;
				break;
			case VT_AMBULANCE_RHC:
				fz_code=fz_code|FZ_NA|FZ_RTW|FZ_RTH;
				break;
			case VT_AMBULANCE_RTW:
			case VT_AMBULANCE_RHF:
				if (vec->HasNamePrefix("LEICHE"))
				{
					fz_code=fz_code|FZ_BSW;
					// System::Log("Bestatter %s",vec->GetName());
				} else if (vec->HasNamePrefix("SEG"))
					;
				else if (vec->HasNamePrefix("2191"))
					fz_code=fz_code|FZ_RHS;
				else if (vec->HasNamePrefix("oppfad"))
					fz_code=fz_code|FZ_OP;
				else if (vec->HasNamePrefix("TRAUMA"))
					fz_code=fz_code|FZ_RF;
				else
					fz_code=fz_code|FZ_RTW;
				break;
		}
		return fz_code;
	}

	int fzcode_pol(Vehicle *vec,char * code, char tz)
	{
		int fz_code=FZ_POL;
		bool fuehrung=int(code[0])>90;
		bool kripo=tz==char(75);
		
		if (vec->HasNamePrefix("SEK"))
			fz_code=fz_code|FZ_SEK;
		else if (vec->HasNamePrefix("KM"))
			fz_code=fz_code|FZ_KMRD;
		else 
			vec->AssignCommand("civil_warning");

		if (kripo)
			fz_code=fz_code|FZ_KRIPO;

		switch (vec->GetVehicleType())
		{
			case VT_POLICE_PHC:
				fz_code=fz_code|FZ_PHC;
				break;
			case VT_POLICE_STW:
				fz_code=fz_code|FZ_STW;
				if (!fuehrung)
					fz_code=fz_code|FZ_STREIFE;
				break;
			case VT_POLICE_MTW:
				fz_code=fz_code|FZ_MTW;
				break;
			case VT_POLICE_WAW:
				fz_code=fz_code|FZ_WAWE;
				break;
		}
		return fz_code;
	}

	int fzcode_tec(Vehicle *vec,char * code)
	{
		int fz_code=FZ_TEC;
		switch (vec->GetVehicleType())
		{
			case VT_FIREFIGHTERS_ASF:
				fz_code=fz_code|FZ_ASF;
				break;
			case VT_THW_FGRR_BKF:
				fz_code=fz_code|FZ_KRAN;
				break;
			case VT_THW_FGRT_BH:
				fz_code=FZ_RD|FZ_SAR|FZ_ITH|FZ_NA|FZ_RTW|FZ_RTH;
				break;
			case VT_THW_FGRI_EKW:
				if (vec->HasNamePrefix("tjeep"))
						fz_code=fz_code|FZ_ELEKTRO;		
				else if (vec->HasNamePrefix("DBNFM"))
						fz_code=fz_code|FZ_BAHN;
				else if(vec->HasNamePrefix("WaWe"))
						fz_code=fz_code|FZ_SWT;
				break;
		}
		if (vec->HasNamePrefix("KM"))
			fz_code=FZ_POL|FZ_KMRD;
		return fz_code;
	}

	void fz_codieren(int q,Vehicle *vec,char * code, char tz)
	{
		int fz_code=0;
		if (vec->IsFirefighter())
			fz_code=fzcode_fw(vec,code);
		else if (vec->IsPolice())
			fz_code=fzcode_pol(vec,code,tz);
		else if (vec->IsAmbulance())
			fz_code=fzcode_rd(vec,code);
		else
			fz_code=fzcode_tec(vec,code);

		if (int(code[0])>90) 
			if (vec->HasCommand("elw_aufbauen"))
				fz_code=FZ_TEC|FZ_FUEHRUNG;
			else if ((fz_code & (FZ_POL|FZ_KRIPO))!=(FZ_POL|FZ_KRIPO))
				fz_code=fz_code|FZ_FUEHRUNG;

		if (fzlocal::has_equip(vec,1))
			fz_code=fz_code|FZ_CSA;
		if (fzlocal::has_equip(vec,2))
			fz_code=fz_code|FZ_TAU;
		if (vec->HasCommand("isbw"))
			fz_code=fz_code|FZ_BW;

		fzstatus[q]=fz_code;
		fzactor[q]=vec->GetID();
	}

	int fz_erstellen (GameObject *Caller, Actor *Target, int childID,int wibmapfolge,bool ersatz)
	{

		System::Log("INIT UNIT %u %s",childID,Caller->GetName());
		Vehicle vec;
		int MaxPass, maxTrans;
		char *Act[];
		GameObject park;
		int i,wache;
		GameObject *ofz;
		GameObjectList lfz;
		ActorList fzl;
		int q=childID;
		Vector Wache;
		float rot[9];
		float childRot[9];
		bool campaign=MissionMode || Caller->GetUserData()==112;
		bool bedarfsfz = false;
		bool nachbarfz = false;
		bool canffw = false;
		bool td_fz = false;
		bool fuehrung=false;
		bool teilzeit=false;
		bool haspath=false;
		bool ith=false;
		int dir = 0;
		const char *parken;
		char *kennung="                 ";
		int speed,trans,pass,rw;
		int alarmcode;
		bool slowdown=true;
		bool anhaenger=false;
		bool FzInvalid=false;
		bool kinderNA=false;

		if (q == 99999)
		{
			Vehicle vec(Target);
			vec.Hide();
			kennung=vec.GetName();
			q=fzlocal::fzid(&vec);
			wache=fzlocal::fzort(&vec);
			ersatz=true;
			bedarfsfz=fzlocal::nachbar(&vec,2);
			nachbarfz=fzlocal::nachbar(&vec,1);
			canffw=fzlocal::isffw(&vec);
			if (fzlocal::inplace(&vec) || !autohaus.IsValid())
			{
				parken=fzlocal::kennung(q);
				ersatz=false;
			}
		} else {
			if (q>999999)
			{
				alarmcode=q/1000000;
				q=q-(1000000*alarmcode);
			}
			if (q>100000)
			{
				i=q/100000;
				q=q-(100000*i);
				switch (i)
				{
					case 1 :
						nachbarfz=true;
						break;
					case 2 :
						bedarfsfz=true;
						break;
					case 4: 
						canffw=true;
						break;
					case 0:
						nachbarfz=false;
						break;
					// ob Ersatzbeschaffung, wird durch CheckTarget geklärt
				}
			}

			wache=q/1000;
			q=q-(1000*wache);
			if (canffw)
			{
				canffw=fzlocal::ff_check(wache);
				if (!canffw)
					nachbarfz=true;
			}
			if (wache>50)
				dir=wache-50;
			else
				dir=wache;
			if (!nachbarfz && !bedarfsfz && !ersatz)
				parken= fzlocal::kennung(q); // Fz direkt am Standort erzeugen
			snprintf(kennung,17,"%s.................",fzlocal::xmlval("FZKEN",q,7));
	
		} // Ende Neufahrzeug Kennung	

		if (!ersatz)
			System::Log("INIT VEC %s %u",fzlocal::kennung(q),q);
		char *fzcode="       ";
		fzcode=fzlocal::xmlval("FZCOD",q,6);

		int radius;
		int a,b,c;
		Game::GetTime(a,b,c);
		kennung[7]=char(32+wache);  // 7. Stelle codiert die Wache
		fzstandort[q]=wache;
		kennung[8]=char(32+a);    // 8. -4. Stelle eindeutige Objektkennung
		kennung[9]=char(32+b);	
		kennung[10]=char(32+c);
		kennung[11]=char(32+q);    // 5. Stelle codiert Fz-Typ
		if (strlen(fzcode)>4)
			kennung[12]=fzcode[4]; // die 12.Stelle codiert bei RTW/NEF/Hubi den Platz im Tableau
		if (!ersatz)
			fzpriori[q]=wibmapfolge; // int(fzcode[4])-48;
		kennung[13]=fzcode[0]; // 13.stelle codiert fz-alarmgeschwindigkeit
		kennung[16]=fzcode[3]; // codiert SoSi des Fz

		
		bool sofu_valid=true;
		bool simba=false;
		bool romanes_eunt_domus=false;
		bool Modder=false;
		char tz=fzcode[5];
		switch (tz)
		{
			case 65:
				anhaenger=true;
				GameObject park(Target);
				false;
			case 73:
				ith=true;
				break;
			case 105:
			case 75:
				break;
			case 102:
				simba=true;
				break;
			case 80:
				haspath=true;
				tz="i";
				break;
			case 82:
				int beginn=rand()%3+3;
				int ende=((beginn+rand()%15)&15)*16;
				tz=char(128|ende|beginn);
				// System::Log("%s teilzeit %s",fzcode,tz);
			case 77:
				Modder=true;
			case 87:
				romanes_eunt_domus=true;
				break;
			case 107: // Kinder-Notarzt
				kinderNA=true;
				break;
			default:
				sofu_valid=int(tz)<0;
				teilzeit=sofu_valid;
				break;
		}
		if (sofu_valid)
			kennung[14]=tz; // Sonderfunktionen-Code
		else
			kennung[14]=char(64);
	
		if (ersatz)
			park=autohaus;
		else if (nachbarfz || bedarfsfz)
			park=ppos[dir];
		else if (haspath) {
			PathList pal(parken);
			haspath=pal.GetNumPaths()>0;
			if (haspath)
				Path pa=pal.GetPath(0);
			else	
				FzInvalid=true;		
		} else if (!anhaenger) {
			GameObjectList ol(parken); // Fz am gewuenschten Stellplatz erzeugen
			nachbarfz=ol.GetNumObjects() == 0;
			if (!nachbarfz)
				park = ol.GetObject(0);
			else if (campaign)
					park=ppos[0];
				else
					FzInvalid=true;
		}

		if (canffw)
			kennung[15]=char(48+4);
		else if (bedarfsfz)
			kennung[15]=char(48+2);
		else if (nachbarfz)
			kennung[15]=char(48+1);
		else 
			kennung[15]=char(48);

		// system::log("FZ Kaufen Kennung %s %s",kennung,park.GetName());

		// Logischer Block Fahrzeug erzeugen
		if (ersatz)
		{
			vec.PushActionDeleteOwner(ACTION_NEWLIST);
			if (bedarfsfz)
			{
				ersatz=false; // VERRY Evil, wird am ende der Routine zurueckgesetzt, aber da komm ich ja nimmer hin!
				return; // Verry verry evil, Kein Fz erzeugen, Schrott iss ja weg -> Verhindert BedarfsFz nach Abschleppen eines solchen !!!
			}
		}


		speed=int(fzcode[0])-64;
		if (speed>26)
		{
			speed=speed-32;
			fuehrung=true;
		}

		pass=int(fzcode[1])-48;
		trans=int(fzcode[2])-48;

		if (FzInvalid) {
			System::Error("Ungueltiger Stellplatz für %s",parken);
			return;
		}


		//Erzeuge das Fahrzeug
		System::Log("Erzeuge Fz %s Code %s Wache %u Prio %u",kennung,fzcode,dir,wibmapfolge);
		char *proto="                                                                                                                                                                 ";
		snprintf(proto,80,"mod:Prototypes/Vehicles/%s",fzlocal::xmlval("FZPRO",q,50));
		vec = Game::CreateVehicle(proto,kennung);

		vec.SetSpeed(speed*1.5);
		//Platz schaffen
		vec.SetMaxPassengers(pass);
		vec.SetMaxTransports(trans);
		//Lichter aus
		vec.EnableBlueLights(false);
		vec.EnableBreakLights(false);
		vec.EnableSpecialLights(false);
		//Drehen
		// System::Log("Drehen und stellen %s Anfahrt : %s",vec.GetName(),park.GetName());
		if (haspath)
		{
			vec.SetPosition(pa.GetPoint(0));
		} else if (park.IsValid()) {
			vec.SetRotation(&park);
			vec.SetPosition(&park);
		} else 
			vec.Hide();
		vec.ClearFlags();
		fzlocal::fz_beladen(&vec,false,true);
		// Flags setzen
		vec.SetFlags(OF_RECOVERABLE | OF_TRANSPORTABLE | OF_SHOOTABLE | OF_COOLABLE|OF_HAS_FIRE_EXTINGUISHER);
		if (vec.IsFirefighter())
		{
			vec.SetFlag(OF_HAS_FIREAXE);
			vec.SetFlag(OF_HAS_SHEARS);
			vec.SetFlag(OF_HAS_HOSE);
			vec.SetFlag(OF_HAS_CHAINSAW);
		}
		
		if (vec.HasChild("selbstsch01"))
		{
			vec.AssignCommand("SetSelbstschutz");
			fzlocal::selbstschutz(&vec,false);
		}


		if (simba) {
			vec.AssignCommand("flf");
			vec.SetWaterStreamEndWidth(vec.GetWaterStreamEndWidth()/3*2);
		}

		if (kinderNA)
			vec.AssignCommand("kinderna");

		//Personen erzeugen ?
		int pn=pass;
		int px,ps;
		vec.PushActionWait(ACTION_NEWLIST,0.1f);
		switch (vec.GetVehicleType())
		{
			case VT_AMBULANCE_RTW:
				break;
			case VT_AMBULANCE_RHF:
				break;
			case VT_AMBULANCE_NEF:
				vec.SetFlag(FLAG_NA);
				break;
			case VT_AMBULANCE_RHC:
			case VT_THW_FGRT_BH:
				vec.SetFlag(FLAG_NA);
				if (ith)
					vec.AssignCommand("isith");
			case VT_POLICE_PHC:
				slowdown=false;
				break;
			case VT_POLICE_STW:
				vec.AssignCommand("stoppol");
				vec.AssignCommand("vk_um_vor");
				break;
			case VT_POLICE_MTW:
				vec.SetFlag(OF_HAS_FLASHGRENADE | OF_HAS_ROADBLOCK);
				break;
			case VT_FIREFIGHTERS_DLK:		
			case VT_FIREFIGHTERS_RW:
			case VT_FIREFIGHTERS_TLF:
			case VT_FIREFIGHTERS_GTF:
				if (fzlocal::has_equip(&vec,19))
					vec.SetFlag(OF_HAS_JUMPPAD);
			case VT_FIREFIGHTERS_DEKONP:
				vec.AssignCommand("gf_pa");
				vec.AssignCommand("gf_csa");
				break;
			case VT_TV_HELI:
				vec.AssignCommand("FlyTo");
				slowdown=false;
				break;
			case VT_FIREFIGHTERS_FMB:
				if (!vec.IsHidden())
					fzlocal::wache_anlegen(&vec);
				else
					vec.PushActionMove(ACTION_INSERT,&park,TARGET_EXTINGUISH);
				if (vec.HasChild("rod"))
					vec.SetChildEnabled("rod",false);
				break;
		}
		
		if (!nachbarfz && !bedarfsfz) 
		{
			char *tor="          ";
			snprintf(tor,10,"gate_%s",fzlocal::kennung(q));
			GameObjectList ol(tor);
			if (ol.GetNumObjects()>0)
				gate[q]=ol.GetObject(0)->GetID();
			else
				gate[q]=-1;
			// System::Log("GateCheck %s gefunden : %u",tor,gate[q]);
		}


		if (slowdown)
			vec.SetSpeed(civspeed);

		vec.EnableHeadLights(false);
		if (vec.HasChild("NA"))
			vec.SetChildEnabled("NA",false);
		if (vec.HasChild("POL"))
			vec.SetChildEnabled("POL",false);
		if (vec.HasChild("INFEKT"))
			vec.SetChildEnabled("INFEKT",false);
		if (vec.HasChild("pumpe")) {
			pumpenstand_anlegen(vec);
			vec.SetChildEnabled("pumpe",true);
		}

		if (fuehrung)
		{
			if (vec.IsFirefighter())
				vec.AssignCommand("tl_tel_uebernimmt");
			vec.AssignCommand("civil_warning");
		} else if (romanes_eunt_domus)
			vec.AssignCommand("civil_warning");
	
		vec.SetFlag(OF_HAS_ROADBLOCK);

		if (vec.HasChild("pumpe"))
			vec.AssignCommand("ma_wasser");

		int haenger=-1;

		if (vec.HasNamePrefix("KMLKW")) {
			haenger=fz_kaufen::fz_erstellen (&vec,&vec,107,0,false);
		}

		if (haspath) switch (q)
		{
			case 84:
				vec.AssignCommand("op_start");
				break;
		} else {
			if (!anhaenger)
			{
				vec.AssignCommand("aufsitzen");
				vec.AssignCommand("WT_SoSi");
				vec.AssignCommand("AutoUmleiten");	
				vec.AssignCommand("Status6");
				vec.AssignCommand("tl_do_tel");
				vec.AssignCommand("tl_take_fz");
				vec.AssignCommand("tl_rufe_fw");
				vec.AssignCommand("tl_rufe_rd");
				vec.AssignCommand("tl_rufe_rest");
				vec.AssignCommand("tl_rufe_na");
			}
			vec.AssignCommand("notruf_pol");	
			if (Modder)
			{
				vec.AssignCommand("wem_event");
				vec.AssignCommand("smitex");
				vec.AssignCommand("smite");
				vec.AssignCommand("mapversion");
				vec.AssignCommand("feuerwerk");
			}
		}

		fz_codieren (q,&vec,fzcode,tz);
		//System::Log ("Fz codieren Nr %u %s Code %u TZ %c FzCode %s",q,vec.GetName(),fzstatus[q],tz,fzcode);

		if (anhaenger) {
			// Caller->PushActionExecuteCommand(ACTION_INSERT,"anhaenger_dran",Target,vec.GetID(),false);
			return vec.GetID();
		} else if (bedarfsfz)
		{
			vec.AssignCommand("bedarfs_fz");
			vec.AssignCommand("ich_bin_nicht_frei");
			fzlocal::status_setzen(&vec,2);
			vec.Hide();
			GameObject tob(Target);
			int pl_MP;
			if (Target->HasName("estelle"))
				pl_MP=tob.GetPlayerMP();
			else
				pl_MP=Caller->GetPlayerMP();
			if (alarmcode==160)
				vec.AssignCommand("fuehrung");
			vec.SetPlayerMP(pl_MP);
			vec.PushActionExecuteCommand(ACTION_NEWLIST,"alarmiere_Winterberg",Target,alarmcode,false);
		} else if (nachbarfz)
			vec.AssignCommand("hidden");

		if (ersatz)
		{
			vec.Show();
			vec.SetFlag(FLAG_FUNK);
			vec.PushActionExecuteCommand(ACTION_APPEND,"CreateNewPerson",&vec,70,false);
			Mission::PlayHint("WIB_ERSATZ");
			vec.PushActionExecuteCommand(ACTION_APPEND,"gohome_winterberg",&vec,0815,false); // Ersatzfz zum Standort schicken
		} else {
			if (nachbarfz)
				vec.PushActionShowHide(ACTION_APPEND,true);
			if (teilzeit)
				vec.PushActionExecuteCommand(ACTION_APPEND,"Teilzeit",&metronom,0,false);
		}

		ersatz=false;  // Marker für Ersatzfahrzeug wieder zuruecksetzen für nächsten Aufruf
		if (haenger>0)
			vec.PushActionExecuteCommand(ACTION_INSERT,"anhaenger_dran",&vec,haenger,false);

	}
};

// ABSCHNITT: RUFE Fz 
// 
// basiert auf rufe_stw.script für Em3 by manuelt
//
// Revision
// 5/2009    : Restrukturierung der Alarmcodes für Siete
//
//	Klasse 1 : Feuerwehr (300 - 599)
//		300 : Schlauchwechseldienst
//		301 : Rufbereitschaft Leitstelle
//		302 : KBM
//		303 : ELW2
//		304 : Simba 
//		305 : BSD Public Viewing -> 306 : RW Public Viewing
//		307 : Feuerlöschboot
//		310 : Katastrophen-Alarm
//		311 : örtlich komplett
//		315 : örtlich Einzelfahrzeug
//		399 : Kreisalarm
//
//		500 - 599 : Feuerwehr
//			00 EL, 10 LF, 20 TLF, 30 DLK, 40 RW , 50 GW-AS, 60 GTLF, 70 DEKON, 80 GW-N
//			
//			0 : Fz-spezifische Alarmierung -> Schleife in Fz-Schleife umcodieren
//			1 : Brand
//			2 : TH
//			3 : Gefahrgut
//			4 : Wasserrettung
//			5 : örtlich, nicht auffüllen
//			9 : First Responder
//			
//	Klasse 2 : Polizei (100-299)
//		101 : PolFz -> 102 : Pol im FwZug (StW bevorzugt) -> 103: KriPo -> 104 MTW -> 105 : Fussstreife am Markt -> 109 : Feldjäger
//		110 : Verkehrskontrolle MTW, 111 STW, 112 STW von ausserhalb, 113 : MTW von ausserhalb
//		120 : SEK PKW -> 121 SEK MTW
//		130 : Flucht-FZ
//		140 : EL Demo -> 141 : MTW Demo -> 142 : Wasserwerfer
//		145 : Wasserwerfer solo
//		150 : Pol Heli
//		160 : KmRD EL, 161 : KmRD Vito, 162 : KmRD LKW , 163 : KMRD MiniBagger
//		199 : Notruf PO		
//		
//	Klasse 3 : Rettungsdienst (600 - 699)
//		600 : BSW
//		602 : Notarzt -> 601 Kompakt-NAW, 603 -> LNA
//		610 : RTW -> 611 RTW im Rendez-vouz, kein KTW erlaubt, 612 ;), 619 -> First Responder
//		620 : RTH, 621 -> ITH, 622 -> SAR
//		630 : Rettungshunde
//		650 : SEG MTW, 651 -> SEG Arzt, 652 -> SEG Truck, 653 -> NB RTW, 654 -> NB NEF , 655 -> NB NAW
//		660 : Notfall-Team, 661 -> OP
//		670: SEG MTW WM,  672 -> SEG Truck WM, 673
//		
//	Klasse 4 : Technischer Dienst (700-899)
//		700 : ASF, 701 : Kran, 702 : Schlepper, 703 : schwimmender Bergekran 
//		710 : Elektro, 711: Bahn, 712 : Wasserwerk
//		720 : Schneeraeumer
//
//
//	Klasse 5 : Wir sinds
//		900 : Winterberger
//		901 : Doc
//		902 : Dedo
// 		903 : Danny
//
// 17.6.2006 : Auswahl über VehicleList, gesteuert über childID, default -> Streife/MTW
//
// 20.6.2006 : Erzeugt einen externen Bestatter  
//		alarmierter Streifenwagen kann Verdächtigen direkt verfolgen		
//
// 24.6.2006 : einzelne Feuerwehrfahrzeuge sowie RTD werden auch von diesem Script alarmiert
//
// 02.7.2006 : Fahrzeuge werden anhand ByteCode identifiziert. Die ich_bin_funkruf-Kommandos sind entbehrlich
//		alle genau einmal einsetzbaren Fz stehen hidden auf der Map -> einfachere Nachrücklisten

// Basis: Garagenausfahrt by Big Bob

// Ruft ein freies Winterberger Fahrzeug oder alarmiert externe Fahrzeuge

// Die Verwendung in anderen Mods ist gestattet, solange dieser
// Kommentar erhalten bleibt

int auftrag=0;

int ndmask=524288;
int stmask=ndmask*2;
int nfmask=stmask*2;
int folgemask=nfmask*2;
int noflags=ndmask-1;
int vorwache=499;

object rufe_winterberg : CommandScript	
{

	// 1. schritt der Alarmierung :Fz Disponieren

	bool kriterien_erfuellt; //Ist dieser STW gerade frei?
	float abstand, minimum; // Abstand und kürzester Abstand zwischen STW und Ziel...

	rufe_winterberg()
	{
		SetPriority(1000);
	}


	void fz_stornieren (int fzid)
	{
		Actor a=Game::GetActor(fzactor[fzid]);
		Vehicle v(&a);
		if (fzlocal::IsTyp(&v,FZ_RD|FZ_OP)||fzlocal::IsTyp(&v,FZ_RD|FZ_RF))
			v.PushActionExecuteCommand(ACTION_NEWLIST,"trauma_ende",&v,0,false);
		else
			v.PushActionExecuteCommand(ACTION_NEWLIST,"aufsitzen",&v,0,false);
	}

	bool harry_him(int code)
	{
		bool ok=code==1 && docfetch.IsValid() && (fzstatus[1]&15)==0;
		return ok;
	}

	void fz_rufen(GameObject *Caller, Actor *Target, int childID)
	{
		Vector FzPos;
		Vector MinFz;
		Vector Abstand;
		Vehicle v;
		Vehicle stw;
		int dir=0;
		char * hint[];
		int randact;	
		Vector TargetPos;
		int pt;
		int wblevel=0;
		int quad;
		Vector Mitte;
		int rtw=0;
		int h,m,s;
		int quad;
		float dist, mindist;
		bool sofa=false;

		TargetPos=Game::GetCommandPos();
		bool dummy=false;
		bool nachforderung=false;
		bool zugende=false;
		int basewert;
		int sw;
		bool kompakt=false;
		int aufruf=childID;

		bool neudispo=(childID & ndmask)>0;
		bool normale_fahrt=(childID & nfmask)>0;
		bool folgeeinsatz=(childID & folgemask)>0;		

		GameObject tob(Target);
		int lt;
		int pl_MP;
		if (Target->HasName("estelle"))
			pl_MP=tob.GetPlayerMP();
		else
			pl_MP=Caller->GetPlayerMP();

		childID=childID & noflags;

		// System::Log("Fz rufen %u nf:%u %s",childID,int(normale_fahrt),Target->GetName());

		if (Target->GetType() == ACTOR_FLOOR)
		{
			Vehicle p = Game::CreateVehicle("mod:Prototypes/Vehicles/Winterberg/pylone.e4p", "alarmdummy");
			p.Hide();
			Game::FindFreePosition(&p,TargetPos);
			p.SetPosition(TargetPos);
			Target=&p;
			// p.AssignCommand("alarm_dummy");
			if (Game::IsMultiplayer())
				p.SetPlayerMP(pl_MP);
		} else 
			tob.SetPlayerMP(pl_MP);

		if (childID>999)
		{
			rtw=childID/1000;
			childID=childID-1000*rtw;
		}

		bool IsFW=childID>499 && childID<600;

		bool zivi=childID==612;
		if (zivi)
			childID=610;

		bool nachruecken=false;
		bool freiesFz=false;

		switch (rtw)
		{
			case 499:
				basewert=10; // Kreisalarm, wenn kein passendes Fz in der Ortswehr naechste Wehr alarmieren
				freiesFz=true;
				rtw=vorwache;				
				break;
			case 99:		// 99 ist schlecht, kann theoretisch auch ein Fz sein, falls ein Rettungsmittel gerufen wird
				nachruecken=true;
				if (tob.HasCommand("lst_estelle") && IsFW) {
					Actor est=Game::GetActor(tob.GetUserData());
					rtw=fzlocal::fzort(&est);
					System::Log("Rufe WEM : Code %u fuer Wache %u auf Fz %s",childID,rtw,est.GetName());
				}
			default:
				basewert=-1; // ortsbezogene Alarmierung
				break;
		}

		bool no_fs=false;

		VehicleList l0;
		int fzmask=FZ_NOSTAT_MASK;
		int fzaus=0;
		int switcher=childID;
		if (IsFW) {
			switcher=switcher/10;
			if (vorwache>498)
				vorwache=rtw;
		}

		dir=atoi(fzlocal::xmlval("EXTFZ",switcher,7));
		// System::Log("Code %u : Bedarfsweise Fz %u rufen weil %s",switcher,dir,fzlocal::xmlval("EXTFZ",switcher,6));

		if (!neudispo) switch (switcher) 
		{
			// Sonderfunktionen zur Alarmierungssteuerung
			case 2:
			case 3:
			case 10:
				Caller->PushActionExecuteCommand(ACTION_APPEND,"senden",Caller,100+childID,false);
				vorwache=999;
				return;
				break;

			// FzAuswahl neue Codes
			case 600:
				fzmask=FZ_RD|FZ_BSW;
				break;

			case 602:
				fzmask=FZ_RD|FZ_NA;
				VehicleList cl(Caller->GetName());
				if (Target->GetType() == ACTOR_PERSON)
					if (cl.GetNumVehicles()>0)
						nachforderung=(cl.GetVehicle(0)->GetVehicleType() == VT_AMBULANCE_RTW);
				break;
			case 601:
				kompakt=true;
			case 611:
			case 610:
				fzmask=FZ_RD|FZ_RTW;
				VehicleList cl(Caller->GetName());
				if (Target->GetType() == ACTOR_PERSON)
					if (cl.GetNumVehicles()>0)
						nachforderung=(cl.GetVehicle(0)->GetVehicleType() == VT_AMBULANCE_RTW);
				break;
			case 619:
				fzmask=0;
				break;
			case 621:
			case 622:
				fzmask=FZ_RD|FZ_ITH;
				if (switcher=622)
					fzmask=fzmask|FZ_SAR;
				else
					rtw=73+rand()%3;
				if (rtw==75)
					rtw=83;
				break;
			case 620:
				fzmask=FZ_RD|FZ_RTH;
				break;		
			case 603:
				fzmask=FZ_RD|FZ_NA|FZ_FUEHRUNG;
				break;		
			case 660:
				fzmask=FZ_RD|FZ_RF;
				break;
			case 661:
				fzmask=FZ_RD|FZ_OP;
				break;
			case 650:
			case 670:
				break;
			case 651:
				break;
			case 652:
			case 672:
				break;
			case 630:
				fzmask=FZ_RD|FZ_RHS;
				lt=8;
				break;
			case 655:
				kompakt=true;
			case 653:
				break;
			case 654:
				break;
			case 109 :
				fzmask=FZ_BW|FZ_POL|FZ_MTW;
				break;
			case 104 :
			case 110 :
				fzmask=FZ_POL|FZ_MTW;
				fzaus=FZ_SEK|FZ_BW;
			case 113:
				break;
			case 140 :
			case 141 :
			case 142:
				break;
			case 145:
				fzmask=FZ_POL|FZ_WAWE;
				break;
			case 150 :
				fzmask=FZ_POL|FZ_PHC;
				break;

			
			case 111:
			case 102:
				no_fs=true;
				fzaus=FZ_KRIPO;
			case 101:
				fzaus=fzaus|FZ_FUEHRUNG|FZ_BW|FZ_SEK;
				fzmask=FZ_POL|FZ_STW;
			case 112:
				break;

			case 105:
				break;
			case 120:
				fzmask=FZ_POL|FZ_STW|FZ_SEK;
				fzaus=FZ_BW;
				break;
			case 121:
				fzmask=FZ_POL|FZ_MTW|FZ_SEK;
				fzaus=FZ_BW;
				break;
			case 103:
				fzmask=FZ_POL|FZ_KRIPO;
				fzaus=FZ_BW;
				break;
			case 130:
				break;
			case 160:
			case 161:
			case 162:
				break;
			case 199:
				fzmask=FZ_POL;
				fzaus=FZ_PHC|FZ_BW;
				break;

			case 700:
				fzmask=FZ_TEC|FZ_ASF;
				break;
			case 701:	
				fzmask=FZ_TEC|FZ_KRAN;		
				break;
			case 702:	
				break;
			case 710:
				fzmask=FZ_TEC|FZ_ELEKTRO;
				break;
			case 711:
				fzmask=FZ_TEC|FZ_BAHN;
				break;
			case 712:
				fzmask=FZ_TEC|FZ_SWT;
				break;
			case 720:
				break;

			case 300:
				fzmask=FZ_FW|FZ_GWAS|FZ_GWN;
				normale_fahrt=true;
				break;
			case 301:
				break;
			case 302:
				fzmask=FZ_FW;
				break;
			case 303:
				fzmask=FZ_TEC|FZ_FUEHRUNG;
				break;
			case 304:
				fzmask=FZ_FW|FZ_SIMBA;
				if (rtw!=0)
					dir=0;
				break;
			case 305:
				break;
			case 306:
				break;
			case 307:
				fzmask=FZ_TEC|FZ_FWB;
				break;
			case 315:
				nachruecken=true;
			case 311:
				fzmask=FZ_FW;
				fzaus=FZ_SIMBA;
				break;

			case 50:
				fzmask=FZ_FW|FZ_FUEHRUNG;
				break;
			case 51:
				if (childID%10!=5)
					nachruecken=true;
				fzmask=FZ_FW; 
				fzaus=FZ_DLK|FZ_DEKON|FZ_GWAS|FZ_GWN|FZ_SIMBA;
				break;
			case 52:
				if (childID%10!=5)
					nachruecken=true;
				fzmask=FZ_FW;
				fzaus=FZ_DLK|FZ_DEKON|FZ_GWAS|FZ_GWN|FZ_SIMBA;
				break;
			case 53:
				if (childID%10!=5)
				{
					nachruecken=true;
					if (!freiesFz)
						dir=0;
				} else
					dir=0;
				sofa=true;
				fzmask=FZ_FW|FZ_DLK;
				break;
			case 54:
				sofa=true;
				fzmask=FZ_FW|FZ_THL;
				fzaus=FZ_SIMBA;
				break;
			case 55:
				sofa=true;
				fzmask=FZ_FW|FZ_GWAS;
				break;
			case 56:
				sofa=true;
				fzmask=FZ_FW|FZ_GTLF;
				fzaus=FZ_SIMBA;
				break;
			case 57:
				fzmask=FZ_FW|FZ_DEKON;
				break;
			case 58:
				fzmask=FZ_FW|FZ_GWN;
				fzaus=FZ_GWAS;
				break;
			case 900:
				fzmask=FZ_FW;
				break;
			case 901:
				fzmask=FZ_RD|FZ_NA;
				break;
			case 902:
				fzmask=FZ_POL;
				break;
			case 250 :
				break;
		}
	

		int max=MAX_FZ;
		float wert=101;
		int maxspeed;
		float folge=1000;
		int fzid, fzort;
		int fzprio;
		int fzstart;
		int choose=Math::rand()%3;
		int mdir=dir;
		int hasna, hasra, needra, needna,panz;
		Person doc;
		float multi;
		bool FzAF,FzVoll,FzBesetzt;
	
		int h,m,s;
		Game::GetTime(h,m,s);
		bool nacht=((h>18) || (h<7));
		bool flugwetter=((Weather::GetFogIntensity()<0.5) && (Weather::GetStormIntensity()<0.5) && (Weather::GetRainIntensity()<0.5) && (Weather::GetSnowIntensity()<0.7));

		// System::Log("Fz Auswahl Loop fuer %u %u %u",childID,fzmask,rtw);

		if (neudispo) 
		{
			Actor a=Game::GetActor(fzactor[rtw]);
			Vehicle stw(&a);
			folge=1; wert=1; 
		} else if (fzmask<FZ_NOSTAT_MASK) for (int i=1; i<max; i++) if (fzstatus[i]!=0)
		{
			//Aktuelles Objekt
			fzid=i;
			fzort=fzstandort[i];
			fzprio=fzlocal::fzprio(i);
			lt=0;
			multi=1.0;
			bool isHome=fzort==rtw;
		
			switch (childID)
			{

				case 34:
					if (childID==161)
						dir=0;
					break;
				case 32:
				case 35:
				case 36:
				case 37:
					break;
				case 7:
				case 8:
				case 9:
				case 59:
				case 60:
					lt=2;
					break;
				case 10:
					lt=4;
					break;
				case 41:
					break;
				case 69:
					if (childID==150)
						dir=0;
					break;
				case 75:
					if (childID==660)
						dir=0;
					break;
				case 70:
					lt=4;
					if (childID==151)
						dir=0;
					break;
				case 95:
					lt=8;
					break;
				default:
					dir=mdir;
					break;
			} 

			bool einsatzbereit=(fzstatus[i]&14)==0;

			//Nur ohne Transport möglich...
			FzAF=(fzstatus[i]&15)>0;
			Actor a=Game::GetActor(fzactor[i]);
			Vehicle v(&a);
			FzVoll=v.GetFreePassengers()==0;
			FzBesetzt=v.GetNumPassengers()>0;

			kriterien_erfuellt=(fzstatus[i]&fzmask)==fzmask && (fzstatus[i]&fzaus)==0 && (FzBesetzt || !FzAF);

			if (einsatzbereit && kriterien_erfuellt)
			{
				hasna=0;
				hasra=0;
				needra=0;
				needna=0;
				// System::Log("Fz %s",v.GetName());
				switch (v.GetVehicleType())
				{
					case VT_AMBULANCE_NEF:
						needra=1;
						break;
					case VT_AMBULANCE_RHC:
					case VT_THW_FGRT_BH:
					case VT_AMBULANCE_RTW:
						needra=2;
						break;
				} 
				switch (switcher)
				{
					case 112:
					case 720:
						break;
					case 600:
						wert=1;
						i=max;
						break;
					case 660:
					case 661:
					case 603:
					case 630:
					case 150:
					case 140:
					case 141:
					case 142:
					case 120:
					case 121:
					case 130:
					case 160:
					case 161:
					case 162:
					case 701:
					case 710:
					case 711:
					case 712:
					case 300:
					case 301:
					case 307:
						wert=fzprio;
						break;
					case 700:
						if (!v.HasVehicleUploaded())
						{
							i=max;
							wert=1;
						} else 
							wert=-1;
						break;
					case 901:
					case 900:
					case 902:
					case 621:
					case 622:
						if (fzid==rtw)
						{
							wert=1;
							i=max;
						}  else if (switcher==622)
								wert=fzprio;
							else
								wert=-1;
						break;
					case 650:
						if (stw.HasNamePrefix("SEGKTW"))
							wert=1;
						else
							wert=-1;
						break;
					case 651:
						if (stw.HasNamePrefix("SEGDOC"))
							wert=1;
						else 
							wert=-1;
						break;
					case 652:
						if (stw.HasNamePrefix("SEGLKW"))
							wert=1;
						else
							wert=-1;
						break;
					case 655:
						kompakt=true;
					case 653:
						if (stw.HasNamePrefix("mtk8583"))
							wert=1;
						else 
							wert=-1;
						break;
					case 654:
						if (stw.HasNamePrefix("rud8882"))
							wert=1;
						else 
							wert=-1;
						break;
					case 602:
					case 620:
						kriterien_erfuellt = false;
						//Ist mind. ein NA an Bord?
						if (FzAF)
						{
							PersonList na(v.GetName());
							panz=na.GetNumPersons();
							for(int j=0; j<panz; j++)
							{
								doc=na.GetPerson(j);
								if (doc.GetEnteredCarID() == v.GetID() || doc.GetEnteredCarID()==-1)
									if (doc.IsDoctor())
										hasna++;
									else 	if (doc.IsParamedicTeam())
											hasra+=2;
										else hasra++; 
							}
						};
						kriterien_erfuellt=((hasna==1 && hasra>=needra) || !FzAF || FzVoll) && (v.GetNumTransported()==0);
						if (kriterien_erfuellt)
						{
							wblevel=1;
							if (rtw == 0 || rtw == 99) // automat. NAW-Alarmierung
								switch (v.GetVehicleType())
								{
									case VT_AMBULANCE_NEF:
										wert=fzprio;
										break;
									case VT_AMBULANCE_RTW:
										wert=fzprio+500; // Kompakt-NAW gefunden, lieber NEF oder RTH
										break;
									case VT_AMBULANCE_RHC:
										// RTH merken, aber lieber NEF suchen
										if (childID == 620)
										{
											wert=fzprio;
											i=max; // wenn nur RTH gesucht, dann Suche beenden
										} else if (flugwetter && !nacht)
												wert=fzprio+250;
											else 
												wert=-1;
										break;
								} 
							else if (fzid == rtw)
									wert=1;
								else 
									wert=-1;
						}
						break;
					case 601:	// Kompakt-NAW
						needna=0;
					case 610:	// RTW
					case 611:
					case 612:
						kriterien_erfuellt = false;
						if (FzAF)
						{
							PersonList ra(v.GetName());
							panz=ra.GetNumPersons();
							for(int j=0; j<panz; j++)
							{
								doc=ra.GetPerson(j);
								if (doc.GetEnteredCarID() == v.GetID() || doc.GetEnteredCarID()==-1)
									if (doc.IsDoctor())
										hasna++;
									else 	if (doc.IsParamedicTeam())
											hasra+=2;
										else hasra++; 
							}
						};
						kriterien_erfuellt=((hasra>=needra && hasna>=needna) || !FzAF) && (v.GetNumTransported()==0);
						if (kriterien_erfuellt)
						{	
							if (fzid == rtw)
							{
								wert=1;
								i=max;
								kompakt=(hasna>0 || !FzAF) && kompakt;
							} else {
								if (nachruecken) {
									if (fzort == vorwache)
										wert=1+200*int(v.HasCommand("FlyTo"));
									else
										wert=10+fzprio+200*int(v.HasCommand("FlyTo"));
								} else
									wert=-1;
							}
							System::Log("Ortsgerechte Auswahl zu Wache %u -> Fz %s Wache %u Prio %u Wert %u",vorwache,v.GetName(),fzort,fzprio,int(wert));
						} else 
							wert=-1;
						break;

					case 619:
						if (fzid==rtw)
						{
							wert=1;
							i=max;
						} else
							wert=-1;
						break;
					case 302:
						if (fzid==82)
						{
							wert=1;
							i=max;
						} else
							wert=-1;
						break;
					case 304:
						if (stw.HasNamePrefix("SIMBA") && rtw==0)
						{
							wert=1;
							i=max;
						} else if (isHome)
								wert=1;
							else
								wert=-1;
						break;

					case 311:
						wert=10;
					case 315:
						if (switcher==315)
							wert=-10;
						wblevel=0;
						if (v.IsFirefighter() &&  isHome && (fzid!=62))
						{
							if ((fzstatus[fzid]&FZ_LF)>0)
								wert=1;
							if ((fzstatus[fzid]&FZ_TLF)>0)
								wert=2;
							if ((fzstatus[fzid]&FZ_S)>0)
								wert+=2;
							if ((fzstatus[fzid]&FZ_T)>0)
								wert=5;						
						}
						break;
					case 54:
						wblevel=2;
						wert=5;
						if (v.GetVehicleType()==VT_FIREFIGHTERS_RW)
						{
							if (isHome&&(rtw>0))
								wert=1;
							else
								wert=3;
						} else if (isHome)
								wert=2;
						wert+=fzprio/1000;
						break;
					case 52:
						wert=-1;
						int tank=fzlocal::tankinhalt(&v);
						if (isHome || freiesFz)
						{
							switch (fzstatus[fzid]&(FZ_GTLF|FZ_TLF|FZ_LF))
							{
								case FZ_TLF|FZ_LF:
									if (isHome)
										wert=1+basewert;
									else if ((v.GetNumPassengers()+v.GetFreePassengers())>3)
										wert=2+basewert;
									else 
										wert=6+basewert;
									break;
								case FZ_GTLF|FZ_TLF|FZ_LF:
									if (isHome)
										wert=5+basewert;
									else
										wert=7+basewert;
									break;
								case FZ_LF:
									tank=fzlocal::tankinhalt(&v);
									if (tank>0)
										if (isHome)
											wert=3+basewert;
										else if (tank>1000)
											wert=4+basewert;
										else 
											wert=8+basewert;	
									else
										wert=-100;
									break;
								default:
									wert=-100;
									break;
							}
							if (tank==0)
								wert=-100;
							wert+=fzprio/1000;
							// System::Log("Fucking TSF %s %u %u %u",v.GetName(),int(tank),int(wert*10),fzprio);
						}
						break;
					case 55:
					case 57:
					case 58:
					case 55:
					case 56:
						if (isHome)
							wert=1;
						else
							wert=10+fzprio/1000;
						break;
					case 300:
						wert=1;
						i=max;
						break;
					case 51:
						wert=-1;
						if (isHome || freiesFz)
						{
							switch (fzstatus[fzid]&(FZ_GTLF|FZ_TLF|FZ_LF))
							{
								case FZ_LF:
									if ((v.GetNumPassengers()+v.GetFreePassengers()) >5)
										wert=2+basewert;
									else
										wert=6+basewert;
									
									break;
								case FZ_TLF|FZ_LF:
									if ((v.GetNumPassengers()+v.GetFreePassengers())>3)
										wert=4+basewert;
									else 
										wert=8+basewert;
									break;
								case FZ_TLF|FZ_LF|FZ_GTLF:
									wert=10+basewert;
									break;
								default:
									wert=-100;
									break;
							}
							if (isHome)
								wert-=1;
							wert+=fzprio/1000;
						}
						break;
					case 53:
						wert=-1;
						if (isHome)
							wert=1+fzprio/1000;
						else if (freiesFz)
							wert=fzprio;
						break;
					case 50:
						wert=-1;
						if (isHome)
							wert=1+fzprio/1000;
						else 
							wert=basewert;
						break;
					case 303:
						wblevel=2;
						if (fzort<9)
							wert=1;
						else
							wert=2;
						break;
					case 109:
						if (fzid==109)
							wert=1;
						else
							wert=-1;
					case 104:
						if (v.IsFlagSet(FLAG_TL))
							break;
					case 199:
						if (fzid!=70)
							if (FzAF)
								wert=1;
							else
								wert=2;
						else
							wert=-1;
						break;
					case 110:
						if (FzAF)
							if (v.IsFlagSet(FLAG_TL))
								wert=1;
							else
								wert=-1;
						else wert=2;
						break;
					case 102:
					case 111:
						if (fzstatus[fzid]&FZ_KRIPO>0)
							multi=5.0;
						else
							multi=1.5;
					case 101:
						bool is_fs=v.HasCommand("fs");
						dist=fzlocal::Distanz(v,Target)*multi;
						if (!FzAF && !is_fs)
							dist=dist*2.5;
						if (is_fs)
						{
							if (!no_fs)
							{
								// System::Log("FS checken Distanz %u",int(dist));
								if (dist<2000) 
								{
									stw=v;
									wert=0;
									folge=1;
									i=max;
								}
							} else wert=-1;
						} else 	
							if ((dist < mindist) || !stw.IsValid())
							{
								// System::Log ("PolSelect Fz %s Dist %d",v.GetName(),dist);
								mindist=dist;
								stw=v;
								folge=1;
								wert=0;
							}
						break;
					case 103:
						if (fzstatus[fzid]&FZ_FUNK>0)
							wert=1;
						else 
							wert=2;
						break;
					case 250:
						if (v.GetVehicleType()==VT_TV_HELI)
						{
							wert=1;
							dir=0;
							i=max;
						}
						break;
					default:
						char * buf="                                                       ";
						snprintf(buf,40,"Ungueltige Fz Anforderung %u",childID);
						Mission::PlayHint(buf);
						break;
				}
				if (wert>0)
				{
					if (v.IsCurrentAction("EActionFindPath") || (!v.IsHidden() && v.HasCommand("hidden")))
						if (wert>wblevel)
							wert=wblevel+wert/100;
					if (fzlocal::IsTyp(&v,FZ_RD|FZ_RTH) && !fzlocal::IsTyp(&v,FZ_RD|FZ_ITH))
					{
						if (!flugwetter || nacht)
						{
							if (childID == 620)
							{
								Audio::PlaySample("mod:Audio/fx/kein_hubi.wav");
								Mission::PlayHint("kein_hubi");
							}
							wert=-1;
						}
					}	
					// if (v.IsHidden())
					//	wert+=wert/2;
				}
				// System::Log("Rufe Fz Nr %u Status %u %u %u Dir",i,fzstatus[i],int(wert*1000),int(folge*100),dir);
				// System::Log("Fz einsatzbereit geeignet %u %s Prio %u Wert %u Lev %i Base %i",i, fzlocal::kennung(i),fzpriori[i],int(wert*1000),wblevel,basewert);
				if ((wert<folge) && (wert>-1))
				{
					folge=wert;
					stw=v;
				}				
			}
		}

	  	//Ab hier gehts nur mit einem weiter...

	  	if (!stw.IsValid() || folge==100)
	  	{
			if (dir>0) 
			{
				int rndrange=dir/100000;
				dir=dir%100000;
				if (dir<1000 && rndrange==0)
					rndrange=8;
				if (rndrange>1)
					dir=rand()%rndrange*1000+dir+1000;
				//System::Log("BedarfsFz rufen Code %u Fz %u",switcher,dir);
				dir=dir+200000+childID*1000000;
				fz_kaufen::fz_erstellen(Caller,Target,dir,0,false);
				// Caller->PushActionExecuteCommand(ACTION_INSERT,"kaufen",Target,dir,false);
			} else {
				// System::Log("Kein Fz gefunden zu Code %u %u",rtw,aufruf);
				if (nachruecken && !freiesFz)
					// Caller->PushActionExecuteCommand(ACTION_INSERT,"rufe_winterberg",Target,499000+childID,false);
					fz_rufen(Caller,Target,499000+childID);
			}
		} else {
			// System::Log("Leitstelle Fz gewaehlt %u %s %s %u",childID,stw.GetName(),Target->GetName(),pl_MP);
			if (Game::IsMultiplayer())
				stw.SetPlayerMP(pl_MP);
			if (sofa)
				stw.AssignCommand("sofa");
			else
				stw.RemoveCommand("sofa");

			fzid=fzlocal::fzid(&stw);

			if ((kompakt && stw.IsHidden()) || childID==199 || childID==150)
				stw.SetFlag(FLAG_NA);

			switch (childID)
			{
				case 311:
					Caller->PushActionExecuteCommand(ACTION_INSERT,"rufe_winterberg",Target,rtw*1000+childID,false);
					break;
				case 199:
					Caller->PushActionExecuteCommand(ACTION_INSERT,"rufe_winterberg",Target,199,false);
					break;
				case 601:
					if (!stw.IsFlagSet(FLAG_NA)) 
					{
						Caller->PushActionExecuteCommand(ACTION_INSERT,"rufe_winterberg",Target,602,false);
						childID=611;
					}
					break;
				case 101:
					if (stw.HasCommand("fs")) 
						Caller->PushActionExecuteCommand(ACTION_INSERT,"rufe_winterberg",Target,101,false);
					break;

			}

			if (nachforderung)
			{
				stw.SetUserData(Caller->GetID());
				childID=2048+childID;
			}
			if (zivi)
				childID=4096+childID;

			if (normale_fahrt)
				childID=childID | nfmask;

			if (folgeeinsatz) 
				childID=childID | folgemask;

			if (harry_him(fzid))
				stw.AssignCommand("harry");

			stw.PushActionExecuteCommand(ACTION_NEWLIST,"alarmiere_Winterberg",Target,childID,false);
			if (stw.IsAmbulance()) {
				// System::Log("RD Mittel blockieren %s",stw.GetName());
				stw.PushActionExecuteCommand(ACTION_INSERT,"StatusSenden",Caller,23,false);
			}
		}
	}

	void PushActions(GameObject *Caller, Actor *Target, int childID)
	{

		bool neudispo=(childID & ndmask)>0;
		bool storno=(childID & stmask)>0;

		int cid=childID & noflags;

		// System::Log("Rufe Winterberg %u nd:%u st:%u %s",cid,int(neudispo),int(storno),Target->GetName());
		
		if (neudispo || storno)
		{
			int fzid=cid/1000;
			Caller->PushActionExecuteCommand(ACTION_INSERT,"storno",Caller,0,false);
			if (storno)
				fz_stornieren(fzid);
			else
				fz_rufen(Caller,Target,childID);
		} else 
			fz_rufen (Caller,Target,childID);	
	}

};

object alarmiere_winterberg : CommandScript	
{

	// 2. schritt der Alarmierung : Fz alarmieren

	alarmiere_winterberg()
	{
		SetPriority(400);
	}

	bool CheckTarget(GameObject *Caller, Actor *Target, int childID)
	{
		return true;
	}

	void rdauftrag()
	{
		auftrag++;
		char * fms="                           ";
		char * format[]="RD-Auftrag Nr. %u";
		int x=snprintf(fms,27,format,auftrag);
		Mission::PlayHint(fms);
		Mission::SetCounter("Animal deaths",auftrag);
		System::Log(fms);
	}

	void op_einleiten(Vehicle stw, Actor *Target)
	{
		PathList pal("oppfad");
		Path pf=pal.GetPath(0);
		stw.SetSpeed(4.0);
		stw.SetPosition(pf.GetPoint(pf.GetNumPoints()-1));
		System::Log("OP einleiten fuer %s",Target->GetName());
		Person oppt(Target);
		oppt.PushActionExecuteCommand(ACTION_NEWLIST,"wt_callsek",&stw,-2,false);				
		// oppt.PushActionExecuteCommand(ACTION_APPEND,"op_team",&stw,0,false);
	}

	void fz_belegen (Vehicle stw)
	{
		stw.AssignCommand("ich_bin_nicht_frei");
		if (Game::IsMultiplayer())
		{
			if (stw.GetNumPassengers()>0)
			{
				PersonList pasl=stw.GetPassengers();
				for (int pi=0;pi<pasl.GetNumPersons();pi++)
					pasl.GetPerson(pi)->SetPlayerMP(stw.GetPlayerMP());
			}
		}
	}

	void PushActions(GameObject *Caller, Actor *Target, int childID)
	{
		Vehicle stw(Caller);
		int ptype=1101;		// Dummy
		int cid=0;
		bool siwa=Target->HasNamePrefix("wm_") || childID==305 || childID==306;
		if (siwa) {
			GameObject Trgt=Game::CreateObject("mod:Prototypes/Objects/Equipment/parken.e4p",Caller->GetName());
			GameObject tgob(Target);
			Trgt.SetPosition(Target->GetPosition());
			Trgt.SetRotation(&tgob);
		}
		bool nachforderung=(childID & 2048)>0;
		bool zivi=(childID & 4096)>0;
		bool normale_fahrt=(childID & nfmask)>0 || siwa;
		bool folgeeinsatz=(childID & folgemask)>0;
		bool trauma=false;
		bool bereitstellung=childID==310;
		bool stoppol=false;
		bool fs=stw.HasCommand("fs");
		bool catchem=fs && (Target->GetType()==ACTOR_PERSON || Target->GetType()==ACTOR_VEHICLE);
		bool auto_pa=false;
		bool no_cruise=true;
		bool derrick=stw.HasCommand("harry");

		if (bereitstellung)
		{
			Vehicle stw(Target);
			if (stw.HasCommand("pass_tausch"))
				return;
		}

		fzlocal::status_setzen(&stw,FZ_ALARM);
		
		int childMem=childID;
		childID=childID&2047;

		int fzid=fzlocal::fzid(&stw); // Fz-Typ laut AutosKaufen
		int fzstart=fzlocal::fzort(&stw); // Fz-Standort
		int fzstat=fzstatus[fzid];
		int schleife=9000+fzid;

		if (fzlocal::isModder(&stw))
		{
			int add=0;
			switch (stw.GetVehicleType())
			{
				case VT_AMBULANCE_NEF:
					add=1;
					break;
				case VT_POLICE_GETAWAY:
					add=2;
					break;
				case VT_FIREFIGHTERS_RW:
					add=0;
					break;
			}
			ptype=59960+add;
			normale_fahrt=childID>899;
			no_cruise=false;
		} else
		switch (fzstat&(FZ_POL|FZ_RD|FZ_FW|FZ_TEC))
		{
			case FZ_FW:
				int fzcode=childID%10;

				if (childID==301) 
					ptype=301;
				else if (fzcode>0)
					schleife=5000+fzstart*10+fzcode;
					else schleife-=1000;	
				
				if (childID==619)
					ptype=502;
				else {
					if (fzlocal::isffw(&stw))
						ptype=50;
					else
						ptype=2;
					auto_pa=fzlocal::IsTyp(&stw,FZ_FW|FZ_LF) && (childID%10 != 2);
				}
				if (childID==305 || childID==306)
					schleife=5996; // BSD 
				break;
			case FZ_POL:
				switch (fzstat&(FZ_KRIPO|FZ_SEK|FZ_KMRD|FZ_BW))
				{
					case FZ_KRIPO:
						ptype=103;
						break;
					case FZ_SEK:
						if (fzlocal::IsTyp(&stw,FZ_POL|FZ_STW))
						{
							ptype=31;
						} else
							ptype=30;
						schleife=5810;
						break;
					case FZ_KMRD:
						ptype=16;
						schleife=5800;
						break;
					case FZ_BW:
						ptype=41;
						break;
					default:
						ptype=101;
					break;
				}
				switch (childID)
				{
					case 103:
						schleife=5997;
						break;
					case 110:
						stw.SetFlag(FLAG_NA);
					case 113:
					case 141:
						ptype=102;
					case 105:
					case 111:
					case 112:
						if (childID!=141)
							normale_fahrt=true;
						break;
					case 140:
						stw.AssignCommand("fuehrung");
						break;
					case 160:
						ptype=101;
					case 161:
					case 162:
						schleife=5800;
						break;
				}
				Vehicle polz(Target);
				stoppol=Target->GetType()==ACTOR_VEHICLE && polz.IsCivilCar() && !polz.IsFlagSet(OF_BLOCKED);			
				break;
			case FZ_RD:
				if ((fzstat&FZ_RTH)>0)
					fzstart=101;
				else
					fzstart=100;
				switch (fzstat&(FZ_ITH|FZ_BSW|FZ_RHS|FZ_OP|FZ_RF|FZ_NA))
				{
					case FZ_ITH|FZ_NA:
						if ((fzstat&FZ_SAR)>0)
							ptype=622;
						else 
							ptype=621;
						schleife=9073;
						break;
					case FZ_BSW:
						ptype=10;
						break;
					case FZ_RHS:
						ptype=630;
						break;
					case FZ_OP:
						ptype=84060;
						trauma=true;
						break;
					case FZ_RF:
						ptype=84064;
						trauma=true;
						break;
					case FZ_NA:
						if ((fzstat&FZ_FUEHRUNG)>0) {
							ptype=603;
							break;
						}
					default:
						if (derrick) {
							folgeeinsatz=stw.GetNumPassengers()>0;	
							if (folgeeinsatz)
								ptype=181;
							else
								ptype=191;
						}  else 
							if (zivi)
								ptype=619;
							else
								ptype=610;
						break;
				}
			
				if (childID==655)
					stw.SetFlag(FLAG_NA); // die sieben Samurai
				if (childID>649 && childID<653)
				{
					schleife=5790;
					ptype=childID;
				} else if  (childID>669 && childID<673)
					ptype=childID-20;
				break;
			case FZ_TEC:
				switch (fzstat&(FZ_ELEKTRO|FZ_BAHN|FZ_SWT|FZ_ASF|FZ_FWB|FZ_FUEHRUNG))
				{
					case FZ_BAHN:
						ptype=7;
						break;
					case FZ_ASF:
						ptype=6;
						break;
					case FZ_FWB:
						ptype=307;
						break;
					case FZ_FUEHRUNG:
						ptype=2;
						break;
					default:
						ptype=5;
						break;
				}
				break;
		}

		// Fz in Marsch setzen

		if (!bereitstellung)
			fz_belegen(stw);

		stw.AssignCommand("wird_alarmiert");
		GameObject obj(Target);
		bool bungartarget=obj.HasNamePrefix("bungar");
		Actor ziel;


		System::Log("FZ ALARM %u %u %u %s %u",schleife,fzstart,fzid,stw.GetName(),int(normale_fahrt));

		if (childID > 600 && childID < 651 && !trauma && !folgeeinsatz) 
			rdauftrag();

		if (!folgeeinsatz || derrick) {
			stw.PushActionExecuteCommand(ACTION_NEWLIST,"senden",&stw,schleife,false);
			stw.PushActionWait(ACTION_APPEND,1000.);
		} else if (!derrick) {
			Mission::PlayHint("Alarmierung fuer Folgeeinsatz");
			stw.AssignCommand("folgeeinsatz");
			stw.SetUserData(Target->GetID());
			stw.PushActionExecuteCommand(ACTION_INSERT,"StatusSenden",&stw,103,false);
			return; // verry ugly
		}
	
		if (trauma) {
			// System::Log("Mannschaft rufen für %s Code %u",fz.GetName(),ChildID);
			stw.PushActionExecuteCommand(ACTION_APPEND,"mannschaft_rufen",Target,ptype,false);
			stw.PushActionExecuteCommand(ACTION_APPEND,"StatusSenden",&stw,3,false);
		} else if (!fs)
		{
			if (stw.HasCommand("zugfz"))
				stw.PushActionExecuteCommand(ACTION_INSERT,"zugliste_fz_entfernen",&stw,0,false);
			stw.PushActionExecuteCommand(ACTION_APPEND,"mannschaft_rufen",&stw,ptype,folgeeinsatz);
			if (!bereitstellung)
			{
				if (!derrick || folgeeinsatz)
					stw.PushActionExecuteCommand(ACTION_APPEND,"zugliste_fz",Target,fzstart,false);
				switch (childID)
				{
					case 601:
						if (!stw.IsFlagSet(FLAG_NA))
						{
							stw.PushActionExecuteCommand(ACTION_INSERTAFTERFIRST,"rufe_winterberg",Target,99602,false); // NEF mitalarmieren
							childID=622;
							cid=19292;
						}
						break;
					case 611:
						cid=19292;
						break;
					case 619:
					case 301:
						cid=619;
						break;
					case 621:
						cid=621;
						break
					case 622:
						break;
					case 105:
						stw.AssignCommand("fs");
						fs=true;
						break;
					default:
						// if (siwa)
						//	cid=2011; // Sicherheitswache
						if (auto_pa)
							cid=112; // Feuer 
						else 
							cid = 0;

				}
			} else 
				cid=999;

			if (!derrick || folgeeinsatz)
				stw.PushActionExecuteCommand(ACTION_APPEND,"mannschaft_struktur",Target,cid,false);
				
			if (!bereitstellung)
			{	if (childID==300 || !no_cruise)
					stw.PushActionExecuteCommand(ACTION_APPEND,"StatusSenden",Caller,1,false);
				else
					stw.PushActionExecuteCommand(ACTION_APPEND,"StatusSenden",Caller,3,false);
				if (stw.IsHidden() && fzlocal::nachbar(&stw,3))		// Nachbarfz ausserhalb des Stadtgebietes ?
				{
					float anmarsch=fzlocal::verz(&stw);
					stw.PushActionWait(ACTION_APPEND,anmarsch);
					// System::Log("Extern anfahren verz: %u fz %s",int(anmarsch),stw.GetName());
				}
				
				if (derrick && !folgeeinsatz)
					ziel=docfetch;		
				else {
					stw.RemoveCommand("harry");
					if (nachforderung)
						ziel=Game::GetActor(stw.GetUserData());
					else 
						ziel=*Target;
				}
				if (stoppol)
					stw.PushActionExecuteCommand(ACTION_APPEND,"stoppol",Target,0,false);
				else
					stw.PushActionExecuteCommand(ACTION_APPEND,"fz_raus",&ziel,childID,normale_fahrt);
			}
		}
			
		if (bereitstellung)
			stw.PushActionExecuteCommand(ACTION_APPEND,"StatusSenden",Caller,1,false);
		else if (catchem && !obj.IsFlagSet(OF_BLOCKED)) 
			stw.PushActionExecuteCommand(ACTION_APPEND,"POL_Arrest",Target,0,false);
		else if (childID==661)
			op_einleiten(stw,Target);
		else if (!stoppol && !trauma)
		{
			int code;
			if (bungartarget)
				code=10;
			else
				code=5;
			if (!fs && childID!=250 && no_cruise && (!derrick || folgeeinsatz))
			{
				if (!siwa)
					stw.PushActionExecuteCommand(ACTION_APPEND,"bin_ich_am_ziel",&ziel,code,false);
				stw.PushActionExecuteCommand(ACTION_APPEND,"StatusSenden",Caller,4,false);
				if (siwa) {
					stw.PushActionExecuteCommand(ACTION_APPEND,"GH_place_correct",&ziel,2011,false);			
					stw.AssignCommand("go_wm");
				} else
					stw.PushActionExecuteCommand(ACTION_APPEND,"gf_lage",&stw,0,false);					
			}
	
			if (obj.IsValid() && !obj.IsFlagSet(OF_BLOCKED)) 
			{
				int rdid=0;
				switch (childID) 
				{
					case 601:
					case 620:
					case 602:
					case 654:
						if (derrick && !folgeeinsatz) {
							stw.PushActionExecuteCommand(ACTION_APPEND,"harry",Target,stw.GetUserData(),false);
							stw.PushActionExecuteCommand(ACTION_APPEND,"alarmiere_winterberg",Target,childMem,false);
						} else {
							stw.PushActionExecuteCommand(ACTION_APPEND,"CheckHubiDown",Target,1,false);
							if ((((Target->GetType() == ACTOR_PERSON) && !obj.HasCommand("tl")) || (Target->GetType() == ACTOR_OPEN_HOUSE)) && !obj.HasCommand("alarm_dummy") && stw.IsFlagSet(FLAG_NA))
								stw.PushActionExecuteCommand(ACTION_APPEND,"RD_examine",Target,rdid,false); // NA versorgt Pat
							else 
								if (Target->GetType() == ACTOR_VEHICLE)
								{
									if (!obj.HasCommand("ErwarteNA"))
									{
										obj.AssignCommand("ErwarteNA");
										obj.SetUserData(-1);
									}
									stw.PushActionExecuteCommand(ACTION_APPEND,"TransportBegleiten",Target,0,false);
								} else
									stw.PushActionExecuteCommand(ACTION_APPEND,"EmptyCar",&stw,rdid,false);
						}
						break;
					case 901:
						if (Target->HasNamePrefix("wm_doc")) {
							stw.PushActionExecuteCommand(ACTION_APPEND,"EmptyCar",&stw,0,false);
							stw.AssignCommand("go_wm");
						}
						break
					case 621:
					case 622:
						stw.PushActionExecuteCommand(ACTION_APPEND,"CheckHubiDown",Target,12,false);
						break;
					case 619:
						rdid=619;
					case 611:
					case 610:
					case 653:
					case 655:
						if ((((Target->GetType() == ACTOR_PERSON) && !obj.HasCommand("tl")) || (Target->GetType() == ACTOR_OPEN_HOUSE)) && !obj.HasCommand("alarm_dummy"))
							stw.PushActionExecuteCommand(ACTION_APPEND,"RD_examine",Target,rdid,false); // RA versorgt Patient
   						 else if (Target->GetType() == ACTOR_VEHICLE)
							stw.PushActionExecuteCommand(ACTION_APPEND,"SEG_an_RTW",Target,0,false); // RTW übernimmt vom SEG-Zelt
						else if (Target->HasNamePrefix("wm_"))
							stw.PushActionExecuteCommand(ACTION_APPEND,"EmptyCar",&stw,983,false);
						break;
					case 672:
						stw.PushActionExecuteCommand(ACTION_APPEND,"SetZelt",Target,1,false); // RTW übernimmt vom SEG-Zelt
						break;
					case 670:
						stw.PushActionExecuteCommand(ACTION_APPEND,"EmptyCar",&stw,0,false); // RTW übernimmt vom SEG-Zelt
						break;
					case 700:
				      		if ((Target->GetType() == ACTOR_VEHICLE) || (Target->GetType() == ACTOR_OBJECT))
							stw.PushActionExecuteCommand(ACTION_APPEND,"LoadUp_Freeplay",Target,0,true); // Fahrzeug aufladen
						break;
					case 720:
						GameObject o(Target);
						stw.PushActionExecuteCommand(ACTION_APPEND,"HideTarget",Target,0,false);
						Actor a=Game::GetActor(o.GetUserData());
						Path p(&a);
						stw.PushActionUsePath(ACTION_APPEND,&p,true,p.GetPathSpeed());
						break;
					case 603:
						stw.PushActionExecuteCommand(ACTION_APPEND,"emptycar",&stw,0,false);
						break;
					case 101:
					case 102:
					case 105:
					case 104:
					case 109:
						if (fs)
							stw.PushActionExecuteCommand(ACTION_APPEND,"POL_FS",Target,0,false);
						else {
							Vehicle v(Target);
							if (Target->GetType() == ACTOR_VEHICLE)
								stw.PushActionExecuteCommand(ACTION_APPEND,"TransportBegleiten",Target,0,false);
							else {
								Person tp(Target);
								if ((Target->GetType() == ACTOR_PERSON) && !tp.HasCommand("tl") && !tp.HasName("anrufer"))
									stw.PushActionExecuteCommand(ACTION_APPEND,"POL_arrest",Target,0,false);
							}
						}
						break;
					case 130:
						break;
					case 300:
						stw.PushActionExecuteCommand(ACTION_APPEND,"materialtausch",Target,0,false);
						break;
					case 301:
						stw.PushActionExecuteCommand(ACTION_APPEND,"rufbereitschaft",Target,21,false);
						break;
					case 250:
						stw.PushActionExecuteCommand(ACTION_APPEND,"Disaster_TV",Target,0,false);
						break;
					case 302:
					case 303:
						stw.PushActionExecuteCommand(ACTION_APPEND,"tl_tel_uebernimmt",Target,0,false);
						break;
					case 304:
						stw.PushActionExecuteCommand(ACTION_APPEND,"TLFWaterOn",&stw,0,false);
						break;
				}
			}
		}
	}
};

object fz_raus : CommandScript
{

	bool normale_fahrt=false;

	fz_raus()
	{
		SetPriority(500);
	}

	bool CheckTarget(GameObject *Caller, Actor *Target, int childID)
	{
		normale_fahrt=true;
		return true;
	}

	Vector hier_anfahren (Actor *Target)
	{
		GameObject obj(Target);
		Vector TargetPos;
		if (Target->GetType()==ACTOR_OPEN_HOUSE)
		{
			OpenHouse oh(Target);
			TargetPos=oh.GetEntrancePosition(true,100.0);
		} else if (Target->GetType()==ACTOR_VEHICLE && obj.HasChild("SEGOUT"))
				TargetPos=obj.GetChildPosition("SEGOUT");
			else if (Target->GetType()==ACTOR_PERSON)
				{
					Person pt(Target);
					if (pt.GetEnteredHouseID()>0)
					{
						Actor a=Game::GetActor(pt.GetEnteredHouseID());
						OpenHouse oh(&a);
						TargetPos=oh.GetEntrancePosition(true,100.0);		
					} else 
						TargetPos=Target->GetPosition();
				} else
					TargetPos=Target->GetPosition();
		return TargetPos;	
	}

	void PushActions(GameObject *Caller, Actor *Target, int childID)
	{
		
		// System::Log("Fz raus %s nach %s Code %u SoSi %u",Caller->GetName(),Target->GetName(),childID,int(normale_fahrt));

		GameObject obj(Target);
		int udat=obj.GetUserData();
		int cid=0;
		Vector TargetPos;
		Vehicle stw(Caller);
		char * fz[1];
		bool nachbar=stw.IsHidden() && childID!=-112;
		int sosi;
		bool hasgarage=!nachbar && gate[fzlocal::fzid(Caller)]>0;
		if (hasgarage)
			Actor tor=Game::GetActor(gate[fzlocal::fzid(Caller)]);

		if (nachbar || stw.IsFlagSet(FLAG_FUNK))
			int sosi=5;
		else 
			int sosi=3;
		
		stw.SetFlag(FLAG_FUNK);
		if (stw.HasCommand("folgeeinsatz"))
			stw.RemoveCommand("folgeeinsatz");

		TargetPos=hier_anfahren(Target);
		Game::FindFreePosition(&stw, TargetPos,250);

		stw.SetChildEnabled("pumpe",true);

		stw.EnableSpecialLights(false);
		stw.EnableBreakLights(false);
		if (stw.GetVehicleType()==VT_FIREFIGHTERS_DLK || stw.GetVehicleType()==VT_FIREFIGHTERS_TLF)
			stw.EnableAutoTarget(false);

		if (!normale_fahrt)
		{
			stw.PushActionExecuteCommand(ACTION_INSERT,"WT_SoSi",&stw,sosi,false); 
			stw.PushActionExecuteCommand(ACTION_INSERTAFTERFIRST, "WT_SoSi", &stw, 2, false); 
		}

		switch (childID)
		{
			case 150:
				if (((Target->GetType() == ACTOR_PERSON) || (Target->GetType() == ACTOR_VEHICLE)) && (!obj.HasCommand("alarm_dummy")))
					stw.PushActionHeliFollow(ACTION_INSERTAFTERFIRST,Target);
				stw.PushActionFlyTo(ACTION_INSERTAFTERFIRST, TargetPos,false,-1.0f);
				break;
			case 250:
				stw.PushActionFlyTo(ACTION_INSERTAFTERFIRST, TargetPos,false,-1.0f);
				break;
			case -112:
				TargetPos=mekka.GetPosition();
			default:
				if (stw.HasCommand("FlyTo"))
					stw.PushActionFlyTo(ACTION_INSERTAFTERFIRST,TargetPos,true,135);
				else
					stw.PushActionMove(ACTION_INSERTAFTERFIRST, TargetPos);
				break;
		}
					
		PersonList pass=stw.GetPassengers();
		
		if (!nachbar)
		{
			float wait;
			if (stw.IsPolice())
				wait=1.5;
		
			else if (stw.IsFirefighter())
				wait=4.5;
			else 
				wait=6.0;
			pass.GetPerson(0)->PushActionWait(ACTION_NEWLIST,wait);
			if (!normale_fahrt)
				pass.GetPerson(0)->PushActionExecuteCommand(ACTION_APPEND,"WT_SoSi",&stw,10,false); //Einsatzfahrt
			if (speedfac<1.0)
				pass.GetPerson(0)->PushActionExecuteCommand(ACTION_APPEND,"Doc_Joke",&stw,0,false); //Einsatzfahrt
			if (hasgarage)
				pass.GetPerson(0)->PushActionExecuteCommand(ACTION_APPEND,"torsteuerung",&tor,2,false); //Einsatzfahrt
			pass.GetPerson(0)->PushActionWait(ACTION_APPEND,6.0);
			pass.GetPerson(0)->PushActionExecuteCommand(ACTION_APPEND,"ZiviWeg",&stw,0,false); //Einsatzfahrt
		} else
			pass.GetPerson(0)->PushActionWait(ACTION_NEWLIST,1.0);

		if (stw.IsHidden())
			stw.PushActionExecuteCommand(ACTION_INSERT,"nachbar_holen",pass.GetPerson(0),0,false);


		if (obj.HasCommand("lst_estelle"))
			stw.SetUserData(Target->GetID());

		if (fzlocal::tankinhalt(&stw)>0)
			stw.AssignCommand("wama");
		else
			stw.RemoveCommand("wama");
			
		normale_fahrt=false;	

	}
};


object nachbar_holen : CommandScript
{
	nachbar_holen()
	{
	}

	void PushActions(GameObject *Caller, Actor *Target, int ChildID)
	{
		bool camp=MissionMode;
		if (ChildID<10)
		{
			// System::Log("Anfahrt nutzen %s %s %u",Target->GetName(),Caller->GetName(),ChildID);
			Vehicle stw(Caller);
			int fzort;
			if (ChildID==-1)
				GameObject park(Target);
			else {
				if (ChildID==0)
				{
					fzort=fzlocal::fzort(&stw); // Fz-Standort
					if (fzort > 50)
						fzort=fzort-50;
				} else
					fzort=Target->GetUserData()/10000;
				if (camp)
				{
					if (!ppos[fzort].IsValid()) {
						fzort=0;
						if (Caller->HasCommand("flf") && ppos[1].IsValid())
							fzort++;
					}
		
					camp=false;
				}
				GameObject park=ppos[fzort];
			}
	
			if (park.IsFlagSet(OF_LOCKED))
			{
				// System::Log("Anfahrt reserviert %s %s",park.GetName(),stw.GetName());
				stw.PushActionExecuteCommand(ACTION_INSERT,"nachbar_holen",Target,ChildID,false);
				stw.PushActionWait(ACTION_INSERT,1.0f);
			} else {
				System::Log("Anfahrt frei %s fuer %s",park.GetName(),stw.GetName());
				park.SetFlag(OF_LOCKED);
				stw.SetPosition(park.GetPosition());
				stw.SetRotation(&park);
				stw.Show();
				park.PushActionExecuteCommand(ACTION_NEWLIST,"nachbar_holen",&stw,10,false);
			}
		} else {
			Vehicle v(Target);
			GameObject park(Caller);

			// System::Log("Anfahrt Fz weg ? %s %s",park.GetName(),v.GetName());

			if (!v.IsValid() || v.DistanceXY(&park) > 256.f)
				park.ClearFlag(OF_LOCKED);
			else {
				// System::Log("Anfahrt blockiert %s %s",park.GetName(),v.GetName());
				park.PushActionWait(ACTION_NEWLIST,0.2);
				park.PushActionExecuteCommand(ACTION_APPEND,"nachbar_holen",&v,10,false);
			}		
		}
	}
};

object ZiviWeg : CommandScript
{
	ZiviWeg()
	{
	}

	void PushActions(GameObject *Caller, Actor *Target, int ChildID)
	{
		if (zivi.IsValid() && fzlocal::fzid(Target)==2)
		{
			ActorList al("gate_8821");
			zivi.PushActionMove(ACTION_NEWLIST,al.GetActor(0),TARGET_ANY);
			zivi.PushActionDeleteOwner(ACTION_APPEND);
		}
	}
};

object ResetSpeed : CommandScript
{
	ResetSpeed()
	{
	}

	bool CheckTarget(GameObject *Caller, Actor *Target, int ChildID)
	{
		return true;
	}
	
	void PushActions(GameObject *Caller, Actor *Target, int ChildID)
	{
		Vehicle stw(Target);
		switch (stw.GetVehicleType())
		{
			case VT_AMBULANCE_RHC:
			case VT_POLICE_PHC:
			case VT_FIREFIGHTERS_FMB:
			case VT_THW_FGRT_BH:
			case VT_TV_HELI:
				System::Log("Reset speed verweigert %s",stw.GetName());
				break;
			default:
				stw.SetSpeed(civspeed);
				break;
		}
	}
};

// ABSCHNITT : GO HOME
//
//

const char DUMMY_HASWARNINGLIGHTS[] = "DUMMYHasWarningLights";
const char DUMMY_DISABLE[] = "WT_SoSi";

object gohome_winterberg : CommandScript
{

	gohome_winterberg()
	{
	}

	bool keine_abfahrt (Vehicle *v)
	{
		bool notok=(v->GetNumPassengers() == 0 && v->GetVehicleType()!=VT_POLICE_GETAWAY) || (v->HasCommand("ErwarteNA") && v->GetNumTransported()>0) || (v->HasChild("rettboot") && !v->IsChildEnabled("rettboot"));
		return notok;
	}

	bool SchlauchDran (Vehicle *v)
	{
		bool dran=false;

		if (v->GetVehicleType() == VT_FIREFIGHTERS_GTF)
		{
			PersonList pl(ROLE_SQUAD);
			Person fw;
			for (int i=0; i<pl.GetNumPersons() && !dran;i++)
			{
				fw=pl.GetPerson(i);
				if (fw.GetFirehoseID()!=0)
					dran=v->IsUsingConnector(&fw);
			}
			if (dran)
				Mission::PlayHint("WIB_HOSE_CONNECTED");
		}
		return dran;
	}

	void Reset_Childs(Vehicle *v)
	{
		if (v->HasCommand("DUMMYHasMast"))
			v->PushActionExecuteCommand(ACTION_APPEND,"Funkmast",v,0,false);
		if (v->HasChild("NA"))
			v->SetChildEnabled("NA",false);
		if (v->HasChild("POL"))
			v->SetChildEnabled("POL",false);
		if (v->HasChild("winde"))
		{
			v->SetChildEnabled("winde1",true);
			v->SetChildEnabled("winde",true);
			v->SetChildEnabled("winde2",true);
			v->AssignCommand("gf_winde");
			v->AssignCommand("gf_winde_weg");
			v->AssignCommand("gf_winde_stop");
			v->AssignCommand("gf_winde_pull");
		}
		// if (v->HasChild("pumpe"))
			v->SetChildEnabled("pumpe",true);
		

		v->EnableBlinker(BLT_NONE);
		v->RemoveCommand(DUMMY_HASWARNINGLIGHTS);

		v->EnableTrafficLight(TLT_NONE);
		v->EnableSpecialLights(false);
		v->ClearFlag(OF_LOCKED);
	}

	int jetzt_heimfahren(Vehicle *v, Actor *Target, int childID,bool camp)
	{
			int cid=0;
			v->PlayAnimCloseDoor(DAT_EQUIPMENT,0.5);			
			switch(v->GetVehicleType())
			{
				case VT_AMBULANCE_RTW :
				case VT_AMBULANCE_NEF :
				case VT_AMBULANCE_RHC :	
				case VT_THW_FGRT_BH :
					if (fzlocal::IsTyp(v,FZ_RD|FZ_BSW))
					{
						if (v->GetNumTransported()>0)
							Mission::PlayHint("WIB_FRIEDHOF");
					} else if (v->HasNamePrefix("SEGKTW")) {
						PersonList pl(v->GetName());
						if (v->GetNumPassengers()!=pl.GetNumPersons())
						{				
							// System::Error("vom KH zur EStelle zurueck.");
							v->PushActionExecuteCommand(ACTION_APPEND,"seg_ktw_estelle",v,0,true);
							cid=-1;
							break;
						}
					}


					if (v->GetNumTransported() > 0 && (!fzlocal::IsTyp(v,FZ_RD|FZ_BSW) || !fzlocal::nachbar(v,2)))
					{
						// System::Log("%s Transported %u pat",v->GetName(),v->GetNumTransported());
						v->PushActionExecuteCommand(ACTION_APPEND,"IRLeuchte",v,1,false);
						v->PushActionExecuteCommand(ACTION_APPEND,"zum_krankenhaus",v,0,false);
						cid=-1;
					} else {
						v->PushActionExecuteCommand(ACTION_APPEND,"IRLeuchte",v,2,false);
						cid=0;		// nicht absitzen
					}
					
					if (v->IsFlagSet(FLAG_NA) && v->GetNumTransported()==0)
					{
						//Leeres NEF bekommt am KH einen neuen NA...
						PersonList persons = v->GetPassengers();
						bool HasNA=(childID==0815||childID==19291);
						for(int j=0; j<persons.GetNumPersons(); j++)
						{
							HasNA=(HasNA || persons.GetPerson(j)->IsDoctor()); //Ist ein NA an Bord?
						}
						if (!HasNA && childID>-1)
						{
							v->PushActionExecuteCommand(ACTION_APPEND, "NEF_zum_KH", Target, childID, false);
							cid=-1;
						} else
							cid=0;
					}

					if (v->IsChildEnabled("INFEKT") || childID==-112)
						cid=6;
					break;
				case VT_POLICE_STW:
				case VT_POLICE_MTW:
					if (childID==19292)
					{
						v->PushActionExecuteCommand(ACTION_APPEND, "NEF_zum_KH", Target, childID, false);
						cid=-1;
					}
					break;
				case VT_FIREFIGHTERS_ASF:
					if (v->HasCommand("EmptyCar")) {
						v->PushActionReturnToBase(ACTION_NEWLIST);
						cid=-1;
					}
					break;
				case VT_FIREFIGHTERS_FMB:
					// System::Log("GoHome Check FMB %s",v->GetName());
					if (v->HasCommand("isbeiboot"))
						v->PushActionExecuteCommand(ACTION_NEWLIST,"beiboot_auf",Target,0,false);
					else 
						fzlocal::wache_anlegen(v);
					cid=-1;
					break;
				case VT_FIREFIGHTERS_FLB:
					if (v->HasChild("rettboot")) {
						if (!v->IsChildEnabled("rettboot"))
							cid=-1;
						else
							cid=0;
					} else
						cid=0;
					// System::Log("GoHome Check FLB %s | %u",v->GetName(),-cid);
					break;
				case VT_FIREFIGHTERS_TLF:
					v->EnableAutoTarget(false);
					break;
			}
			return cid;
	}

	void toranfahrt (GameObject *Caller, GameObject *tor, GameObject *park)
	{
		// System::Log("Tor anfahren %s %s",tor->GetName(),park->GetName());
		float rot[9];
		// float childRot[9];
		park->GetRotation(rot[0], rot[1], rot[2], rot[3], rot[4], rot[5], rot[6], rot[7], rot[8]);
		Vector pos1; Vector pos2;
		Vector a,b;
		park->GetOrientedBBoxPoint(1,pos1.x,pos1.y,pos1.z);
		park->GetOrientedBBoxPoint(2,pos2.x,pos2.y,pos2.z);
		Caller->GetOrientedBBoxPoint(0,a.x,a.y,a.z);
		Caller->GetOrientedBBoxPoint(1,b.x,b.y,b.z);
		a=a-b;
		int len=a.GetLen();
		if (len<0)
			Mission::PlayHint("Negative Vektorlaenge");
		pos2.x=(pos2.x+pos1.x)/2; pos2.y=(pos1.y+pos2.y)/2;
		Vector shift(len,0,0);
		Math::RotateVector(shift.x,shift.y,shift.z,rot);
		Caller->PushActionMove(ACTION_APPEND,pos2+shift);
		Caller->PushActionMove(ACTION_APPEND,pos2+shift+shift);
		Caller->PushActionExecuteCommand(ACTION_APPEND,"drehen",park,0,false);
		if (tor->IsValid())
		{
			Caller->PushActionExecuteCommand(ACTION_APPEND,"torsteuerung",tor,11,false);
			Caller->PushActionWait(ACTION_APPEND,2.0);
		}
		// System::Log("Toranfahrt Ende");
	}

	void PushActions(GameObject *Caller, Actor *Target, int childID)
	{
		bool forcego=Input::LCtrlPressed();
		Vehicle v(Caller);
		bool go_wm=childID==2011;
		// System::Log("Go home mit Code %u",childID);
		bool nachbarfz=fzlocal::nachbar(&v,1) && (childID!=-112);
		bool bedarfsfz=fzlocal::nachbar(&v,2);
		bool camp=MissionMode;		
		const char * parken[2];
 		int fzid;
		int cid=0;
		

		if (forcego)
			childID==-1;		

		v.PushActionWait(ACTION_NEWLIST,0.1);
		metronom.PushActionExecuteCommand(ACTION_INSERT,"WitchDocAction",Caller,0,false);
		
		// System::Log("Go home %s start",v.GetName());
		fzlocal::fz_beladen(&v,false,false);

		if (keine_abfahrt(&v) || SchlauchDran(&v))	// Fz nicht ohne sein Personal wegfahren lassen, NEF darf ins KH folgen
			return;
		// System::Log("Go home %s wird durchgefuehrt CID %u",v.GetName(),childID);

		Reset_Childs (&v);
 
		v.SetFlag(OF_HAS_FIRE_EXTINGUISHER);

		v.PushActionExecuteCommand(ACTION_APPEND,"zugliste_fz_entfernen",&v,0,false);

		if (v.IsFlagSet(FLAG_TL))	// kein EL-Fz aber EL an Bord
		{
			v.ClearFlag(FLAG_TL);
			v.RemoveCommand("sofa");
		}


		if (v.GetVehicleType() == VT_THW_FGRR_BKF)
			v.PushActionDeinstall(ACTION_INSERT);
		if (v.HasCommand("PatAnmelden"))
			v.PushActionExecuteCommand(ACTION_APPEND,"BettFrei",&v,1,false);

		v.PushActionExecuteCommand(ACTION_APPEND,"ActionStopSound",&v);
		
			GameObject park;

			int dir;
			dir=fzlocal::fzort(&v);
			if (dir>50)
				dir=dir-50;
			fzid=fzlocal::fzid(&v);
						
			if (go_wm)
				park=fzlocal::finde_wache(&v);
			else if (fzlocal::nachbar(&v,3) && childID!=-112)
				park=ppos[dir];
			else {			
				parken[1]= fzlocal::kennung(fzid);
				GameObjectList ol(parken[1]); 
				if (ol.GetNumObjects() > 0) 
					park=ol.GetObject(0);
				else if (MissionMode)
						park=ppos[0];
					else
						System::Error("Ungueltiger Fz_Standort fuer /%s/ : /%s/",v.GetName(),parken[1]);
			}

			//Wo soll das Fahrzeug parken?

			v.PushActionExecuteCommand(ACTION_APPEND, DUMMY_DISABLE, &v, 1, false);
			v.PushActionLightOn(ACTION_APPEND,false);

			bool rueckfahrwarnung = false;  // erstmal für alle an

			cid=jetzt_heimfahren(&v,Target,childID,camp);

			if (cid<0)
				return;			
			int tlim=0;
			bool frei=false;
			bool trans=false;
			bool teamok=(v.GetFreePassengers()==0) || fzid==40;
			bool reparieren=(childID==60);
			GameObjectList ol=v.GetCarriedObjects();

			trans=(ol.GetNumObjects() > 0 || v.GetNumTransported() > tlim) && !reparieren &&v.GetVehicleType()!=VT_AMBULANCE_RHF;  // es wird nix transportiert
			teamok=(teamok || ((v.GetVehicleType()==VT_AMBULANCE_RTW) && (v.GetFreePassengers() < 2)) || ((v.GetVehicleType()==VT_POLICE_STW) && (v.GetFreePassengers()<3))); // Mannschaft komplett
			frei=(!trans && ((v.GetEnergy()/v.GetMaxEnergy()) > 0.5) && teamok && !reparieren && cid!=6); // Fz nicht schwer beschaedigt

			// System::Log("gohome : %s Transport %u TeamOK %u Frei %u Zielpunkt %s nachbar %u",v.GetName(),int(trans),int(teamok),int(frei),park.GetName(),int(nachbarfz)); 			

			v.PushActionExecuteCommand(ACTION_APPEND,"Geraete_entfernen",Caller,0,false);
			v.RemoveCommand("ErwarteNA");

			bool hasgarage=gate[fzid]>0 && !go_wm;
			if (hasgarage)
			{
				Actor tora=Game::GetActor(gate[fzid]);
				GameObject tor(&tora);
			} else 
				GameObject tor;

			if (childID!=110)
			{
				if (frei)
					Caller->PushActionExecuteCommand(ACTION_APPEND,"FzFrei",Caller,0,false);
				else if (trans)
					Caller->PushActionExecuteCommand(ACTION_APPEND,"StatusSenden",Caller,7,false);
				else 
					Caller->PushActionExecuteCommand(ACTION_APPEND,"StatusSenden",Caller,6,false);
			}
				
			rueckfahrwarnung=(fzid == 5 || fzid == 4 || fzid == 2 || fzid==6);

			if (Caller->HasCommand("FlyTo"))
				v.PushActionFlyTo(ACTION_APPEND,park.GetPosition(),(!bedarfsfz && !nachbarfz),135);
				// wenn stammfz, dann am ziel landen
			else {
				PersonList fahrer=v.GetPassengers();
				if (fahrer.GetNumPersons()>0)
					fahrer.GetPerson(0)->PushActionExecuteCommand(ACTION_INSERT,"normale_fahrt",&v,0,false);
				if (!nachbarfz && !go_wm)
				{
					toranfahrt (Caller,&tor,&park);
					if (rueckfahrwarnung)
						if (v.IsAmbulance())
							Caller->PushActionExecuteCommand(ACTION_APPEND,"ActionMotorSound",Caller,41,false);
						else
							if (fzid==5)
								Caller->PushActionExecuteCommand(ACTION_APPEND,"ActionMotorSound",Caller,42,false);
							else
								Caller->PushActionExecuteCommand(ACTION_APPEND,"ActionMotorSound",Caller,4,false);
					Caller->PushActionExecuteCommand(ACTION_APPEND,"VCmdWarningLights",Caller,1,false);
				}

				Caller->PushActionMove(ACTION_APPEND,park.GetPosition(),true); // Einparken

				if (!nachbarfz)
				{
					if (!go_wm)
					{
						if (rueckfahrwarnung)
							Caller->PushActionExecuteCommand(ACTION_APPEND,"ActionStopSound",Caller,0,false);
						Caller->PushActionExecuteCommand(ACTION_APPEND,"VCmdWarningLights",Caller,2,false);
					}
					Caller->PushActionExecuteCommand(ACTION_APPEND,"GH_place_correct",&park,0,false);
				}
			}

			if (!go_wm) {

				bool indiewache=!v.IsFirefighter() || !KatSZustand;
		
				if (Caller->HasCommand("feierabend") && childID!=-112)
					Caller->PushActionExecuteCommand(ACTION_APPEND,"Teilzeit",&metronom,1,false);
				else
					if (indiewache && cid!=6)
						Caller->PushActionExecuteCommand(ACTION_APPEND,"StatusSenden",Caller,2,false);

				switch(v.GetVehicleType())
				{
					case VT_FIREFIGHTERS_ASF:
						Caller->PushActionExecuteCommand(ACTION_APPEND,"Wib_Unload",Caller,0,false);
					default : 
						cid=1;	// immer absitzen
						break;
				}
	
				if (bedarfsfz)
				{
					if (v.GetNumTrainWaggons()>0)
						Caller->PushActionExecuteCommand(ACTION_APPEND,"anhaenger_weg",Caller,0,false);
					
					Caller->PushActionWait(ACTION_APPEND,5.0);
					Caller->PushActionDeleteOwner(ACTION_APPEND);
				
				} else {
					if (nachbarfz)
						Caller->PushActionShowHide(ACTION_APPEND,true);
					if (indiewache)
					{	
						Caller->PushActionExecuteCommand(ACTION_APPEND,"WacheAussteigen",Caller,cid,false);
						if (hasgarage)
							Caller->PushActionExecuteCommand(ACTION_APPEND,"torsteuerung",&tor,2,false);			
						Caller->PushActionExecuteCommand(ACTION_APPEND,"tank_fuellen",Caller,0,false);
						if (childID==-112)
							Caller->PushActionExecuteCommand(ACTION_APPEND,"Teilzeit",&metronom,2,false);				
						Caller->PushActionExecuteCommand(ACTION_APPEND,"FzInspektion",&autohaus,childID,false);
					}
				}
				// System::Log("Zugobjekte entfernen %s",Caller->GetName());
				GameObjectList zl;
				zl=Game::GetGameObjectsWithPrefix("ZUG");
				for (int zc=0;zc<zl.GetNumObjects();zc++)
					if (Caller->GetID()==zl.GetObject(zc)->GetUserData())
						Game::RemoveGameObject(zl.GetObject(zc));
				// System::Log("Zugobjekte entfernen %s Ende",Caller->GetName());
			}
		// }
	}
};

object GH_place_correct : CommandScript
{

	GH_place_correct()
	{
	}

	void PushActions(GameObject *Caller, Actor *Target, int ChildID)
	{
		GameObject tob(Target);
		Caller->SetPosition(Target->GetPosition());
		Caller->SetRotation(&tob);
		if (ChildID==1)
			Caller->PushActionExecuteCommand(ACTION_NEWLIST,"EmptyCar",Caller,0,true);
		if (ChildID==2011)
			Caller->SetUserData(Target->GetID());
	}
};

object WacheAussteigen : CommandScript
{

	WacheAussteigen()
	{
	}

	void ExitOnMap(GameObject *Caller, Actor *Target, int ChildID)
	{
		bool docsep=false;
		Actor docplace;
		Actor entry;
			
		
		int fzid=fzlocal::fzid(Caller);
		if (!fzlocal::nachbar(Caller,3))
			switch (fzid)
			{
				case 39:
				case 15:
					entry=bungarext::actor_get("tor5");
					break;
				case 7:
				case 8:	
				case 9:
				case 10:
					entry=bungarext::actor_get("police_entry");
					break;

				case 1:
					docsep=!MissionMode;
					docplace=bungarext::actor_get("trauma1");
				case 2:
				case 14:
				case 27:
					entry=bungarext::actor_get("rwache");
					break;
				case 105:
					entry=bungarext::actor_get("bw_sani");
					break;
				case 109:
					entry=bungarext::actor_get("FJwache");
					break;
				default:
					entry=bungarext::actor_get(Caller->GetName());
					break;
			}
		else
			entry=bungarext::actor_get(Caller->GetName());

		Vehicle v(Caller);
		PersonList pl=v.GetPassengers();
		PersonList tl=v.GetTransports();
		bool nix=false;
		bool IsKompakt=v.GetVehicleType()==VT_AMBULANCE_RTW;
		bool keine_hunde=v.GetVehicleType()!=VT_AMBULANCE_RHF;
		int tn=tl.GetNumPersons();
		switch (fzid)	
		{
			case 95:
//				tn=0;
				break;
		}
		Person p,t;

		if (IsKompakt || v.IsPolice())
			v.ClearFlag(FLAG_NA);


		PersonList count(v.GetName());
		// System::Log("Wache absitzen %s im Fz %u Prs %u Trans %u",v.GetName(),v.GetNumPassengers(),count.GetNumPersons(),v.GetNumTransported());

		switch (ChildID)
		{
			default:
				for (int i=0; i<pl.GetNumPersons(); i++)
				{
					p=pl.GetPerson(i);
					if (docsep)
						if (p.IsDoctor())
							entry=docplace;
					
					p.PushActionLeaveCar(ACTION_NEWLIST,Caller);
					if (tn>0)
						p.PushActionWait(ACTION_INSERT,1.5);
					if (p.HasCommand("tl") && keine_hunde)
						p.PushActionExecuteCommand(ACTION_APPEND,"tl_aufsitzen",Caller,0,false);
					if (tn>0)
					{
						tn--;
						t=tl.GetPerson(tn);
						if (!t.IsCarried()) //Gangster oder Hund ?
						{
							t.PushActionLeaveCar(ACTION_NEWLIST, Caller);
							nix=t.SetBehaviour(BEHAVIOUR_GANGSTER_CIVILUNARMED);
							nix=!v.IsHidden();
							t.PushActionWait(ACTION_APPEND, 5.f);
							if (nix) 
							{
								p.PushActionMove(ACTION_APPEND, &t, TARGET_FOLLOW);
								p.PushActionArrest(ACTION_APPEND, &t,false);
							} else
							 	t.PushActionDeleteOwner(ACTION_APPEND);
						}
					}
					

					if (!v.IsHidden() && entry.IsValid())
						p.PushActionMove(ACTION_APPEND,&entry,TARGET_ANY);

					if (nix || p.IsCarryingPerson())
					{
						// System::Log("Person abladen %s",p.GetName());
						p.PushActionPutInBase(ACTION_APPEND);
					}
					p.PushActionDeleteOwner(ACTION_APPEND);
					nix=false;
				}
				if (fzlocal::IsTyp(&v,FZ_POL|FZ_STREIFE))
					p.PushActionExecuteCommand(ACTION_INSERTBEFORELAST,"Patrouille_frei",&v,15,false);
				break;
		}
	}

	void ExitNachbar(GameObject *Caller)
	{
		Caller->PushActionPutInBase(ACTION_INSERT);
		Vehicle v(Caller);
		PersonList pl=v.GetPassengers();
		for (int i=pl.GetNumPersons();i>0;i--)
		{
			v.RemovePassenger(pl.GetPerson(i-1));
			pl.GetPerson(i-1)->PushActionDeleteOwner(ACTION_NEWLIST);	
		}
		PersonList pl=v.GetTransports();
		for (int i=pl.GetNumPersons();i>0;i--)
		{
			v.RemoveTransport(pl.GetPerson(i-1));
			pl.GetPerson(i-1)->PushActionDeleteOwner(ACTION_NEWLIST);	
		}
	}


	void PushActions(GameObject *Caller, Actor *Target, int ChildID)
	{
		// System::Log("Absitzen Name : %s  Hidden : %u  OnMap : %u", Caller->GetName(),int(Caller->IsHidden()),int(Caller->IsInsideMap()));
		if (Caller->IsHidden() || !Caller->IsInsideMap())
			ExitNachbar(Caller);
		else
			ExitOnMap (Caller,Target,ChildID);
		Caller->ClearFlag(FLAG_FUNK);
		Caller->ClearFlag(FLAG_TL);

		Vehicle v(Caller);
		bool wib=fzlocal::fzort(Caller)==0 && v.IsFirefighter();
		fzlocal::fz_beladen(Caller,wib,true);
	}
};

object FzFrei : CommandScript
{
	FzFrei()
	{
	}

	void PushActions(GameObject *Caller, Actor *Target, int childID)
	{
		switch (childID)
		{
			case 0:
				Caller->PushActionExecuteCommand(ACTION_INSERT,"StatusSenden",Caller,1,false);
				break;
			case 1:
				Caller->SetFlag(FLAG_FUNK);
				break;
			case 2:
				Caller->PushActionExecuteCommand(ACTION_INSERT,"StatusSenden",Caller,22,false);
				break;
		}
		PersonList pl(Caller->GetName());
		for (int px=0;px<pl.GetNumPersons();px++)
			if (!pl.GetPerson(px)->HasCommand("tl"))
				pl.GetPerson(px)->SetUserData(0);
		Caller->RemoveCommand("ich_bin_nicht_frei");	
	}
};

int inj_squad=0;
int dead_squad=0;
bool countdown=5;

object Fine : CommandScript
{
	Fine()
	{
	}

	void fine_it(int q,int val, int code)
	{
		char *buf="                       ";
		switch(code)
		{
			case 1:
				Game::GetGameString("WIB_FINE_INJ",buf,25);
				break;
			case 2:
				Game::GetGameString("WIB_FINE_DEAD",buf,25);
				break;
		}
		Vector hier=Game::GetCommandPos();
		int id=Game::ShowEvent(buf,hier);
		Game::SetEventFinished(id,true,val*q);
	}

	void fine_squad_inj()
	{
		int a=Mission::GetCounter("Squad injuries");
		int b=Mission::GetCounter("Squad deaths");
		if (a>inj_squad)
		{
			fine_it(a-inj_squad,-150,1);
			inj_squad=a;
		}
		if (b>dead_squad)
		{
			fine_it(b-dead_squad,-500,2);
			dead_squad=b;
		}
	}
	void PushActions(GameObject *Caller, Actor *Target, int step)
	{
		// System::Log("Fining Squad Injuries and deaths");
		fine_squad_inj();
	}
};

int rwacheid;
int klinikid;
int lst_id;
int bwid;
int fjid;
Actor mekka;
Actor docfetch;
GameObject FzManager;
bool MissionMode=false;

const char * CounterCode[5];
CounterCode[0]="Animal deaths";
CounterCode[1]="Injured Persons";
CounterCode[2]="Squad Vehicles";
CounterCode[3]="Burning Objects";
CounterCode[4]="Squad Injuries";

object CoreInit : CommandScript
{
	CoreInit()
	{
	}

	void PushActions(GameObject *Caller, Actor *Target, int step)
	{
		System::Log("Core Init Stufe %u",step+1);
		bool campaign=step>9;

		switch (step)
		{
			case 0:
			case 11:
				FzManager=Game::CreateObject("mod:Prototypes/Objects/Equipment/marker.e4p","FzManager");
				FzManager.PushActionWait(ACTION_NEWLIST,1.0);
				if (campaign)
				{
					System::Log("Campaign Init 1");
					MissionMode=true;
					fallback=bungarext::obj_get("anfahrt");
					ppos[1]=bungarext::obj_get("simbago");
					ppos[0]=fallback;
					System::Log("Campaign 1 Ende");
				} else {
					MissionMode=false;
				}
				
				autohaus=bungarext::obj_get("neuwagen");
				if (!autohaus.IsValid())
					autohaus=fallback;
				mekka=bungarext::actor_get(mekkaname);
				docfetch=bungarext::actor_get("docfetch");
				// metronom=bungarext::obj_get(metronam);
				metronom=Game::CreateObject("mod:Prototypes/Objects/Equipment/parken.e4p",metronam);
				if (metronom.IsValid()) {
					metronom.ClearFlags();
					metronom.PushActionWait(ACTION_NEWLIST,5.0);
				} else 
					metronom=bungarext::obj_get("anfahrt");

				bool goon=true;
				char *name;
				char *dist;
				verzfakt=atoi(fzlocal::xmlval("MAPVZ",1,5))*1.0;
				System::Log("VerzFaktor %u",int(verzfakt));
				strcpy (logtext,"WEM4 8 FMS-Log");
				for (int i=1;goon;i++)
				{
					name=fzlocal::xmlval("MAPIN",i,15);
					goon=(StrCompare("ende",name)!=0) && (i<50);
					if (goon)
					{
						dist=fzlocal::xmlval("MAPIT",i,4);
						verz[i]=atoi(dist)/20.0;
						GameObjectList ol(name);
						System::Log("Parkplatz Init %s %u Distanz -%s- km = %u",name,ol.GetNumObjects(),dist,int(verz[i]*100));
						if (ol.GetNumObjects()>0)
							ppos[i]=ol.GetObject(0);
						else {
							ppos[i]=fallback;
							if (!MissionMode)
	  							System::Log("Parkplatzobjekt fehlt %s",name);
						}
					}
				}
 
				System::Log("Parkplatz Init abgeschlossen mit %u Anfahrten",i-1);

				for (int i=1;i<MAX_FZ;i++)
					fzstatus[i]=0;

				goon=true;
				for (int i=0;goon;i++)
				{
					name=fzlocal::xmlval("MAPPT",i+1,15);
					goon=(StrCompare("ende",name)!=0) && (i<MAXPAT);
					if (goon)
						skennung[i]=name;
				}
				MAXPAT=i-1;
				System::Log("Patrouillenpfade eingelesen : %u Routen",MAXPAT);

				FzManager.AssignCommand("rd102");
				FzManager.AssignCommand("rd114");
				FzManager.AssignCommand("rd123");
				FzManager.AssignCommand("rd124");
				FzManager.AssignCommand("rd122");
				FzManager.AssignCommand("rd125");
				FzManager.AssignCommand("rd166");
				FzManager.AssignCommand("rd190");
				FzManager.AssignCommand("rd167");
				FzManager.AssignCommand("rd189");
				FzManager.AssignCommand("rd193");
				FzManager.AssignCommand("rd192");
				FzManager.AssignCommand("rd158");
				FzManager.AssignCommand("rd185");
				FzManager.AssignCommand("rd188");
				FzManager.AssignCommand("rd205");
				FzManager.AssignCommand("rd127");
				FzManager.AssignCommand("rd140");
				FzManager.AssignCommand("rd101");
				FzManager.AssignCommand("rd126");
				FzManager.AssignCommand("rd165");
				FzManager.AssignCommand("rd121");
				FzManager.AssignCommand("rd186");
				FzManager.AssignCommand("rd160");
				FzManager.AssignCommand("rd191");
				FzManager.AssignCommand("rd194");
				FzManager.AssignCommand("rd132");
				FzManager.AssignCommand("rd112");
				FzManager.AssignCommand("rd148");
				FzManager.AssignCommand("rd187");
				FzManager.AssignCommand("rd175");
				FzManager.AssignCommand("rd244");
				FzManager.AssignCommand("rd195");
				FzManager.AssignCommand("rd173");
				FzManager.AssignCommand("rd183");
				FzManager.AssignCommand("rd208");

				break;
			case 1:
			case 10:
			case 100:
				PersonList al("5tongeber");
				fug=al.GetPerson(0);
				zug=false;
				zf=false;
				civspeed=7.5;
				traeger=-1;
				fug.PushActionWait(ACTION_NEWLIST,1.0);
				int go=0;
				if (step==10)
					go=1;
				else if (step==100)
					go=666;
				bool streifen=go!=666;

				if (metronom.IsValid())
					metronom.PushActionExecuteCommand(ACTION_INSERT,"CheckWTDInit",&metronom,go,false);

				char * code="000";
				Game::GetGameString("DOC_FMS",code,3);
				if (int(code[0])!=49)
					fug.PushActionExecuteCommand(ACTION_INSERT,"fms_umschalten",Caller,0,false);
				Game::GetGameString("DOC_FAE",code,3);
				if (int(code[0])!=49)
					fug.PushActionExecuteCommand(ACTION_INSERT,"alarm_umschalten",Caller,0,false);
				Game::GetGameString("DOC_WIBCAM",code,3);
				if (!Game::IsMultiplayer() && int(code[0])==49)
					fug.PushActionExecuteCommand(ACTION_INSERT,"WibCam",Caller,0,false);

				Game::GetGameString("DOC_COUNTER",code,3);
				Game::SetNavigatorCounter(CounterCode[int(code[0])-48]);

				Game::GetGameString("DOC_SNOW",code,3);
				fug.PushActionExecuteCommand(ACTION_INSERT,"schneeaus",Caller,int(code[0]),false);
				Game::GetGameString("FZLADFIX",fzladfix,25);
				System::Log("Fixbeladung einlesen %s",fzladfix);
				
				code="     ";
				Game::GetGameString("FZSPEED",code,5);
				System::Log("SpeedFactor einlesen %s",code);
				if (atof(code)<5)
					speedfac=1.5;
				else
					speedfac=atof(code)/10;

				for (int i=0;i<maxfae;i++)
					zfae[i]=true;

				if (streifen)
				{
					int test=FZ_POL|FZ_STREIFE;
					int x=0;
					for (i=0;i<MAX_FZ;i++)
						if ((fzstatus[i]|test)==fzstatus[i])
						{
							x++;
							Actor a=Game::GetActor(fzactor[i]);
							// System::Log("Auf Streife schicken %s",a.GetName());
							Vehicle pol(&a);
							pol.PushActionExecuteCommand(ACTION_NEWLIST,"Fahre_Patrouille",&pol,x*20,false);
						}
					fzlocal::lager_fuellen();
				}
				klinikid=bungarext::actor_init("klinik");
				rwacheid=bungarext::actor_init("rw08");
				lst_id=bungarext::actor_init("leitstelle");
				bwid=bungarext::actor_init("bwrd");
				fjid=bungarext::actor_init("BW_FJ");
				System::Log("Stufe 2 Abgeschlossen");
				break;
		}
	}
};

object Fuhrpark_init : CommandScript
{
	Furhpark_init()
	{
	}

	void PushActions(GameObject *Caller, Actor *Target, int step)
	{
		System::Log("Fuhrpark Init Start");
		bool goon=true;
		char *name="      ";
		char * buf="      ";
		GameObject fza(Target);

		for (int i=1;goon;i++)
		{
			name=fzlocal::xmlval("MPFZG",i,6);
			// System::Log("Fz beschaffen : Fz %u %s",i,name);
			goon=(StrCompare("ende",name)!=0) && (i<200);
			if (goon)
			{
				int code=atoi(name);
				fz_kaufen::fz_erstellen(Caller,Target,code,i,false);
				snprintf(buf,6,"fza%u",100+i);
				fza.AssignCommand(buf);
			} else {
				char *buf="                                                                                               ";
				snprintf(buf,85,"%u Fahrzeuge beschafft und einsatzklar :) ",i-1 );
				Game::ShowHelpTextWindow(buf);
			}
		}
		System::Log("Fuhrpark Init Stop");
	}
};

bool katsalarmierung=false;
bool nobeep=false;
bool kats=false;
bool play_fms=true;
bool play_alarm=true;
bool sir=false;
// bool zugstart;
bool sirprobe=false;
int zugcode;
bool resetit=false;
Person fug;
GameObject metronom;
int traeger=-1;

const int maxfae=100;
bool zfae[maxfae];
bool zalarm=false;
bool zf=false;
bool zug=false;
float civspeed=7.5;

object senden: CommandScript
{

	senden()
	{
		SetPriority(2500);
	}

	void PushActions(GameObject *Caller, Actor *Target, int childID)
	{
		// System::Log("Funk senden %u %s",childID,Target->GetName());
		Vehicle v(Target);
		ActionInsertMode fifo=ACTION_APPEND;

		if ((v.IsFlagSet(FLAG_FUNK)||childID==-1) && !resetit)
			fifo=ACTION_INSERT;
		else 	switch (childID)
			{
				case 402:
					fifo=ACTION_INSERT;
					break;
				case 15998:
				case 15999:
					break;
				default:
					int alcode=childID/1000;
					if (sirprobe)
						if (alcode>2 && alcode!=7)
						{
							fug.PushActionExecuteCommand(ACTION_NEWLIST,"funk",Target,15999,false);
							sirprobe=false;
						}
					break;
			}

		fug.PushActionExecuteCommand(fifo,"funk",Target,childID,false);
		if (v.IsFlagSet(FLAG_FUNK) && !resetit)
			fug.PushActionExecuteCommand(fifo,"funk",Target,1333,false);
		// System::Log("Funk senden Ende");
	}
};

bool feuerwerk=true;
char logtext[5000];
GameDialog FunkFenster;
int wartezeit;

object funk : CommandScript
{	
	int cid;

	funk()
	{
		SetPriority(2500);
	}

	void set_wartezeit (int time)
	{
		wartezeit=time;
	}

	int sende_zvei(Actor *Target, GameObject *Caller, int code, int ort, bool isSir, bool isSirProbe, bool isNoFME, bool isWache, bool nobeep)
	{
		int cid=1;
		int sircode=ort;
		bool isWib=ort<10 && isWache;
		char *agcode="FAE";
		// char *altext="          ";
		char *dusa="                                                                                           ";

		System::Log("Alarmierung wird ausgelöst mit Code %u Ort %u Fz %S :: Code %u Wache %d SirProbe %u",code,ort,Target->GetName(),(code%1000),int(isWache), int(isSirProbe));
 		// System::Log(fzlocal::alarm(code,true));
	
		Vehicle vec(Target);

		if (isWib)
			sircode=0;

		if (katsalarmierung)
		{
			cid=1000;
			ort=99;	// virtueller Alarm-Fuer-Alle-Ort
			sircode=99;
			code=599;
			isSir=true;
		}

		dusa=fzlocal::alarm(code,true);
		if (strncmp(dusa,"WBDUSA",6)==0 && isWache)
		{
			code=code/10;
			dusa=fzlocal::alarm(code,true);
		}

		bool suppFME=strncmp(dusa,"-",1)==0;
		bool forceSir=strncmp(dusa,"#",1)==0;
		bool forceKatS=strncmp(dusa,"*",1)==0;
		bool suppAlarm=strncmp(dusa,"WBDUSA",6)==0 && !isSirProbe;

		isNoFME=isNoFME || suppFME;
		isSir=isSir || forceSir;
		kats=kats || forceKatS;
		nobeep=nobeep || suppAlarm;

		if (suppFME || forceSir || forceKatS)
			dusa[0]=char(32);
		
		// System::Log("AlarmProto : %s Ohne Alarm : %u Unterdruecken : %u Sirene : %u NoFME : %u",dusa, int(nobeep),int(suppAlarm),int(isSir),int(isNoFME));

		if (katsalarmierung || !nobeep)
		{
			if (play_alarm)
				if (isSir) {
					char * fms="                           ";
					char * format[]="mod:Audio/fx/sir%u.wav";
					sircode=100+sircode;
					int x=snprintf(fms,28,format,sircode);
					traeger=Audio::PlaySample(fms);
				} else
					traeger=Audio::PlaySample(fzlocal::alarm(code,false));

			if (!isSirProbe) 
			{
				if (isWache)
					zfae[ort]=false;
				if (!suppAlarm)
					Mission::PlayHint(dusa);
			}
		}

		ort=sircode%100;

		if (katsalarmierung)
		{
			agcode="KTS";
			ort=999;
 		} else if (kats){
			ort+=200;
			agcode="KAT";
		} else if (isSir) {
			if (isSirProbe)
				ort+=300;
			else
				ort+=100;
			Caller->PushActionExecuteCommand(ACTION_INSERT,"sirene",Caller,0,false);
			agcode="SIR";
		}

		if (!isNoFME && (!nobeep || katsalarmierung))
		{
			// System::Log("AlarmProto : FME ausloesen %u an %s",ort,Target->GetName());
			metronom.PushActionExecuteCommand(ACTION_INSERT,"FMEauf",Target,ort,false);
			metronom.PushActionWait(ACTION_INSERT,0.7f);
		}
		katsalarmierung=false;
		if (!suppAlarm) {
			sir=false;
			kats=false;
		}
		int h,m,s;
		Game::GetTime(h,m,s);
		System::Log(":SIR:%s:%u:%u:%u:%u", agcode, code, h, m, s);
		return cid;
	}

	void sende_fms (Actor *Target, int code)
	{
		char * fms="                            ";
		char * format[]="mod:Audio/fx/fms/%u%u.wav";
		int fzid;
		bool code1=code > 1999;
		int status=code-1000;
		if (code1)
			status-=1000;
		bool fmsC=status==333;
		bool bma=status>9 && !fmsC;
		if (fmsC)
			status=10;
		if (bma)
		{
			fzid=fzlocal::bma_id(Target)+200;
			status-=10;
			if (status>100)
			{
				status-=100;
				fzid+=200;
			} 
		} else
		 	fzid=fzlocal::fzid(Target);
		int x=snprintf(fms,28,format,1001,status);
		System::Log(fms);
		if (play_fms)
			traeger=Audio::PlaySample(fms);

		if (code1)
			fug.PushActionWait(ACTION_INSERT,0.5f);
		else {
			int h,m,s;
			Game::GetTime(h,m,s);
			if (bma)
				System::Log(":BMA:%u:%u:%u:%u:%u:%u",0,fzlocal::bma_id(Target),status,h, m, s);
			else
				System::Log(":FMS:%u:%u:%u:%u:%u",fzid,status,h, m, s);
			fug.PushActionExecuteCommand(ACTION_INSERT,"funk",Target,1000+code,false);
			if (feuerwerk && (h==23))
				fug.PushActionExecuteCommand(ACTION_INSERT,"feuerwerk",Target,0,false);
		}
	}

	bool kanal_ist_frei (Actor *Target, int code)
	{
		bool frei=(traeger==-1) || !Audio::IsPlaying(traeger);
		if (!frei && fug.IsValid())
		{
			fug.PushActionExecuteCommand(ACTION_INSERT,"funk",Target,code,false);
			fug.PushActionWait(ACTION_INSERT,0.1f);
		}
		return frei;
	}

	void status_schalten (Actor *Target,int code)
	{
		int ccode=0;
		int wz=4;
		GameObject o(Target);
		
		switch (code)
		{		
			case 402:
				KatSZustand=false;
				nobeep=false;
				break;
			case 401:
				KatSZustand=true;
				katsalarmierung=true;
				nobeep=true;
				break;
			case 301:
				kats=true;
			case 201:
				sir=true;
			case 121:
				if (code==121)
					wz=3;
			case 101:	// Zugalarmsequenz starten
				for (int i=0;i<maxfae;i++)
					zfae[i]=true;
				zalarm=true; 
				zug=true;
				cid=0;
				set_wartezeit(wz);
			case 110:	// Neuer Zug mit eigenem Zugfuehrer
				resetit=true;
				break;
			case 102:	// Zugalarmsequenz Ende
				zalarm=false;
				nobeep=KatSZustand;
				if (cid<2)
				{
					o.ClearFlag(FLAG_NA); // Dringend prüfen, wie CID hier sinnvoll interpretiert werden soll ? unnötig?
					// System::Log("ZF nicht erforderlich");
				}
				break;
			case 104:
				set_wartezeit(12);
				break;
			case 108: // Fzabstand Abstand fuer Demo-Zug
				set_wartezeit(4);
				break;
			case 100:
				if (zalarm)
				{
					cid++;
					ccode=cid;
				}
			case -1:
				fug.PushActionExecuteCommand(ACTION_INSERT,"fz_ist_alarmiert",Target,ccode,false);
				break;
		}
	}

	void PushActions(GameObject *Caller, Actor *Target, int childID)
	{
		Vehicle vec(Target);
		//System::Log("Funknutzung Code %u von %s an %s",childID,Caller->GetName(),Target->GetName());
		bool fzraus=false;
		bool IsControl=(childID>99 && childID < 500) || childID<0;

		if (IsControl)
			if (Target->IsValid() && kanal_ist_frei(Target,childID))
				status_schalten (Target, childID);
			else;
		else {
				if (childID==15998)
					sirprobe=true;
				if (childID==15999)
					sirprobe=false;

				bool isFMS=childID<4999;
				if (isFMS)
				{
						if (Target->IsValid() && kanal_ist_frei(Target,childID))
							sende_fms(Target,childID);
				} else {
					bool isNoFME=childID > 9999;
					childID=childID%10000;

					int al_selector=childID/1000;
		
					bool isSirProbe=al_selector==7;
					bool isSir=al_selector==6 || sir || isSirProbe;
					bool isFz=al_selector>7;
					bool isWache=al_selector==5 || al_selector==6 || al_selector==8;
					int al_ort;
					int code;

					fzraus=false;
					bool alarmieren=false;
					al_ort=childID%1000;

					if (isFz) {
						code=9000+al_ort;
						al_ort=fzlocal::fzort(&vec);
					} else  {
						code=5000+al_ort;
						al_ort=al_ort/10;
					}

					if (isWache)
						alarmieren=(!zalarm || zfae[al_ort]) && !vec.IsFlagSet(FLAG_FUNK);
					else {
						alarmieren=!vec.IsFlagSet(FLAG_FUNK);
						if (!isSirProbe)
							al_ort=childID%1000;
					}

					// System::Log("ZALARM %d an Ort %u : %d",int(zalarm),al_ort,int(zfae[al_ort]));

					if (isNoFME && !isSirProbe)
					{
						isSir=false;
					} else if (isSir)
					{
						if (isSirProbe) 
							fzraus=false;
					} 

					bool ff_warten=false;

					if (alarmieren)
					{
						if (kanal_ist_frei(Target,childID))
						{
							cid=sende_zvei (Target, Caller, code, al_ort, isSir, isSirProbe,isNoFME, isWache,nobeep);
							fzraus=!isSirProbe;
							ff_warten=vec.IsFirefighter() && (cid==1000 || fzlocal::fzort(Target)==0) && !MissionMode;
							// System::Log("Fz ist alarmiert %s | raus : %u ff_erwarten : %u",Target->GetName(),int(fzraus),int(ff_warten));
							if (ff_warten && fzraus)
							{
								int anz=5;
								if (isSir)
									anz=7;
								if (cid==1000)
									anz=9;
								Caller->PushActionExecuteCommand(ACTION_INSERTAFTERFIRST,"send_ffw",Caller,anz,false);
								wartezeit=7;
							}
						} else 
							fzraus=false;
					} else {
						if (zalarm)
							cid++;
						fzraus=true;
					}
					if (fzraus)
					{
						// System::Log("Fz rausschicken %s ",Target->GetName());
						if (resetit && zalarm) 
						{
							vec.AssignCommand("resetit");
							cid=1;
						}
						int wz;
						// int wache=fzlocal::fzort(Target);
						wz=wartezeit;
						// System::Log("Fz rausschicken %s | code %u | Wz %u",Target->GetName(),cid,wz);
 						FzManager.PushActionExecuteCommand(ACTION_APPEND,"fz_ist_alarmiert",Target,cid*wz,false);
						if (ff_warten)
						{	
							FzManager.PushActionWait(ACTION_INSERTBEFORELAST,5.0);
							if (alarmieren)
								FzManager.PushActionWait(ACTION_APPEND,15.0);
						}
						if (gate[fzlocal::fzid(Target)]>0 && !fzlocal::nachbar(&vec,3))
						{
							Actor tor=Game::GetActor(gate[fzlocal::fzid(Target)]);
							vec.PushActionExecuteCommand(ACTION_INSERTAFTERFIRST,"torsteuerung",&tor,21,false);
						}
						resetit=false;	
					}
				}
		}
	}
};


object fz_ist_alarmiert : CommandScript
{

	fz_ist_alarmiert()
	{
	}

	bool CheckTarget(GameObject *Caller, Actor *Target, int childID)
	{
		return true;
	}

	void PushActions(GameObject *Caller, Actor *Target, int childID)
	{
		// System::Log("Fz rueckt aus %s %s %u",Caller->GetName(),Target->GetName(),childID);
		Vehicle v(Target);
		bool no_chef=childID==1000;
		if ((fzlocal::IsTyp(Target,FZ_FW) || fzlocal::IsTyp(Target,FZ_FUEHRUNG)) && !no_chef)
			v.SetFlag(FLAG_NA);
		switch (childID)
		{
			case 0:
				v.RemoveCommand("wird_alarmiert");
				v.PushActionWait(ACTION_REPLACEFIRST,0.1);
				break;
			case 100:
				break;
			case 1000:
				childID=1;
			default:
				v.AssignCommand("abwarten");
				if (!fzlocal::IsTyp(Target,FZ_RD|FZ_OP))
					v.SetUserData(childID);
				v.RemoveCommand("wird_alarmiert");
				v.PushActionWait(ACTION_REPLACEFIRST,0.1);
				break;
		}
	}
};

bool fme_fix=true; // fester Melderton je Alarmierung

object FMEfix : CommandScript
{
	FMEfix()
	{
		SetIcon("notaus");
		SetCursor("notaus");
		SetRestrictions(RESTRICT_SELFEXECUTE);
	}

	bool CheckTarget(GameObject *Caller, Actor *Target, int childID)
	{
		return true;
	}

	void PushActions(GameObject *Caller, Actor *Target, int childID)
	{
		fme_fix=!fme_fix;
	}
};

object FMEauf : CommandScript
{
	FMEauf()
	{
		SetPriority(1000);
	}

	bool CheckTarget(GameObject *Caller, Actor *Target, int childID)
	{
		return true;
	}

	int sirene_wib (int type, Vector pos, int vol)
	{
		int x;
				switch (type)
				{
					case 1:
					case 3:
					case 9:
						x=Audio::PlaySample3D("mod:Audio/fx/sir.wav",pos);
						break;
					case 2:
						x=Audio::PlaySample3D("mod:Audio/fx/kats.wav",pos);
						break;
				}
				Audio::SetVolume(x,vol);
				return x;
	}

	void PushActions(GameObject *Caller, Actor *Target, int childID)
	{
		int pieper;
		// System::Log("Alarm fuer Ort %u", childID);
		Vector pos;
		int x;
		int ort=childID%100-50;
		int type=childID/100;
		bool isfme=type==0;
		bool allesirs=type==9;
		bool isffw=fzlocal::isffw(Target);
		GameObject ffsir;

		bool camp=false;
		if (!allesirs)
			camp=ort>0 && !ppos[ort].IsValid();
		bool sirwib=(ort<1 || camp)  && !isfme;
		bool sirext=!sirwib && (!isfme || isffw);
		bool nofme=type>2;

		if (isffw) {
			char *buf="       ";
			snprintf(buf,7,"Sir8%u",150+ort);
			GameObjectList ohl(buf);
			ffsir=ohl.GetObject(0);
			// System::Log("Sir Ext %s",buf);
		}
		
		sirwib=sirwib && play_alarm;
		int vol=15;
		if (!play_alarm || isfme)
			vol=0;

		if (fme_fix && isfme)
			pieper=childID%35+1;
		else 		
			pieper=Math::rand()%35+1;

		if (allesirs||sirext||sirwib)
			pieper=1;	

		if (!allesirs && !nofme && play_alarm)
		{
			char * fme="                            ";
			char * format[]="mod:Audio/fx/fme/fme%u.wav";
			x=snprintf(fme,28,format,pieper+100);
			// System::Log(fme);
			// System::Log("Alarm SIR %u Type %u isFME %u SirEXT %u",int(sirwib),type,int(isfme),int(sirext));
			Audio::PlaySample(fme);
		}

		if ((sirwib || allesirs) && play_alarm)
		{
			//System::Log("SIR ausloesen : Sirs = %u , Vol = %u",sirs.GetNumObjects(),vol);
			if (sirs.GetNumObjects()==0)
			{
				ActorList al("estelle");
				for (int i=0;i<al.GetNumActors();i++)
					x=sirene_wib (type,al.GetActor(i)->GetPosition(),vol);
			} else for (int i=0;i<sirs.GetNumObjects();i++)
				x=sirene_wib(type,sirs.GetObject(i)->GetPosition(),vol);
		}
				
		if (allesirs)
		{
			sirext=true;
			ort=1;
		} 


		int lim;

		for (int s=ort;sirext;s++)
		{
			lim=4;
			if (s==ort && isffw) {
				pos=ffsir.GetPosition();
				lim=1;
			} else
				pos=ppos[s].GetPosition();
			//System::Log("Sirenen laufen am Ort %u",s);
			for (int i=0;i<lim;i++)
			{
				x=Audio::PlaySample3D("mod:Audio/fx/sir.wav",pos);
				Audio::SetVolume(x,vol);
			};
			sirext=allesirs && s<11;
		}
		if (isffw)
			ffsir.SetUserData(x);
	}
};

object StatusSenden : CommandScript
{
	StatusSenden()
	{
	}

	void PushActions(GameObject *Caller, Actor *Target, int childID)
	{
		// System::Log("Status senden Start %s %u",Caller->GetName(),childID);
		char *com="     ";
		char *rd="rd%u";
		char *fw="fw%u";
		int statmask=0;
		int fzcom=fzlocal::fzid(Caller)+100;
		int cid=fzcom;
		bool funkit=true;

		switch (childID)
		{
			case 8:
				if (!Caller->IsFlagSet(OF_HAS_FIRE_EXTINGUISHER))
					return;
			case 7:
				statmask=FZ_BELEGT;
				break;
			case 22:
			case 21:
				Caller->SetCommandable(true);
				childID=childID%10;
			case 2:
				if (childID==2)
				{
					Caller->EnableHeadLights(false);
					Caller->ClearFlag(FLAG_FUNK);
				}
			case 1:
				Caller->RemoveCommand("ich_bin_nicht_frei");
				Caller->SetFlag(OF_HAS_FIRE_EXTINGUISHER);
				if (childID==1)
					Caller->SetFlag(FLAG_FUNK);
				statmask=childID & FZ_FUNK;
				break;
			case 6:
				Caller->AssignCommand("ich_bin_nicht_frei");
				if (Caller->HasCommand("feierabend"))
				{
					Caller->SetCommandable(false);
					Caller->EnableHeadLights(false);
				}
				statmask=FZ_DEFEKT;
				break;
			case 9:
				Caller->ClearFlag(OF_HAS_FIRE_EXTINGUISHER);
				Caller->PushActionShowHide(ACTION_INSERT,true);
				statmask=FZ_BELEGT;
				break;
			case 103:
				childID=333;
			case 0:
			case 5:
				statmask=FZ_BELEGT;
				break;
			case 3:
				// Caller->SetFlag(FLAG_FUNK);
			case 4:
				statmask=FZ_ANFAHRT;
				break;
			case 23:
				childID=3;
				cid=499;
				statmask=FZ_BELEGT;
				funkit=false;
				break;
		}
		if (funkit)
			fug.PushActionExecuteCommand(ACTION_INSERT,"funk",Caller,(1000+childID),false);
		Vehicle v(Caller);
		snprintf(com,5,rd,fzcom);
		System::Log("Status senden ? %s : %s %u %u",Caller->GetName(),com,cid,cid*10+childID);
		fzlocal::status_setzen(&v,statmask);
		if (FzManager.HasCommand(com))
			Caller->PushActionExecuteCommand(ACTION_INSERT,com,Caller,cid*10+childID,false);
	}
};

object fms_umschalten : CommandScript
{
	fms_umschalten()
	{
	}

	bool CheckTarget(GameObject *Caller, Actor *Target, int childID)
	{
		return true;
	}

	void PushActions(GameObject *Caller, Actor *Target, int childID)
	{
		play_fms=!play_fms;
		if (!play_fms)
			Mission::PlayHint("FMS Sound off");
	}
};

object alarm_umschalten : CommandScript
{
	alarm_umschalten()
	{
	}

	bool CheckTarget(GameObject *Caller, Actor *Target, int childID)
	{
		return true;
	}

	void PushActions(GameObject *Caller, Actor *Target, int childID)
	{
		play_alarm=!play_alarm;
		if (!play_alarm)
			Mission::PlayHint("Alarm Sound off");
	}
};

object GetChainsaw : CommandScript
{
	GetChainsaw()
	{
		SetValidTargets(ACTOR_VEHICLE | ACTOR_OBJECT);
		SetGroupID(CGROUP_GETEQUIPMENT);
		SetGroupLeader(false);
		SetRestrictions(RESTRICT_NOTDESTROYED | RESTRICT_NOTBURNING | RESTRICT_HASCHAINSAW);
		SetPossibleCallers(ACTOR_PERSON);
	}

	bool CheckGroupVisibility(GameObject *Caller)
	{
		if (Caller->GetType() != ACTOR_PERSON)
			return false;
		Person p(Caller);
		bool show=(!Caller->IsEquipped() && fzlocal::has_equip(Caller,6));
		return show;
	}

	bool CheckPossible(GameObject *Caller)
	{
		return !Caller->HasCommand("fuehrung");
	}

	bool CheckTarget(GameObject *Caller, Actor *Target, int childID)
	{
		if (!Caller->IsValid() || !Target->IsValid() || (Caller->GetID()==Target->GetID()))
			return false;

		GameObject obj(Target);
		if ((Caller->GetObjectType()==TYPE_PERSON) && (Caller->GetEquipment()!=EQUIP_CHAINSAW) && obj.IsValid() && obj.IsFlagSet(OF_HAS_CHAINSAW))
		{
			Person p(Caller);
			if(p.IsValid() && (p.IsCarryingPerson()||p.IsLinkedWithPerson()|| p.GetFirehoseID()!=0 || p.IsPulling() || p.GetEnteredCarID() != -1))
				return false;
			
			return fzlocal::has_equip(Target,6);
		}
		return false;
	}

	void PushActions(GameObject *Caller, Actor *Target, int childID)
	{
	
		Caller->PushActionExecuteCommand(ACTION_NEWLIST,"rollo_go",Target,6,false);
		if (fzlocal::take_equip(Target,6))
			Caller->PushActionGetEquipment(ACTION_APPEND, Target, EQUIP_CHAINSAW);
	}
};

object GetFirehose : CommandScript
{
	GetFirehose()
	{
		SetIcon("crohr");
		SetCursor("crohr");
		SetGroupID(CGROUP_GETEQUIPMENT);
		SetGroupLeader(false);
		SetRestrictions(RESTRICT_NOTDESTROYED | RESTRICT_NOTBURNING | RESTRICT_HASFIREHOSE);
		SetPossibleCallers(ACTOR_PERSON);
		// SetNeedsCarWithFlagSet(OF_HAS_HOSE);
	}

	bool CheckPossible(GameObject *Caller)
	{
		return !Caller->HasCommand("fuehrung");
	}
	
	bool CheckGroupVisibility(GameObject *Caller)
	{
		if (Caller->GetType() != ACTOR_PERSON)
			return false;
		Person p(Caller);
		bool show=(!Caller->IsEquipped());
		return show;
	}

	bool CheckTarget(GameObject *Caller, Actor *Target, int childID)
	{

		if (!Caller->IsValid())
			return false;

		Person p(Caller);
		if (p.IsValid() && (p.IsCarryingPerson()||p.IsLinkedWithPerson()|| p.GetFirehoseID()!=0 || p.IsPulling() || p.GetEnteredCarID() != -1))
			return false;
		
		switch (p.GetPersonType())
		{
			case PT_FIREFIGHTER_NORMAL:
			case PT_FIREFIGHTER_MASK:
			case PT_FIREFIGHTER_ABC:
				break;
			default:
				return false;
		}
			
		bool avail=false;
		if (Target->GetType()==ACTOR_VEHICLE)
		{
			Vehicle v(Target);
			if (v.IsFirefighter())
				avail=fzlocal::has_equip(Target,3);
			else 
				avail=false;
		} else
			if (Caller->GetID() == Target->GetID())
				avail=fzlocal::has_equip(Caller,3);
	
		return avail;
	}

	void PushActions(GameObject *Caller, Actor *Target, int childID)
	{
		if (Target->GetType()!=ACTOR_VEHICLE)
		{
			VehicleList vl(Caller->GetName());
			Vehicle v(vl.GetVehicle(0));
		} else
			Vehicle v(Target);
	
		Vector TargetPos = v.GetTargetPoint(Caller, TARGET_EQUIPMENTDOOR);
		if (fzlocal::take_equip(&v,3))
			Caller->PushActionGetEquipment(ACTION_INSERT, &v, EQUIP_FIREHOSE);
		Caller->PushActionExecuteCommand(ACTION_INSERT,"rollo_go",&v,3,false);
	}
};

object GetShears : CommandScript
{
	GetShears()
	{
		SetValidTargets(ACTOR_VEHICLE | ACTOR_OBJECT);
		SetGroupID(CGROUP_GETEQUIPMENT);
		SetGroupLeader(false);
		SetRestrictions(RESTRICT_NOTDESTROYED | RESTRICT_NOTBURNING | RESTRICT_HASSHEARS);
		SetPossibleCallers(ACTOR_PERSON);
		//SetNeedsCarWithFlagSet(OF_HAS_SHEARS);
	}

	bool CheckPossible(GameObject *Caller)
	{
		return !Caller->HasCommand("fuehrung");
	}

	bool CheckGroupVisibility(GameObject *Caller)
	{
		if (Caller->GetType() != ACTOR_PERSON)
			return false;
		Person p(Caller);
		bool show=!Caller->IsEquipped();
		return show;
	}

	bool CheckTarget(GameObject *Caller, Actor *Target, int childID)
	{
		if (!Caller->IsValid() || !Target->IsValid() || (Caller->GetID()==Target->GetID()))
			return false;

		GameObject obj(Target);
		if (Caller->GetObjectType()==TYPE_PERSON && Caller->GetEquipment()!=EQUIP_SHEARS && obj.IsValid() && obj.IsFlagSet(OF_HAS_SHEARS))
		{
			Person p(Caller);
			if(p.IsValid() && (p.IsCarryingPerson()||p.IsLinkedWithPerson()|| p.GetFirehoseID()!=0 || p.IsPulling() || p.GetEnteredCarID() != -1))
				return false;
			
			return fzlocal::has_equip(Target,5);
		}
		return false;
	}

	void PushActions(GameObject *Caller, Actor *Target, int childID)
	{
		Vector TargetPos = Target->GetTargetPoint(Caller, TARGET_EQUIPMENTDOOR);
		
		if (fzlocal::take_equip(Target,5))
			Caller->PushActionGetEquipment(ACTION_INSERT, Target, EQUIP_SHEARS);
		Caller->PushActionExecuteCommand(ACTION_INSERT,"rollo_go",Target,5,false);
	}
};

object mannschaft_komplett : CommandScript
{
	mannschaft_komplett()
	{
		SetPriority(2000);
	}

	bool CheckTarget(GameObject *Caller, Actor *Target, int ChildID)
	{
		return true;
	}


	bool fz_besetzt (Vehicle v, bool seg, bool sekundaer, bool sek,bool force, int code)
	{
		int lim=0;
		force=force||code<0;
		if (force)
			lim=-code;
		else switch (v.GetVehicleType())
		{
			case VT_AMBULANCE_RTW:
				force=true;
				if (fzlocal::IsTyp(&v,(FZ_RD|FZ_BSW)))
					lim=1;
				else if ((v.IsFlagSet(FLAG_NA) && !seg))
						lim=3;
					else 
						lim=2;
				break;
			case VT_AMBULANCE_RHC:
				if (sekundaer)
					lim=1;
				break;
			case VT_THW_FGRT_BH:
				lim=1;
				break;
			case VT_POLICE_GETAWAY:
				lim=9;
				break;
			case VT_POLICE_STW:
				if (sek)
					lim=0;
				else
					lim=2;
				break;
			case VT_FIREFIGHTERS_TLF:
			case VT_FIREFIGHTERS_RW:
			case VT_FIREFIGHTERS_GTF:
				lim=0;
				break;
			case VT_FIREFIGHTERS_FLB:
				lim=2;
				break;
			case VT_TV_HELI:
				lim=2;
				break;
			default:
				if (v.HasCommand("harry") && fzlocal::IsTyp(&v,(FZ_RD|FZ_NA))) {
					force=true;
					lim=1;
				}
				
				break;
		}
		// System::Log("zuviele freie Plaetze ? %u %u",v.GetNumPassengers(),v.GetFreePassengers());
		return (v.GetFreePassengers()<=lim && !force) || (force && v.GetNumPassengers()>=lim);
	}

	void PushActions(GameObject *Caller, Actor *Target, int ChildID)
	{
		int lim=0;
		Vehicle v(Target);
		// System::Log("MS komplett ? %s %u Code %u",v.GetName(),v.GetNumPassengers(),ChildID);
		int fzid=fzlocal::fzid(&v);
		bool feuerwehr=fzlocal::IsTyp(&v,FZ_FW);
		bool sek=fzlocal::IsTyp(&v,FZ_POL|FZ_SEK);
		bool seg=v.HasNamePrefix("SEG");
		bool force=ChildID==100;
		bool sekundaer=fzlocal::IsTyp(Caller,(FZ_RD|FZ_ITH));
		bool go_on=v.IsCurrentAction("EActionWait");
	
		if (v.IsFlagSet(FLAG_P_NEU) && go_on) 		// 1. Schritt : Fz nachbesetzt ? Dann auf Personal warten
		{
			go_on=fz_besetzt(v,seg,sekundaer,sek,force,ChildID);
			// System::Log("MS komplett ? %u %u %s",fzstatus[fzid]&15,int(go_on),v.GetName());
		}

		if (go_on || !v.IsFlagSet(FLAG_P_NEU))
		{
			if (v.IsCurrentAction("EActionWait"))
				if (v.HasCommand("abwarten") && !force)
					v.PushActionWait(ACTION_REPLACEFIRST,3.0f);
				else
					v.PushActionLightOn(ACTION_REPLACEFIRST,false); // Bremse los und ab :D
			v.RemoveCommand("abwarten");
			// System::Log("MS komplett -> Fz raus %s %u",v.GetName(),int(v.IsCurrentAction("EActionWait")));	
		}			
	}
};

object mannschaft_struktur : CommandScript
{
	mannschaft_struktur()
	{
		SetPriority(2000);
	}

	bool CheckTarget(GameObject *Caller, Actor *Target, int ChildID)
	{
		return true;
	}

	void FwDVGruppe (PersonList pl,Vehicle fz,bool brandeinsatz, int zugid)
	{
		int staerke=pl.GetNumPersons();
		int x;
		int func=0;
		for (x=0;x<staerke;x++)
		{
			Person p=pl.GetPerson(x);
			p.SetAutoHealDistance(0);
			p.RemoveCommand("ich_bin_nicht_frei");
			if (!p.HasCommand("tl_rufe_tel")) {
			p.RemoveCommand("fuehrung");
			switch (func)
			{
				case 0:
					p.ChangePrototype("mod:Prototypes/Persons/Fire Department/grufue_60.e4p");
					p.SetUserData(zugid);
					p.AssignCommand("gf_gefahr");
					p.AssignCommand("eh");
					if (Game::IsMission())
						p.AssignCommand("Use");
					switch (staerke)
					{
						case 3:
						case 2:
						case 1:
							p.AssignCommand("tf");
							break;
						case 4:
						case 5:
						case 6:
							p.AssignCommand("sf");
							break;
					}
					p.AssignCommand("gf_lage");
					p.AssignCommand("fuehrung");
					p.AssignCommand("UseSchranke");
					if (fz.GetVehicleType()==VT_FIREFIGHTERS_DLK)
					{
						p.AssignCommand("gf_LIGHT");
						p.RemoveCommand("gf_verteiler");
						p.RemoveCommand("gf_rohrvor");
					}
					break;
				case 1:
				case 2:
					if (brandeinsatz)
						if (fzlocal::take_equip(&fz,0))
							p.ChangePrototype("mod:Prototypes/Persons/Fire Department/firefightermask_upgraded2.e4p");
					p.AssignCommand("at");
					p.AssignCommand("gf_lage");
					break;
				case 3:
					if (p.IsEquipped())
						p.RemoveEquipment();
					p.AssignCommand("ma");
					p.AssignCommand("fuehrung");
					p.AssignCommand("ma_wasser");
					break;
				case 4:
				case 5:
					p.AssignCommand("wt");
					break;
				case 6:
				case 7:
					p.AssignCommand("st");
					break;
				case 8:
					p.AssignCommand("me");
					break;
			}
			func++;
			}
		}		
	} 

	void TL_definieren (Vehicle v,PersonList pl, Actor *Target, bool sek)
	{
		bool tl_noetig=false;
		bool zf_noetig=false;
		bool fuehrung=fzlocal::IsTyp(&v,FZ_FUEHRUNG) || v.IsFlagSet(FLAG_NA); // Bedeutung Flag_NA unklar
		int i;
		Person tl=pl.GetPerson(0);
		if (fuehrung) 
			for (i=0;!tl.HasCommand("tl_rufe_tel") && i<pl.GetNumPersons();i++)
				if (pl.GetPerson(i)->HasCommand("fuehrung") && !pl.GetPerson(i)->HasCommand("ma"))
					tl=pl.GetPerson(i);

		if (!tl.HasCommand("fuehrung"))
			return; 	// Evil aber erstmal stabil
				
				

		if (fuehrung)
		{
			GameObject o(Target);
			if (!o.HasCommand("lst_estelle"))
			{
				Actor a=Game::GetActor(o.GetUserData());
				if (a.IsValid()) {
					GameObject o(&a);
					Target=&a;
				} else
					Target=&o;
			}
			v.ClearFlag(FLAG_NA);
			if (!o.IsFlagSet(FLAG_TL) || !o.IsFlagSet(FLAG_NA) || fzlocal::IsTyp(&v,FZ_FUEHRUNG))	// TL erforderlich ?
			{
				tl_noetig=!o.IsFlagSet(FLAG_TL);
				zf_noetig=true;

				if (tl.IsEquipped())
					tl.RemoveEquipment();

				tl.AssignCommand("tl");
				if (tl_noetig)
				{
					tl.SetFlag(FLAG_TL);
					o.SetUserData(tl.GetID());
					o.SetFlag(FLAG_TL);
					v.AssignCommand("sofa");
				} else
					tl.ClearFlag(FLAG_TL);

				v.SetFlag(FLAG_TL);
				o.SetFlag(FLAG_NA);
			} else {
				tl.ClearFlag(FLAG_TL);
				System::Log("Kein TL erforderlich");
			}
		}

		for (int x=0;x<pl.GetNumPersons();x++)
		 	if (pl.GetPerson(x)->HasCommand("gf") || pl.GetPerson(x)->HasCommand("tl"))
				pl.GetPerson(x)->SetUserData(Target->GetID());
	}

	void PushActions(GameObject *Caller, Actor *Target, int ChildID)
	{
		int lim=0;
		Vehicle v(Caller);
		int fzid=fzlocal::fzid(&v);
		bool fr=ChildID==619;
		bool siwa=ChildID==2011;
		bool kats=ChildID==999;
		bool feuerwehr=fzlocal::IsTyp(&v,FZ_FW) && !fr && (ChildID<900 || kats);
		bool brandeinsatz=ChildID==112;
		bool sek=(fzstatus[fzid]&(FZ_POL|FZ_SEK)) == (FZ_POL|FZ_SEK);
		bool seg=v.HasNamePrefix("SEG");
		bool sekundaer=ChildID==621;
		bool mitNA=ChildID==19292;
		bool isffw=fzlocal::isffw(Caller);
	
		PersonList pl=v.GetPassengers();	
		if (v.IsFlagSet(FLAG_P_NEU)) 		
		{
			if (feuerwehr && v.GetNumPassengers()>2)
				FwDVGruppe(pl,v,brandeinsatz,v.GetUserData());
		} 

			GameObject tr(Target);
			if (v.HasCommand("resetit"))
			{
				v.RemoveCommand("resetit");
				if (tr.HasCommand("lst_estelle"))
					tr.ClearFlag(FLAG_NA);
			}
	
			if ((v.IsFirefighter() && !kats && v.IsFlagSet(FLAG_P_NEU)) || v.IsPolice() || (fzlocal::IsTyp(&v,FZ_FUEHRUNG) && !kats))
				if (!fr)
					TL_definieren(v,pl,Target,sek);
			
			if ((v.IsAmbulance() && v.IsFlagSet(FLAG_NA)) || mitNA)
			{
				pl.GetPerson(0)->SetUserData(44);
				if (pl.GetNumPersons()>1)
					pl.GetPerson(1)->SetUserData(44);
				if (pl.GetNumPersons()>2)
					pl.GetPerson(2)->SetUserData(44);
			}

			if (sekundaer)
			{
				// System::Log("Check MS Sekundaer %s",v.GetName());
				for (int i=0;i<pl.GetNumPersons();i++)
					pl.GetPerson(i)->SetFlag(FLAG_SOSI);
			}


			//System::Log("CHECKMS Fz Status %s %u %u %u %u",v.GetName(),int(ffw),int(kats),int(v.IsHidden()),int(v.HasCommand("ich_bin_nicht_frei")));

			if ((isffw || kats) && !v.IsHidden() && v.IsFlagSet(FLAG_P_NEU))
			{
				//System::Log("Check MS FFW %s",v.GetName());
				PersonList pl(v.GetName());
				for (int i=0;i<pl.GetNumPersons();i++)
				{
					Person p=pl.GetPerson(i);
					if (p.GetEnteredCarID()!=v.GetID())
						p.PushActionDeleteOwner(ACTION_NEWLIST);
				}
			}

			v.ClearFlag(FLAG_P_NEU);
			
			if (seg)  // SEG Personal dem jeweiligen Zug zuordnen, damit jedes Zelt nur die Leute "seiner" SEG disponiert
				v.PushActionExecuteCommand(ACTION_INSERT,"zugliste_zugid",&v,1,false);

			if (Game::IsMultiplayer())
			{
				for (int mpx=0;mpx<pl.GetNumPersons();mpx++)
					pl.GetPerson(mpx)->SetPlayerMP(v.GetPlayerMP());
			}
	}
};

object sir_abwarten : CommandScript
{

	sir_abwarten()
	{
	}

	bool CheckTarget(GameObject *Caller, Actor *Target, int ChildID)
	{
		return true;
	}

	void PushActions(GameObject *Caller, Actor *Target, int ChildID)
	{
		if (!KatSZustand)
		{
			int fzort=fzlocal::fzort(Target);
			char *buf="       ";
			snprintf(buf,7,"Sir8%u",100+fzort);
			GameObjectList ohl(buf);
			fzort=ohl.GetObject(0)->GetUserData();
			Caller->PushActionExecuteCommand(ACTION_INSERT,"sir_laeuft",Target,fzort,false);
			// Game::ShowHelpTextWindow("2 Sirene abwarten");
			// System::Log("Sirene abwarten Start %u %u %s",fzlocal::fzort(Target),fzort,Caller->GetName());
		}
	}
};

object sir_laeuft : CommandScript
{

	sir_laeuft()
	{
	}

	bool CheckTarget(GameObject *Caller, Actor *Target, int ChildID)
	{
		return true;
	}

	void PushActions(GameObject *Caller, Actor *Target, int sir)
	{
		Vehicle v(Target);
		if (Audio::IsPlaying(sir) && v.GetFreePassengers()>0)
		{
			// Game::ShowHelpTextWindow("W Sirene laeuft");
			Caller->PushActionExecuteCommand(ACTION_INSERT,"sir_laeuft",Target,sir,false);
			Caller->PushActionWait(ACTION_INSERT,3.0f);
		} else {
			// Game::ShowHelpTextWindow("3 Freiwillige ausruecken");
			if (v.GetNumPassengers()<6)
				v.ClearFlag(FLAG_NA);
			Caller->PushActionExecuteCommand(ACTION_INSERT,"mannschaft_komplett",Target,100,false);
		}
	}
};



object ChangeToMask: CommandScript
{
	ChangeToMask()
	{
		SetGroupLeader(false);
	}

	bool CheckPossible(GameObject *Caller)
	{
		if(!Caller->IsValid() || Caller->IsEquipped())
			return false;
		Person p(Caller);
    		if (p.IsCarryingPerson() || p.IsInDLKBasket() || p.IsPulling())
    			return false;
		return p.GetPersonType() != PT_FIREFIGHTER_MASK;
	}

	bool CheckGroupVisibility(GameObject *Caller)
	{
		if (Caller->GetType() != ACTOR_PERSON)
			return false;
		Person p(Caller);
		bool show=(!Caller->IsEquipped() && fzlocal::has_equip(Caller,0) && (p.GetPersonType() != PT_FIREFIGHTER_MASK));
		return show;
	}

	bool CheckTarget(GameObject *Caller, Actor *Target, int childID)
	{
		if(!Caller->IsValid() || Caller->IsEquipped())
			return false;
		Person p(Caller);
    		if (p.IsCarryingPerson() || p.IsInDLKBasket())
    			return false;
		bool avail=false;
		if (Target->GetType()==ACTOR_VEHICLE)
		{
			Vehicle v(Target);
			if (v.IsFirefighter())
				avail=fzlocal::has_equip(Target,0) && v.IsFlagSet(OF_RECOVERABLE);
			else 
				avail=false;
		} else
			if (Caller->GetID() == Target->GetID())
				avail=fzlocal::has_equip(Caller,0);
		return avail;
	}

	void PushActions(GameObject *Caller, Actor *Target, int childID)
	{
		switch (childID)
		{
			case 1:
				if (fzlocal::take_equip(Caller,0))
				{
			                Caller->PushActionExecuteCommand(ACTION_INSERT, "DummyChange", Caller, 101, false);
					break;
				}
			default:
				if (fzlocal::take_equip(Target,0))
	        		        Caller->PushActionExecuteCommand(ACTION_INSERT, "DummyChange", Target, 101, false);
				break;
		}
	}
};

object ChangeToABC: CommandScript
{
	ChangeToABC()
	{
		SetGroupLeader(false);
	}

	bool CheckPossible(GameObject *Caller)
	{
		if(!Caller->IsValid() || Caller->IsEquipped())
			return false;
		Person p(Caller);
    		if (p.IsCarryingPerson() || p.IsInDLKBasket() || p.IsPulling())
    			return false;
		return p.GetPersonType() != PT_FIREFIGHTER_ABC;
	}

	bool CheckGroupVisibility(GameObject *Caller)
	{
		if (Caller->GetType() != ACTOR_PERSON)
			return false;
		Person p(Caller);
		bool show=(!Caller->IsEquipped() && fzlocal::has_equip(Caller,1) && (p.GetPersonType() != PT_FIREFIGHTER_ABC));
		return show;
	}


	bool CheckTarget(GameObject *Caller, Actor *Target, int childID)
	{
		if(!Caller->IsValid() || Caller->IsEquipped())
			return false;
		Person p(Caller);
    		if (p.IsCarryingPerson() || p.IsInDLKBasket())
    			return false;
		bool avail=false;
		if (Target->GetType()==ACTOR_VEHICLE)
		{
			Vehicle v(Target);
			if (v.IsFirefighter())
				avail=fzlocal::has_equip(Target,1) && v.IsFlagSet(OF_RECOVERABLE);
			else 
				avail=false;
		} else
			if (Caller->GetID() == Target->GetID())
				avail=fzlocal::has_equip(Caller,1);
		return avail;
	}

	void PushActions(GameObject *Caller, Actor *Target, int childID)
	{
		switch (childID)
		{
			case 1:
				if (fzlocal::take_equip(Caller,1))
				{
			                Caller->PushActionExecuteCommand(ACTION_INSERT, "DummyChange", Caller, 102, false);
					break;
				}
			default:
				if (fzlocal::take_equip(Target,1))
	        		        Caller->PushActionExecuteCommand(ACTION_INSERT, "DummyChange", Target, 102, false);
				break;
		}
	}
};

object ChangeToDiver: CommandScript
{
	ChangeToDiver()
	{
		SetGroupLeader(false);
	}

	bool CheckPossible(GameObject *Caller)
	{
		if(!Caller->IsValid() || Caller->IsEquipped())
			return false;
		Person p(Caller);
    		if (p.IsCarryingPerson() || p.IsInDLKBasket() || p.IsPulling())
    			return false;
		return p.GetPersonType() != PT_DIVER;
	}

	bool CheckGroupVisibility(GameObject *Caller)
	{
		if (Caller->GetType() != ACTOR_PERSON)
			return false;
		Person p(Caller);
		VehicleList vl(Caller->GetName());
		// for (int i=0; (i<vl.GetNumVehicles()) && (!vl.GetVehicle(i)->IsFlagSet(OF_HAS_FIRE_EXTINGUISHER)); i++);
		bool show=(!Caller->IsEquipped() && fzlocal::has_equip(vl.GetVehicle(0),2) && (p.GetPersonType() != PT_DIVER));
		return show;
	}


	bool CheckTarget(GameObject *Caller, Actor *Target, int childID)
	{
		if(!Caller->IsValid() || Caller->IsEquipped())
			return false;
		Person p(Caller);
    		if (p.IsCarryingPerson() || p.IsInDLKBasket())
    			return false;
		bool avail=false;
		if (Target->GetType()==ACTOR_VEHICLE)
		{
			Vehicle v(Target);
			if (v.IsFirefighter())
				avail=fzlocal::has_equip(Target,2) && v.IsFlagSet(OF_RECOVERABLE);
			else 
				avail=false;
		} else
			if (Caller->GetID() == Target->GetID())
				avail=fzlocal::has_equip(Caller,2);
		return avail;
	}

	void PushActions(GameObject *Caller, Actor *Target, int childID)
	{
		if (fzlocal::take_equip(Target,2))
	                Caller->PushActionExecuteCommand(ACTION_INSERT, "DummyChange", Target, 103, false);
	}
};

object ChangeToHassHoff: CommandScript
{
	ChangeToHassHoff()
	{
		SetIcon("liftperson");
		SetCursor("liftperson");
		SetGroupLeader(false);
		SetPriority(1000);
	}

	bool CheckPossible(GameObject *Caller)
	{
		if(!Caller->IsValid() || Caller->IsEquipped())
			return false;
		Person p(Caller);
    		if (p.IsCarryingPerson() || p.IsInDLKBasket() || p.IsPulling())
    			return false;
		return p.GetPersonType() != PT_DIVER;
	}

	bool CheckGroupVisibility(GameObject *Caller)
	{
		if (Caller->GetType() != ACTOR_PERSON)
			return false;
		return true;
	}


	bool CheckTarget(GameObject *Caller, Actor *Target, int childID)
	{
		if(!Caller->IsValid() || Caller->IsEquipped())
			return false;
		Person p(Caller);
    		if (p.IsCarryingPerson() || p.IsInDLKBasket())
    			return false;
		bool avail=false;
		if (Target->GetType()==ACTOR_PERSON)
		{
			Person v(Target);
			avail=v.IsInsideWater();
		} else
			avail=false;
		return avail;
	}

	void PushActions(GameObject *Caller, Actor *Target, int childID)
	{
                Caller->PushActionExecuteCommand(ACTION_INSERT, "DummyChange", Target, 131, false);
	}
};




object ChangeToFireFighter: CommandScript
{
	ChangeToFireFighter()
	{
//		SetGroupID(CGROUP_GETEQUIPMENT);
		SetGroupLeader(false);
	}

	bool CheckPossible(GameObject *Caller)
	{
		if(!Caller->IsValid() || Caller->IsEquipped())
			return false;
		Person p(Caller);
    		if (p.IsCarryingPerson() || p.IsInDLKBasket())
    			return false;
		return p.GetPersonType() != PT_FIREFIGHTER_NORMAL;
	}

	bool CheckGroupVisibility(GameObject *Caller)
	{
		if (Caller->GetType() != ACTOR_PERSON)
			return false;
		Person p(Caller);
		VehicleList vl(Caller->GetName());
		for (int i=0; (i<vl.GetNumVehicles()) && (!vl.GetVehicle(i)->IsFlagSet(OF_HAS_FIRE_EXTINGUISHER)); i++);
		bool show=(!Caller->IsEquipped() && (p.GetPersonType()!=PT_FIREFIGHTER_NORMAL));
		// show=(show && Caller->HasCommand("geraetemenue"));
		return show;
	}


	bool CheckTarget(GameObject *Caller, Actor *Target, int childID)
	{
		if(!Caller->IsValid() || Caller->IsEquipped())
			return false;
		Person p(Caller);
    		if (p.IsCarryingPerson() || p.IsInDLKBasket())
    			return false;
		bool avail=false;
		if (Target->GetType()==ACTOR_VEHICLE)
		{
			Vehicle v(Target);
			if (v.IsFirefighter())
				avail=v.IsFlagSet(OF_RECOVERABLE);
			else 
				avail=false;
		} else
			if (Caller->GetID() == Target->GetID())
				avail=true;
		return avail;
	}

	void PushActions(GameObject *Caller, Actor *Target, int childID)
	{
		Vehicle v(Target);
                Caller->PushActionExecuteCommand(ACTION_INSERT, "DummyChange", Target, 4, false);
	}
};
	
object DummyChange: CommandScript
{
	DummyChange()
	{
	}

	bool CheckTarget(GameObject *Caller, Actor *Target, int childID)
	{
	}

	void PushActions(GameObject *Caller, Actor *Target, int childID)
	{
		int enter = 0;

		if (childID<4)
		{
			if (!fzlocal::take_equip(Target,(childID-1)))
				return; 	// unsauber aber praktisch
		}
		else if (childID > 99)
			childID=childID-100;
			

		Caller->SetCommandable(false);
		if (Target->GetType() != ACTOR_VEHICLE)
		{
			VehicleList vl(Caller->GetName());
			Vehicle v(vl.GetVehicle(0));
		} else
			Vehicle v(Target);
           	Caller->PushActionExecuteCommand(ACTION_INSERT,"umziehen",&v,childID,false);
		Caller->PushActionWait(ACTION_INSERT, 3.0f);
         	Caller->PushActionSwitchAnim(ACTION_INSERT,"useobjmid");
		if (Caller->IsEquipped())
			Caller->PushActionRemoveEquipment(ACTION_INSERT);
		if (childID==41)
		{
			Caller->PushActionTurnTo(ACTION_INSERT, Target);
			Caller->PushActionMove(ACTION_INSERT, Target->GetPosition());
		} else if (childID!=31)
		{
			Caller->PushActionTurnTo(ACTION_INSERT, &v);
			if (childID==4)
				childID=1;
			if (childID>3)
				Caller->PushActionMove(ACTION_INSERT, &v, TARGET_EQUIPMENTDOOR);
			else
		           	Caller->PushActionExecuteCommand(ACTION_INSERT,"rollo_go",&v,childID-1,false);
		}
	}
};

int ffw=5;

object umziehen: CommandScript
{
	umziehen()
	{
	}

	bool CheckTarget(GameObject *Caller, Actor *Target, int childID)
	{
		return true;
	}

	void PushActions(GameObject *Caller, Actor *Target, int childID)
	{
		bool grufue=Caller->HasCommand("gf");
		bool tl=Caller->HasCommand("tl");
		bool at=Caller->HasCommand("at");
		bool wt=Caller->HasCommand("wt");
		bool st=Caller->HasCommand("st");
		bool ma=Caller->HasCommand("ma");
		bool me=Caller->HasCommand("me");
		Person p(Caller);
		int fzid=fzlocal::fzid(Caller);
		switch (childID)
                {
			case 1:
				if (grufue)
	                       		Caller->ChangePrototype("mod:Prototypes/Persons/Fire Department/grufue60_mask.e4p");
				else if (!tl)
        	               		Caller->ChangePrototype("mod:Prototypes/Persons/Fire Department/firefightermask_upgraded2.e4p");
				break;

			case 2:
				if (grufue)
	                       		Caller->ChangePrototype("mod:Prototypes/Persons/Fire Department/grufue60_tesimax.e4p");
				else if (!tl)
		                	Caller->ChangePrototype("mod:Prototypes/Persons/Fire Department/firefighterabc_upgraded2.e4p");
				break;
			case 3:
			case 31:
                     		p=Game::CreatePerson("mod:Prototypes/Persons/Fire Department/diver_upgraded2.e4p",Caller->GetName());
				if (childID==31)
	                       		p.ChangePrototype("mod:Prototypes/Persons/Fire Department/baywatcher.e4p");
				p.SetPosition(Caller->GetPosition());
				Caller->PushActionDeleteOwner(ACTION_NEWLIST);
				Caller=&p; // This is definitively a very evil workaround
				break;
				break;

			case 41:
			case 4:
				if (grufue)
	                       		Caller->ChangePrototype("mod:Prototypes/Persons/Fire Department/grufue_60.e4p");
				else
	                        	Caller->ChangePrototype("mod:Prototypes/Persons/Fire Department/firefighternorm_upgrade2.e4p");
				break;
			case 5:
                       		Caller->ChangePrototype("mod:Prototypes/Persons/Ambulance/hundefuehrer.e4p");
				break;
			case 6:
                       		Caller->ChangePrototype("mod:Prototypes/Persons/SEK/sharpshooter_upgraded2.e4p");
				break;
			case 7:
				switch (fzid)
				{
					case 12:
						p = Game::CreatePerson("mod:Prototypes/Persons/Ambulance/chr25ra_upgraded2.e4p", Caller->GetName());
						break;
					case 48:
						p = Game::CreatePerson("mod:Prototypes/Persons/Ambulance/chr7ra_upgraded2.e4p", Caller->GetName());
						break;
					case 83:
					case 105:
						Person p = Game::CreatePerson("mod:Prototypes/Persons/Ambulance/sar41ra_upgraded2.e4p", Caller->GetName());
						break;
					case 87:
						Person p = Game::CreatePerson("mod:Prototypes/Persons/Ambulance/chr8ra_upgraded2.e4p", Caller->GetName());
						break;
					case 85:
					case 88:
						Person p = Game::CreatePerson("mod:Prototypes/Persons/Ambulance/hsra_upgraded2.e4p", Caller->GetName());
						break;
					default:
                       				p = Game::CreatePerson("mod:Prototypes/Persons/Ambulance/paramedic02_upgraded2.e4p",Caller->GetName());
						break;
				}
				p.SetPosition(Caller);
				Caller->Hide();
				Caller->PushActionDeleteOwner(ACTION_NEWLIST);
				switch (Target->GetType())
				{
					case ACTOR_PERSON:
						p.PushActionExecuteCommand(ACTION_NEWLIST,"Lift",Target,0,false);
						break;
					case ACTOR_VEHICLE:
						p.PushActionExecuteCommand(ACTION_NEWLIST,"EnterCar",Target,0,false);
						break;
				}					
				break;
			case 71:
			case 711:
				switch (fzid)
				{
					case 12:
						Person p = Game::CreatePerson("mod:Prototypes/Persons/Ambulance/chr25ra_upgraded2_single.e4p", Target->GetName());
						break;
					case 48:
						Person p = Game::CreatePerson("mod:Prototypes/Persons/Ambulance/chr7ra_upgraded2_single.e4p", Target->GetName());
						break;
					case 83:
					case 105:
						Person p = Game::CreatePerson("mod:Prototypes/Persons/Ambulance/sar41ra_upgraded2_single.e4p", Target->GetName());
						break;
					case 87:
						Person p = Game::CreatePerson("mod:Prototypes/Persons/Ambulance/chr8ra_upgraded2_single.e4p", Target->GetName());
						break;
					case 85:
					case 88:
						Person p = Game::CreatePerson("mod:Prototypes/Persons/Ambulance/hsra_upgraded2_single.e4p", Target->GetName());
						break;
					default:
						Person p = Game::CreatePerson("mod:Prototypes/Persons/Ambulance/paramedic_upgraded2_single.e4p", Target->GetName());
						break;
				}
				p.SetPosition(Caller);
				p.Show();
				Caller->Hide();
				Caller->PushActionExecuteCommand(ACTION_NEWLIST,"CreateNewPerson",Target,9,false);
				if (childID==71)
				{
					Caller->PushActionExecuteCommand(ACTION_APPEND,"IRLeuchte",Target,22,false);
					Caller->PushActionWait(ACTION_APPEND,1.0);
					if (Target->IsHidden())
						Caller->PushActionExecuteCommand(ACTION_APPEND,"aufsitzen",Target,984,false);
					else
						Caller->PushActionExecuteCommand(ACTION_APPEND,"aufsitzen",Target,0,false);
				} else
					p.PushActionEnterBasket(ACTION_NEWLIST,Target);

				Caller->PushActionDeleteOwner(ACTION_APPEND);
		
				break;
			default:
				Mission::PlayHint("FKK Modus oder was ? Kein gueltiges Outfit gewaehlt!");
				break;
                }
		if (tl) Caller->AssignCommand("tl");
		if (at) Caller->AssignCommand("at");
		if (wt) Caller->AssignCommand("wt");
		if (st) Caller->AssignCommand("st");
		if (ma) Caller->AssignCommand("ma");
		if (me) Caller->AssignCommand("me");
			
		switch (childID)
                {
			case 1:
				Caller->AssignCommand("GetGZ");
				Caller->AssignCommand("GetMM");
				Caller->AssignCommand("ggv_abdichten");
				Caller->AssignCommand("SetLuefter");
				Caller->RemoveCommand("GetJumppad");
				// Caller->PushActionExecuteCommand(ACTION_INSERT,"pa_check",Caller,0,false);
				break;

			case 2:
				Caller->AssignCommand("PutInCar");
				Caller->AssignCommand("GetGZ");
				Caller->AssignCommand("GetMM");
				Caller->AssignCommand("ggv_abdichten");
				// Caller->PushActionExecuteCommand(ACTION_INSERT,"pa_check",Caller,1,false);
				break;
			case 41:
				Caller->PushActionWait(ACTION_APPEND,ffw*1.0);
				Caller->PushActionMove(ACTION_APPEND,Target,TARGET_PASSENGERDOOR);
				Caller->PushActionExecuteCommand(ACTION_APPEND,"EnterCar",Target,985,true);
				ffw--;
				if (ffw<0)
					ffw=5;
				break;
                }
		Caller->SetCommandable(true);
	}
};

const char IMG[] = "sosi";

const char EACTION_FINDPATH[] = "EActionFindPath";

const char DUMMY_UPDATEPOS[] = "DUMMYUpdatePos";
const char DUMMY_FINDPATH[] = "DUMMYFindPath";

const char CMD_MOVETO[] = "MoveTo";

int DummyGroup = 20;

class WibSoSi : CommandScript
{
	bool SoSiAus(Vehicle *Fz, GameObject *horn, int sample,bool resetSpeed)
	{
		// // System::Log("SoSi Aus %s %s %u",Fz->GetName(),horn->GetName(),sample);
		if (horn->IsValid())
		{
			Audio::StopSample(sample);
			horn->PushActionDeleteOwner(ACTION_NEWLIST);
		}
		if (Fz->IsValid())
		{
			Fz->ClearFlag(FLAG_SOSI);
			if (Fz->HasCommand(DUMMY_FINDPATH))
				Fz->RemoveCommand(DUMMY_FINDPATH);
			if (resetSpeed)
				if (Fz->GetVehicleType()!=VT_AMBULANCE_RHC && Fz->GetVehicleType()!=VT_POLICE_PHC && Fz->GetVehicleType()!=VT_TV_HELI)
					Fz->SetSpeed(civspeed);
		}
		return true;
	}

	void SoSiSwitch(Vehicle v,char * hornid, bool einsatzfz, int childID, int fzid, bool stadt, bool land)
	{

			bool pressluft=stadt && land;
			bool triblitz=childID==7;
			bool civil_warn=childID==9;
			bool hornswitch=stadt||land||triblitz;
			
			// System::Log("SoSi Switch %s %u",v.GetName(),childID);

			GameObjectList ol(hornid);
			bool hashorn=ol.GetNumObjects()>0;

			if (hashorn && !hornswitch)
				for (int hx=ol.GetNumObjects()-1;hx>-1;hx--)
				{
					Audio::StopSample(ol.GetObject(hx)->GetUserData());
					ol.GetObject(hx)->PushActionDeleteOwner(ACTION_NEWLIST);
				}

			int zufall;

			if (einsatzfz)
			{
				if (civil_warn)
					v.SetSpeed(civspeed);
				else
					v.SetSpeed(fzlocal::fzspeed(&v));
				zufall=rand()%4+1;
				v.EnableBlueLights(true);
				v.EnableHeadLights(true);
			} else
				zufall=rand()%5+1;

			int sosi=fzlocal::fzsosi(&v);
			bool has_el=(sosi & 16)>0;
			bool has_prelu=(sosi & 32)>0;
			sosi=sosi & 15;


			int soundID;
			if (childID!=3 && (sosi>0 || !einsatzfz || triblitz || civil_warn))
			{
				Vector CarPos = v.GetPosition();
			
				if (!einsatzfz)
				{
					switch (childID)
					{
						case -1:
							char * wm = "mod:Audio/FX/woov/bass%u.wav";
							char * buf= "                           ";
							snprintf(buf,27,wm,zufall);
							soundID = Audio::PlaySample3D(buf, CarPos, true);
							break;
						case -2:
							soundID = Audio::PlaySample3D("mod:Audio/FX/Sirens/fluchtfzg.wav", CarPos, true);
							break;
						default:
							soundID = Audio::PlaySample3D("mod:Audio/FX/Sirens/fluchtfzg.wav", CarPos, true);
							break;
					}
				} else if (!triblitz) {				
					
					if (!hornswitch)
					{
						if (civil_warn) {
							sosi=-4;
							stadt=false;
							land=true;
						} else if (has_el) {
							stadt=(zufall & 1)>0;
							land=!stadt;
							if (has_prelu && (zufall & 4)>0)
							{
								stadt=true;
								land=true;
							}							
						} else {
							stadt=true;
							land=true;   // stadt+land = pressluft schalten
						}
					} else {
						if (!has_el)
						{
							stadt=true;
							land=true;
						} else if (!has_prelu)
							stadt=!land;
					}
					soundID = Audio::PlaySample3D(fzlocal::Signal(sosi,stadt,land), CarPos, true);
					if (has_prelu && stadt!=land && !civil_warn)
						v.SetSirenFile(fzlocal::Signal(sosi,true,true));
					else
						v.SetSirenFile("mod:Audio/silent.wav");
				} else
					soundID=-1;

				if (hashorn && hornswitch)
				{
					GameObject horn=ol.GetObject(0);
					Audio::StopSample(horn.GetUserData());
				} else 
					GameObject horn =  Game::CreateObject("mod:Prototypes/Objects/Equipment/parken.e4p", hornid);
				if (!triblitz)
					horn.Hide();
				horn.SetUserData(soundID);
				if (pressluft)
					horn.SetFlag(FLAG_SOSI);
				else
					horn.ClearFlag(FLAG_SOSI);
				horn.PushActionExecuteCommand(ACTION_NEWLIST, "SoSiPos", &v, soundID, false);
				v.SetFlag(FLAG_SOSI);
				v.AssignCommand(DUMMY_FINDPATH);
				// System::Log("SoSi AN %s %s %u",v.GetName(),horn.GetName(),childID);
			}
	}
};

object WT_SoSi : CommandScript
{
	WT_SoSi()
	{
		SetIcon(IMG);
		SetCursor(IMG);
		SetRestrictions(RESTRICT_SELFEXECUTE);
	}

	bool CheckPossible(GameObject *Caller)
	{
		if (!Caller->IsValid())
			return false;

		if (Caller->GetType() == ACTOR_VEHICLE)
		{
			return true;
		}

		return false;
	}

	bool CheckTarget(GameObject *Caller, Actor *Target, int childID)
	{
		if (!Target->IsValid() || Target->GetID() != Caller->GetID())
			return false;

		if (!Caller->HasCommand(CMD_MOVETO) || Caller->GetType() != ACTOR_VEHICLE)
			return false;

		return true;
	}

	void PushActions(GameObject *Caller, Actor *Target, int childID)
	{

		bool stadt=Input::LShiftPressed();
		bool land=Input::LCtrlPressed();
		bool triblitz=childID==7;
		bool civil_warn=childID==9;

		const char hornid[] = "               ";
		const char dummymask[]="SoSi%u";
		int fzid=-1;

		bool einsatzfz=childID<100 && childID>-1;
		
		if (Caller->GetType()==ACTOR_VEHICLE)
			Vehicle v(Caller);
		else
			Vehicle v(Target);

		System::Log("WT SOSI : Fz %s Code %u",v.GetName(),childID);

		if (childID==10)
			if (v.IsCurrentAction("EActionFindPath"))
				childID=5;
			else
				return;

		if (einsatzfz)
			fzid=fzlocal::fzid(&v);

		int x=snprintf(hornid,15,dummymask,v.GetID());

		switch (childID)
		{
			case -2:
			case -1: // MegaBass-Proll
				einsatzfz=false;
				v.SetUserData(childID);
			case 0:	// Sosi FlipFlop
				if (stadt || land)
					childID=100;
			case 3: // SoSi an mit Verzoegerung
			case 5:	// SoSi immer AN
			case 7: // Triblitz mit Umleiten an
			case 9: // Warndurchsage
				if (!v.IsFlagSet(FLAG_SOSI) || stadt || land || triblitz || civil_warn)
				{
					WibSoSi::SoSiSwitch(v,hornid,einsatzfz,childID,fzid,stadt,land);
					break;
				}
				if (childID!=0)
					break;
				
			case 1:	// SoSi aus und Blaulicht AUS
			case 2: // SoSi aus und Blaulicht AN
				// System::Log("WT Sosi : Sosi AUS Blaulicht schalten %s",v.GetName());
				if (childID < 2)
					v.EnableBlueLights(false);
				else
					v.EnableBlueLights(true);
				if (v.IsFlagSet(FLAG_SOSI))
				{			
					// System::Log("WT SoSi : SoSi AUS %s",v.GetName());
					GameObjectList list = Game::GetGameObjects(hornid);
					GameObject obj;
					int ref;
					if (list.GetNumObjects()>0)
					{
						obj = list.GetObject(0);
						ref = obj.GetUserData();
						obj.SetUserData(0);
						WibSoSi::SoSiAus(&v,&obj,ref,true);
					} else
						System::Log("Kein SoSi Obj %s",v.GetName());

				}
				break;
		}
	}
};

object SoSiPos : CommandScript
{
	SoSiPos()
	{
		SetGroupID(DummyGroup);
	}

	bool CheckTarget(GameObject *Caller, Actor *Target, int childID)
	{
		return true;
	}

  	void PushActions(GameObject *Caller, Actor *Target, int childID)
	{

		// System::Log("SoSiPos %s %s %u",Caller->GetName(),Target->GetName(),childID);

		Vehicle v(Target);
		GameObject horn(Caller);
		bool NoSoSi=false;
		bool triblitz=childID==-1;

		if (!v.IsValid() || v.IsDestroyed() || v.IsSmoking() || !v.IsFlagSet(FLAG_SOSI))
			NoSoSi=WibSoSi::SoSiAus(&v,&horn,childID,true);
		else {
			Vector CarPos = v.GetPosition();
			if (triblitz) {
				Caller->SetRotation(&v);
				Caller->SetPlacement(PLACEMENT_AXISALIGNED);
				Caller->SetPosition(&v); // v.GetChildPosition("tripos"));
				Caller->PushActionRotateTarget(ACTION_NEWLIST,Caller,0,180,0,0.1);
				Caller->PushActionRedirect(ACTION_APPEND);
				// v.Hide();
				// System::Log("Triblitz aktiviert");
			} else {
				Audio::UpdatePos(childID, CarPos, true);
				if (v.IsCurrentAction(EACTION_FINDPATH))
				{
					if (!v.HasCommand(DUMMY_FINDPATH))
						v.AssignCommand(DUMMY_FINDPATH);
				}
				if (v.HasCommand(DUMMY_FINDPATH) && v.HasCommand("WT_SoSi"))
				{
					if (!v.IsCurrentAction(EACTION_FINDPATH) && v.GetNumActions() < 2)
						NoSoSi=WibSoSi::SoSiAus(&v,&horn,childID,true);
				}
				if (!NoSoSi)
				{
					horn.PushActionWait(ACTION_NEWLIST,1.0f);
					horn.PushActionExecuteCommand(ACTION_APPEND, "SoSiPos", Target, childID, false);
				}
			}
		}
	}
};

object DUMMYFindPath : CommandScript
{
	DUMMYFindPath()
	{
		SetGroupID(DummyGroup);
	}

	bool CheckTarget(GameObject *Caller, Actor *Target, int childID)
	{
		return false;
	}

  	void PushActions(GameObject *Caller, Actor *Target, int childID)
	{
	}
};

object CreateNewPerson: CommandScript
{

	CreateNewPerson()
	{
	}

	bool CheckTarget(GameObject *Caller, Actor *Target, int childID)
	{
		return true;
	}

	void PushActions(GameObject *Caller, Actor *Target, int childID)
	{
		Vehicle vec(Target);
		int zufall = rand()%2;
		bool anderwache=false;
		bool anderwerkstatt=false;
		bool poscheck=false;
		int alarm=984;
		bool am_fz=false;
		ActorList place;
		int abfahrn=0;
		bool freiwillig=false;
		bool imhaus=false;
		bool trauma=false;
		int mp=0;
		int hausid=rwacheid;
		bool iszivi=false;
		int fzid=fzlocal::fzid(&vec);
		int ms_komplett=0;
		int forcecode=0;
		bool im_boot=false;

		// System::Log("Person erstellen %u Ziel %s Caller %s",childID,Target->GetName(),Caller->GetName());

		if (childID >999)
		{
			mp=childID/1000;
			childID=childID%1000;
		}
		
		if (childID > 300)
		{
			childID=childID-200;
			alarm=0;
		}

		if (childID > 200)
		{
			childID=childID-200;
			poscheck=true;
		}
	
		if (childID > 100)
		{
			childID=childID-100;
			anderwache=!vec.IsHidden() || childID==92 || childID==97;
			if (anderwache)
				System::Error("An der Wache");
			else 
				System::Error("Nachbarfz");
		}

		trauma=childID==86 || childID==87 || childID==84 || childID==85  || childID==88 || childID==89;
		imhaus=trauma;
		anderwache=anderwache || trauma;
		bool ersatz=childID==70;
		anderwache=anderwache && fzid!=17 && (!MissionMode ||trauma);
		bool fr=false;
		bool unblock=false;
		int cid=0;
		
		switch (fzid)
		{
			case 79:
				forcecode=-2;
				break;
			case 100:
			case 101:
			case 102:
			case 103:
			case 104:
				forcecode=-1;
				break;
			default:
				forcecode=0;
				break;
		}
		

		switch (childID)
		{
			case 1:
				// Zugfuehrung / TL
				Vehicle v(Target);
				if (v.IsFirefighter())
					Person p=Game::CreatePerson("mod:Prototypes/Persons/Fire Department/wefue.e4p",Target->GetName());
				else if (v.IsPolice())
					Person p=Game::CreatePerson("mod:Prototypes/Persons/SEK/profiler_upgrade.e4p",Target->GetName());
				else if (v.IsAmbulance())
					Person p=Game::CreatePerson("mod:Prototypes/Persons/Ambulance/drk_el.e4p",Target->GetName());
				anderwache=false;
				p.AssignCommand("fuehrung");
				p.AssignCommand("tl_gefahr");
				p.AssignCommand("tl_zug_select");
				p.AssignCommand("tl_rufe_tel");
				if (v.IsFirefighter())
				{
					p.AssignCommand("Evacuate");
					p.AssignCommand("tl_rufe_ith");
				}
			break;
			
			case 50:
				freiwillig=true;
				anderwache=false;
			case 51:
				if (childID==51)
					alarm=986;		
			case 2:
			case 60:
			//FWM
			Person p = Game::CreatePerson("mod:Prototypes/Persons/Fire Department/firefighternorm_upgrade2.e4p", Target->GetName());
			switch (fzid)
			{
				case 3:
					place=Game::GetActors("tor3");
					break;
				case 5:
					place=Game::GetActors("tor2");
					break;
				case 6:
					place=Game::GetActors("tor4");
					break;
				case 39:
					place=Game::GetActors("tor5");
					break;
				case 15:
					place=Game::GetActors("tor5");
					break;
				case 40:
					place=Game::GetActors("tor1");
					break;
				case 100:
					p.AssignCommand("unique");
					break;
				default:
					anderwache=false;
					break;
			}
			p.AssignCommand("Get_Hebekissen");
			p.AssignCommand("grollo");
			break;

			case 3:
			//Polizist
			switch(zufall)
			{
				case 0:
				Person p = Game::CreatePerson("mod:Prototypes/Persons/Police/policeman_upgraded2_m.e4p", Target->GetName());
				break;
				case 1:
				Person p = Game::CreatePerson("mod:Prototypes/Persons/Police/policeman_upgraded2_f.e4p", Target->GetName());
				break;
			}
			place=Game::GetActors("police_entry");
			p.SetShootPower(600.0);
			p.AssignCommand("vk_um_leitv");
			p.AssignCommand("vk_um_leitr");
			break;

			case 4:
			//Shooter
			Person p = Game::CreatePerson("mod:Prototypes/Persons/Police/bepo.e4p", Target->GetName());
			p.SetResistance(INJUREREASON_SHOT,25.0);
			p.SetResistance(INJUREREASON_ENERGY,300.0);
			p.SetShootPower(600.0);
			place=Game::GetActors("police_entry");
			break;

			case 41:
			//Feldjäger
			Person p = Game::CreatePerson("mod:Prototypes/Persons/Police/fj.e4p", Target->GetName());
			p.SetResistance(INJUREREASON_SHOT,25.0);
			p.SetResistance(INJUREREASON_ENERGY,300.0);
			p.SetShootPower(600.0);
			place=Game::GetActors("FJwache");
			hausid=fjid;
			imhaus=true;
			break;

			case 5:
			//Siemens Techniker
			Person p = Game::CreatePerson("mod:Prototypes/Persons/TEC/techniker.e4p",  Target->GetName());
			p.AssignCommand("bma_repair");
			break;

			case 52:
			//SAR Flugingenieur
			Person p = Game::CreatePerson("mod:Prototypes/Persons/Ambulance/SAR41ing_e4p.e4p",  Target->GetName());
			break;


			case 6:
			//ADAC
			Person p = Game::CreatePerson("mod:Prototypes/Persons/TEC/adac.e4p",  Target->GetName());
			// p.SetEquipment(EQUIP_THW_CASE);
			break;

			case 7:
			//DB-NFM
			Person p = Game::CreatePerson("mod:Prototypes/Persons/TEC/nfm.e4p",  Target->GetName());
			break;

			case 61:
			case 8:
			case 81:
			//NA
			switch(fzid)
			{
				// Person p = Game::CreatePerson("mod:Prototypes/Persons/Ambulance/doctor_upgraded2_f.e4p", Target->GetName());
				case 12:
					Person p = Game::CreatePerson("mod:Prototypes/Persons/Ambulance/chr25doc_upgraded2_m.e4p", Target->GetName());
					break;
				case 48:
					Person p = Game::CreatePerson("mod:Prototypes/Persons/Ambulance/chr7doc_upgraded2_m.e4p", Target->GetName());
					break;
				case 83:
					Person p = Game::CreatePerson("mod:Prototypes/Persons/Ambulance/sar41doc_upgraded2_m.e4p", Target->GetName());
					break;
				case 87:
					Person p = Game::CreatePerson("mod:Prototypes/Persons/Ambulance/chr8doc_upgraded2_m.e4p", Target->GetName());
					break;
				case 101:
					Person p = Game::CreatePerson("mod:Prototypes/Persons/Ambulance/thedoc.e4p", Target->GetName());
					p.AssignCommand("unique");
					p.AssignCommand("Doc_Lock");
					break;
				default:
					Person p = Game::CreatePerson("mod:Prototypes/Persons/Ambulance/doctor_upgraded2_m.e4p", Target->GetName());
					break;
			}

			if (vec.GetVehicleType()!=VT_AMBULANCE_NEF)
				p.SetEquipment(EQUIP_EMERGENCY_CASE);

			if (childID==81)
			{
				place=Game::GetActors("trauma1");
				hausid=klinikid;
				imhaus=true;			
				if (vec.GetVehicleType() == VT_AMBULANCE_RHC)
					p.SetAutoHealDistance(500.0f);
				else
					p.SetAutoHealDistance(0.0f);
			} else
				p.SetAutoHealDistance(0.0f);	// Sekundaerverleger NA darf kein AutoHeal haben, sonst wird der Code unterbrochen
			p.AssignCommand("emv");
			p.AssignCommand("SuperDoc");
			p.AssignCommand("rd117");
			break;

			case 77:
			case 9:
			case 91:
			//RA
			switch (fzid)
			{
				case 12:
					Person p = Game::CreatePerson("mod:Prototypes/Persons/Ambulance/chr25ra_upgraded2_single.e4p", Target->GetName());
					break;
				case 48:
					Person p = Game::CreatePerson("mod:Prototypes/Persons/Ambulance/chr7ra_upgraded2_single.e4p", Target->GetName());
					break;
				case 105:
				case 83:
					Person p = Game::CreatePerson("mod:Prototypes/Persons/Ambulance/sar41ra_upgraded2_single.e4p", Target->GetName());
					break;
				case 87:
					Person p = Game::CreatePerson("mod:Prototypes/Persons/Ambulance/chr8ra_upgraded2_single.e4p", Target->GetName());
					break;
				case 85:
				case 88:
					Person p = Game::CreatePerson("mod:Prototypes/Persons/Ambulance/hsra_upgraded2_single.e4p", Target->GetName());
					break;
				case 101:
					Person p = Game::CreatePerson("mod:Prototypes/Persons/Ambulance/doc_helfer.e4p", Target->GetName());
					p.AssignCommand("unique");
					p.AssignCommand("Doc_Lock");
					break;
				default:
					Person p = Game::CreatePerson("mod:Prototypes/Persons/Ambulance/paramedic_upgraded2_single.e4p", Target->GetName());
					break;
			}
			switch (vec.GetVehicleType())
			{
				case VT_AMBULANCE_RTW:
					p.AssignCommand("EnterBasket");
					p.AssignCommand("BasketDown");
					break;

				case VT_AMBULANCE_NEF:
					p.RemoveCommand("ratransport");
					p.AssignCommand("gf_lage");
					p.AssignCommand("fuehrung");
					break;
			
				case VT_AMBULANCE_RHC:
				case VT_THW_FGRT_BH:
					p.AssignCommand("EnterBasket");
					p.AssignCommand("BasketDown");
					p.AssignCommand("gf_lage");
					p.AssignCommand("fuehrung");
					break;
			}
			if (childID==91)
			{
				if (fzid==105)
				{
					place=Game::GetActors("bw_sani");
					hausid=bwid;
				} else
					place=Game::GetActors("rwache");
				imhaus=true;			
			} 

			p.AssignCommand("GetExtinguisher");
			p.AssignCommand("Extinguish");
			p.AssignCommand("Cool");

			break;

			case 35:
			case 34:
				switch (fzid)
				{
					case 12:
						Person p = Game::CreatePerson("mod:Prototypes/Persons/Ambulance/chr25ra_upgraded2.e4p", Caller->GetName());
						break;
					case 48:
						Person p = Game::CreatePerson("mod:Prototypes/Persons/Ambulance/chr7ra_upgraded2.e4p", Caller->GetName());
						break;
					case 83:
						Person p = Game::CreatePerson("mod:Prototypes/Persons/Ambulance/sar41ra_upgraded2.e4p", Caller->GetName());
						break;
					case 87:
						Person p = Game::CreatePerson("mod:Prototypes/Persons/Ambulance/chr8ra_upgraded2.e4p", Caller->GetName());
						break;
					case 85:
					case 88:
						Person p = Game::CreatePerson("mod:Prototypes/Persons/Ambulance/hsra_upgraded2.e4p", Caller->GetName());
						break;
					default:
                       				Person p = Game::CreatePerson("mod:Prototypes/Persons/Ambulance/paramedic02_upgraded2.e4p",Caller->GetName());
						break;
				}

				p.AssignCommand("ActionEmptyRTW");
				if (childID==35)
					p.SetFlag(FLAG_SOSI);
			break;

			case 10:
			//Bestatter
			Person p = Game::CreatePerson("mod:Prototypes/Persons/Ambulance/bestatter.e4p",  Target->GetName());
			break;

			case 11:
			//Sharpshooter
			Person p = Game::CreatePerson("mod:Prototypes/Persons/SEK/sharpshooter_upgraded2.e4p",  Target->GetName());
			p.SetEquipment(EQUIP_RIFLE);
			p.SetResistance(INJUREREASON_SHOT,panzer);
			p.SetShootPower(1400.0);
			p.SetShootRange(1536.0f);
			break;

			case 12:
			//LNA
			Person p = Game::CreatePerson("mod:Prototypes/Persons/Fire Department/LNA.e4p", Target->GetName());
			p.SetEquipment(EQUIP_EMERGENCY_CASE);
			p.AssignCommand("rufe_seg");
			p.SetAutoHealDistance(0.0f);
			break;

			case 13:
			//FWM
			Person p = Game::CreatePerson("mod:Prototypes/Persons/Fire Department/firefightermask_upgraded2.e4p",  Target->GetName());
			p.AssignCommand("ggv_abdichten");
			p.AssignCommand("SetLuefter");
			p.RemoveCommand("GetGZ");
			p.RemoveCommand("GetMM");
			p.RemoveCommand("GetJumppad");
			break;

			case 14:
			//Diver
			Person p = Game::CreatePerson("mod:Prototypes/Persons/Fire Department/diver_upgraded2.e4p",  Target->GetName());
			Vehicle v(Target);
			im_boot=v.GetVehicleType()==VT_FIREFIGHTERS_FMB;
			break;

			case 15:
			//ABC
			Person p = Game::CreatePerson("mod:Prototypes/Persons/Fire Department/firefighterabc_upgraded2.e4p",  Target->GetName());
			p.AssignCommand("ggv_abdichten");
			p.AssignCommand("GetMM");
			p.AssignCommand("GetGZ");
			break;

			case 16:
			//Kampfmittelraeumer
			Person p = Game::CreatePerson("mod:Prototypes/Persons/TEC/kmrd.e4p",  Target->GetName());
			p.AssignCommand("Repair");
			break;

			case 18:
			//SEG-Sani
			Person p = Game::CreatePerson("mod:Prototypes/Persons/Ambulance/drk_helfer.e4p",  Target->GetName());
			switch (fzid)
			{
				case 37:		
					p.AssignCommand("SetZelt");
					break;
				case 95:
					p.AssignCommand("POL_GetDog");
					break;
			}
			break;

			case 19:
			//SEG-Arzt
			switch(zufall)
			{
				case 0:
				Person p = Game::CreatePerson("mod:Prototypes/Persons/Ambulance/doctor_upgraded2_f.e4p", Target->GetName());
				break;
				case 1:
				Person p = Game::CreatePerson("mod:Prototypes/Persons/Ambulance/doctor_upgraded2_m.e4p", Target->GetName());
				break;
			}
			p.SetEquipment(EQUIP_EMERGENCY_CASE);
			p.SetAutoHealDistance(0.0f);
			p.RemoveCommand("lna_start_triage");
			break;

			case 20:	// DRK EL
			Person p = Game::CreatePerson("mod:Prototypes/Persons/Ambulance/drk_el.e4p",  Target->GetName());
			p.AssignCommand("fuehrung");
			p.AssignCommand("tl");
			p.AssignCommand("tl_abmarsch");
			p.AssignCommand("tl_gefahr");
			break;

			case 21:
			// Hundeführer
			Person p = Game::CreatePerson("mod:Prototypes/Persons/Ambulance/hundefuehrer.e4p",  Target->GetName());
			break;

			case 25:
			// Mechaniker Werkstatt
			Person p = Game::CreatePerson("mod:Prototypes/Persons/TEC/adac.e4p",  "Mechaniker");
			place=Game::GetActors("werkstatt_entry");
			anderwache=true;
			anderwerkstatt=true;
			break;

			case 26:
			// THW Personal
			Person p = Game::CreatePerson("mod:Prototypes/Persons/TEC/engineer_upgraded2.e4p",  Target->GetName());
			p.SetEquipment(EQUIP_THW_CASE);
			break;

			case 29:
			Person p = Game::CreatePerson("mod:Prototypes/Persons/Ambulance/paramedic02_upgraded2.e4p", Caller->GetName());
			am_fz=true;
			Vehicle vec(Caller);
			break;

			case 30:
			// SEK Shooter
			Person p = Game::CreatePerson("mod:Prototypes/Persons/SEK/shooter_upgraded2.e4p", Target->GetName());
			p.SetResistance(INJUREREASON_SHOT,panzer);
			p.SetResistance(INJUREREASON_ENERGY,1000.0);
			p.SetShootPower(750.0);
		
			break;
			
			case 31:
			// SEK Scout
			Person p = Game::CreatePerson("mod:Prototypes/Persons/SEK/scout_upgraded2.e4p", Target->GetName());
			p.SetResistance(INJUREREASON_SHOT,panzer);
			p.SetResistance(INJUREREASON_ENERGY,1000.0);
			p.SetShootPower(600.0);
			break;

			case 32:
			// Hund
			Person p = Game::CreatePerson("mod:Prototypes/Persons/Ambulance/rescuedog.e4p", Target->GetName());
			vec.AddTransport(&p);
			return;
			break;

			case 33:
			case 62:
			//Polizist zivil
			switch(zufall)
			{
				case 0:
				Person p = Game::CreatePerson("mod:Prototypes/Persons/Police/policeman_zivil1.e4p", Target->GetName());
				break;
				case 1:
				Person p = Game::CreatePerson("mod:Prototypes/Persons/Police/policeman_zivil2.e4p", Target->GetName());
				break;
			}
			place=Game::GetActors("police_entry");
			p.SetShootPower(600.0);
			if (childID==62)
				p.AssignCommand("unique");
			break;

			case 84:
			// Chirurg
			Person p = Game::CreatePerson("mod:Prototypes/Persons/Ambulance/oparzt.e4p",Caller->GetName());
			place=Game::GetActors("trauma1");
			// p.AssignCommand("Pat_in_OP");
			p.SetAutoHealDistance(0.0);
			p.Hide();
			hausid=klinikid;
			cid=1;
			break;

			case 88:
				unblock=true;
				cid=1;
			case 85:
			// OPPflege
			Person p = Game::CreatePerson("mod:Prototypes/Persons/Ambulance/oppfleger.e4p",Caller->GetName());
			place=Game::GetActors("trauma1");
			p.RemoveCommand("ratransport");
			p.Hide();
			hausid=klinikid;
			cid+=1;
			break;

			case 86:
			// SchockraumDoc
			Person p = Game::CreatePerson("mod:Prototypes/Persons/Ambulance/arzt.e4p",Caller->GetName());
			place=Game::GetActors("bett151");
			p.SetEquipment(EQUIP_EMERGENCY_CASE);
			p.AssignCommand("trauma_ende");
			p.Hide();
			hausid=klinikid;
			break;

			case 89:
			// SchockraumPflege
			// unblock=true;
			case 87:
			Person p = Game::CreatePerson("mod:Prototypes/Persons/Ambulance/pfleger.e4p",Caller->GetName());
			place=Game::GetActors("bett152");
			p.RemoveCommand("ratransport");
			p.Hide();
			hausid=klinikid;
			break;

			
			case 70:
			if ((vec.GetNumPassengers()>0) || (vec.GetFreePassengers()==0))
				return;
			// faehrt neue Autos nach hause
			Person p = Game::CreatePerson("mod:Prototypes/Persons/Civil/civilman02_silver.e4p", Target->GetName());
			break;

			case 92:	// Rufbereitschaft Leitstelle
				place=Game::GetActors("leitstelle");
				imhaus=true;
				hausid=lst_id;
			case 90:
				if (childID==90)
					Person p = Game::CreatePerson("mod:Prototypes/Persons/Tec/disponent.e4p", "disponent");
				else
					Person p = Game::CreatePerson("mod:Prototypes/Persons/Tec/disponent.e4p", Target->GetName());
				p.AssignCommand("switch_fms");
				p.AssignCommand("switch_alarm");
				p.AssignCommand("sirprobe");
				if (childID==92)
				{
					p.SetPlayerMP(mp);
					p.AssignCommand("platzwahl");
					p.AssignCommand("tl_rufe_fw");
					p.AssignCommand("tl_rufe_rd");
					p.AssignCommand("tl_rufe_rest");
					p.AssignCommand("tl_rufe_na");
					p.AssignCommand("tl_rufe_fza");
					p.AssignCommand("KlinikStatus0");
					p.AssignCommand("KatS");
					p.AssignCommand("KatSEnde");
					p.SetFlag(FLAG_TL);
					p.AssignCommand("sofa");
				} else {
					p.AssignCommand("switch_alarm");
					p.AssignCommand("switch_fms");
					p.AssignCommand("uminus");
					p.AssignCommand("uplus");
					p.AssignCommand("schneeaus");
					p.AssignCommand("KlinikStatus0");
					p.AssignCommand("KatS");
					p.AssignCommand("KatSEnde");
					p.AssignCommand("sirprobe");
					p.AssignCommand("driving_through_winterberg");
					p.AssignCommand("switch_c1");
					p.AssignCommand("switch_c2");
					p.AssignCommand("switch_c3");
					p.AssignCommand("switch_c5");
					p.AssignCommand("switch_c4");
					p.AssignCommand("WibCam");
					p.AssignCommand("MoveTo");
					p.AssignCommand("EnterHouse");
				}
				p.SetCommandable(true);
				break;

			case 97:
			// Ampelzivi
			PathList pl("zivi_path");
			iszivi=(pl.GetNumPaths())>0;
			if (iszivi) {
				Person p = Game::CreatePerson("mod:Prototypes/Persons/Ambulance/ampelzivi.e4p","ampelzivi");
				place=Game::GetActors("gate_8851");
				p.RemoveCommand("ratransport");
				p.SetEquipment(EQUIP_REDIRECTSIGN);
				p.SetSpeed (3.5);
				zivi=p;
			} else 
				return;  // dirty aber funzt;
			// System::Log("Ampelzivi");
			break;

			case 99:
			//senden-Objekt
			Person p = Game::CreatePerson("mod:Prototypes/Persons/Fire Department/firefighternorm_upgrade2.e4p", "5tongeber");
			p.SetCommandable(false);
			anderwache=true;
			place=Game::GetActors("platz2");
			p.Hide();
			return;
			break;

			default:
				Mission::PlayHint("Ungueltiger PersonalCode");
				Mission::PlayHint(vec.GetName());
				System::Error("Ungueltiger PersonalCode");
				System::Error(vec.GetName());
				return;
				break;
		}
		
		p.SetUpgradeLevel(2);

		if ((vec.IsAmbulance() && vec.IsFlagSet(FLAG_NA)) || trauma)
			p.SetUserData(44); // unterbindet NA-Nachforderung bei Erstversorgung
		else
			p.SetUserData(0);

		if (!p.HasCommand("heal") && !p.HasCommand("raheal") && childID<90)
			p.AssignCommand("eh");

		if (!p.HasCommand("Dive"))
			p.AssignCommand("ChangeToHassHoff");

		if (Game::IsMultiplayer() && childID!=92)
			p.SetPlayerMP(Caller->GetPlayerMP());

		if (anderwache)
		{
			p.Hide();
			Actor *Entry=place.GetActor(0);
			Vector pos=Entry->GetPosition();
			Game::FindAvailablePosition(&p,pos,100,imhaus);
			if (imhaus)
				p.SetEnteredHouseID(hausid);
			p.SetCommandable(true);
			p.SetPosition (pos);
			p.Show();
			if (iszivi)
			{
				Path path(pl.GetPath(0));
				Vector Pos=path.GetPoint(11);
				p.PushActionMove(ACTION_NEWLIST,Pos);
				Pos=path.GetPoint(10);
				p.PushActionTurnTo(ACTION_APPEND,Pos);
				p.PushActionHalt(ACTION_APPEND,500,HALT_BOTH);
			} else if (anderwerkstatt) 
			{
				p.PushActionMove(ACTION_NEWLIST,Target,TARGET_PASSENGERDOOR);
				p.PushActionTurnTo(ACTION_APPEND,Target);
				p.PushActionRepair(ACTION_APPEND,Caller);
				p.PushActionExecuteCommand(ACTION_APPEND,"sendhome",Caller,11,false);
				p.PushActionMove(ACTION_APPEND,pos);
				p.PushActionWait(ACTION_APPEND,1.0);
				p.PushActionDeleteOwner(ACTION_APPEND);
			} else if (trauma) {
				p.PushActionExecuteCommand(ACTION_NEWLIST,"InDieAnstalt",Target,cid,false);
			} else {
				p.PushActionExecuteCommand(ACTION_NEWLIST,"MoveTo",Target,112,true);			
				p.PushActionExecuteCommand(ACTION_APPEND,"entercar",Target,alarm,true);
				switch (childID)
				{
					case 99:
					case 92:
						p.PushActionWait(ACTION_NEWLIST,0.1f);
						break;
					case 20:
						p.PushActionMove(ACTION_NEWLIST,Target,TARGET_PASSENGERDOOR);
						p.PushActionExecuteCommand(ACTION_APPEND,"ChangeToDiver",Target,0,false);			
						break;
					default:
						break;
				}
			}
		} else if (freiwillig)
				p.PushActionExecuteCommand(ACTION_NEWLIST,"Freiwillige",Target,fzlocal::fzort(Target),false);
			else
			{
				vec.AddPassenger(&p);
				if (am_fz)
				{
					p.PushActionLeaveCar(ACTION_NEWLIST,&vec);
					p.PushActionExecuteCommand(ACTION_APPEND,"Lift",Target,0,false);
				} else if (im_boot)
						p.PushActionLeaveCar(ACTION_NEWLIST,Target);
					else
						p.PushActionExecuteCommand(ACTION_NEWLIST,"mannschaft_komplett",Target,forcecode,false);			
			}
	}
};

//
// Abschnitt FwGeraete -> Kommandoschnittstelle zum Geraeteaufbau
//

object SetVerteiler : CommandScript
{

	bool via_ts=false;

	SetVerteiler()
	{
		SetValidTargets(ACTOR_FLOOR |  ACTOR_STREET |ACTOR_VIRTUAL);
		SetIcon("verteiler");
		SetCursor("verteiler");
		SetGroupLeader(true);
		SetPriority(500);
	}

	bool CheckPossible(GameObject *Caller)
	{
		return Caller->GetUserData()==200 && Input::LShiftPressed();
	}
	
	bool CheckGroupVisibility(GameObject *Caller)
	{
		return Input::LShiftPressed();
	}

	bool CheckTarget(GameObject *Caller, Actor *Target, int childID)
	{
		if (!Caller->IsValid() || (Caller->GetID() == Target->GetID()))
			return false;

		via_ts=Input::LCtrlPressed();

		return true;
	}

	void PushActions(GameObject *Caller, Actor *Target, int childID)
	{
		if (Target->GetType()==ACTOR_FLOOR || Target->GetType()==ACTOR_STREET)
		{
			GameObject t=bungarext::hierhin(Game::GetCommandPos());
			Target=&t;
		}
		Caller->PushActionExecuteCommand(ACTION_NEWLIST,"gf_verteiler",Target,-1*int(via_ts),false);
		via_ts=false;
	}
};

object Radar : CommandScript
{
	Radar()
	{
		SetCursor("start");
		SetIcon("start");
		SetGroupLeader(false);
		SetRestrictions(RESTRICT_NOTDESTROYED);
	}

	bool CheckPossible(GameObject *Caller)
	{
		return true;
	}

	bool CheckGroupVisibility(GameObject *Caller)
	{
		bool zeig=true;
		if (Caller->GetType() == ACTOR_PERSON)
		{
			Person p(Caller);
			zeig=!p.IsEquipped();
		} 
		return zeig;
	}

	bool CheckTarget(GameObject *Caller, Actor *Target, int childID)
	{

		bool ok=Caller->GetID()!=Target->GetID();
		if (ok) {
			if (Caller->GetType() == ACTOR_VEHICLE)
			{
				Vehicle v(Caller);
			} else {
				Person p(Caller);
				if (p.IsValid() && (p.IsCarryingPerson()||p.IsLinkedWithPerson()|| p.GetFirehoseID()!=0 || p.IsPulling() || p.GetEnteredCarID() != -1))
					return false;
			}
			// System::Log("%s %s",Caller->GetName(),Target->GetName());
			ok=Target->GetType()!=ACTOR_PERSON;
		}
		return ok; 
	}

	void dev_raus (GameObject *Caller, Actor *Target, int childID, Vehicle v)
	{
		if (Target->GetType()==ACTOR_FLOOR || Target->GetType()==ACTOR_STREET)
		{
			GameObject t=bungarext::hierhin(Game::GetCommandPos());
			Target=&t;
		}
		if (Caller->GetType() == ACTOR_VEHICLE)
		{
			PersonList pl(Caller->GetName());
			for (int i=0;i<pl.GetNumPersons() && pl.GetPerson(i)->HasCommand("fuehrung");i++);
			if (i<pl.GetNumPersons() && !pl.GetPerson(i)->HasCommand("fuehrung"))
			{
				Person p=pl.GetPerson(i);
				p.PushActionExecuteCommand(ACTION_NEWLIST,"FwGeraet_raus",Target,125,false);
				if (p.GetEnteredCarID()>1)
					p.PushActionLeaveCar(ACTION_INSERT,Caller);
			}
		} else
			Caller->PushActionExecuteCommand(ACTION_NEWLIST,"FwGeraet_raus",Target,125,false);
	}

	void PushActions(GameObject *Caller, Actor *Target, int childID)
	{
		if (Caller->GetType()==ACTOR_VEHICLE)
			Vehicle v(Caller);
		else {
			VehicleList vl(Caller->GetName());
			Vehicle v=vl.GetVehicle(0);
		}
		dev_raus(Caller,Target,childID,v);
	}
};

object Schnellangriff : CommandScript
{
	Schnellangriff()
	{
		SetCursor("schnella");
		SetIcon("schnella");
		SetGroupLeader(false);
		SetRestrictions(RESTRICT_NOTDESTROYED);
		SetPriority(93);
	}

	bool CheckPossible(GameObject *Caller)
	{
		return fzlocal::has_equip(Caller,15) && !Caller->HasCommand("fuehrung") && !Caller->IsEquipped() && !Input::LCtrlPressed();
	}

	bool CheckGroupVisibility(GameObject *Caller)
	{
		bool zeig=true;
		if (Caller->GetType() == ACTOR_PERSON)
		{
			Person p(Caller);
			zeig=!p.IsEquipped();
		} 

		zeig=zeig && fzlocal::has_equip(Caller,15);
		return zeig;
	}

	bool CheckTarget(GameObject *Caller, Actor *Target, int childID)
	{

		bool ok=Caller->GetID()!=Target->GetID();
		if (ok) {
			if (Caller->GetType() == ACTOR_VEHICLE)
			{
				Vehicle v(Caller);
			} else {
				Person p(Caller);
				if (p.IsValid() && (p.IsCarryingPerson()||p.IsLinkedWithPerson()|| p.GetFirehoseID()!=0 || p.IsPulling() || p.GetEnteredCarID() != -1))
					return false;
			
				switch (p.GetPersonType())
				{
					case PT_FIREFIGHTER_ABC:
					case PT_FIREFIGHTER_MASK:
						break;
					default:
						ok=false;
				}
			}
			// System::Log("%s %s",Caller->GetName(),Target->GetName());
			ok=Target->GetType()!=ACTOR_PERSON;
		}
		return ok; 
	}

	void sa_raus (GameObject *Caller, Actor *Target, int childID, Vehicle v)
	{
		if (Target->GetType()==ACTOR_FLOOR || Target->GetType()==ACTOR_STREET)
		{
			GameObject t=bungarext::hierhin(Game::GetCommandPos());
			Target=&t;
		}
		if (Caller->GetType() == ACTOR_VEHICLE)
		{
			PersonList pl(v.GetName());
			for (int i=0;i<pl.GetNumPersons() && pl.GetPerson(i)->HasCommand("fuehrung");i++);
			if (i<pl.GetNumPersons() && !pl.GetPerson(i)->HasCommand("fuehrung") && !pl.GetPerson(i)->IsEquipped() && !pl.GetPerson(i)->HasCommand("ich_bin_nicht_frei") && pl.GetPerson(i)->IsIdle())
			{
				Person p=pl.GetPerson(i);
				p.PushActionExecuteCommand(ACTION_APPEND,"FwGeraet_raus",Target,105,false);
				if (p.GetEnteredCarID()>1)
					p.PushActionLeaveCar(ACTION_INSERT,Caller);
			}
		} else
			Caller->PushActionExecuteCommand(ACTION_NEWLIST,"FwGeraet_raus",Target,105,false);
		Caller->PushActionExecuteCommand(ACTION_INSERT,"ma_pumpe",Caller,0,false);
	}

	void PushActions(GameObject *Caller, Actor *Target, int childID)
	{
		if (Caller->GetType()==ACTOR_VEHICLE)
			Vehicle v(Caller);
		else {
			VehicleList vl(Caller->GetName());
			Vehicle v=vl.GetVehicle(0);
		}
		if (v.IsChildEnabled("pumpe"))
			sa_raus(Caller,Target,childID,v);
		else
			Mission::PlayHint("WIB_NO_TS_NO_SA");				
	}
};

object SetMonitor : CommandScript
{
	SetMonitor()
	{
		SetCursor("Monitor");
		SetIcon("Monitor");
		SetGroupLeader(false);
		SetValidTargets(ACTOR_FLOOR | ACTOR_VIRTUAL);
	}

	bool CheckPossible(GameObject *Caller)
	{
		return fzlocal::has_equip(Caller,11);
	}

	bool CheckGroupVisibility(GameObject *Caller)
	{
		if (Caller->GetType() != ACTOR_PERSON)
			return false;
		Person p(Caller);
		bool zeig=(!Caller->IsEquipped() && fzlocal::has_equip(Caller,11));
		zeig = zeig && !Caller->HasCommand("ma");
		return zeig;
	}

	bool CheckTarget(GameObject *Caller, Actor *Target, int childID)
	{

		if (!Caller->IsValid() || (Caller->GetID()==Target->GetID()))
			return false;

		Person p(Caller);
		if (p.IsValid() && (p.IsCarryingPerson()||p.IsLinkedWithPerson()|| p.GetFirehoseID()!=0 || p.IsPulling() || p.GetEnteredCarID() != -1))
			return false;
		
		switch (p.GetPersonType())
		{
			case PT_FIREFIGHTER_NORMAL:
			case PT_FIREFIGHTER_MASK:
				break;
			default:
				return false;
		}
			
	    	VehicleList vl(Caller->GetName());
		Vehicle v=vl.GetVehicle(0);
		if (fzlocal::has_equip(&v,11))
			return true;
		else 	
			return false;
	}

	void PushActions(GameObject *Caller, Actor *Target, int childID)
	{
		if (Target->GetType()==ACTOR_FLOOR || Target->GetType()==ACTOR_STREET)
		{
			GameObject t=bungarext::hierhin(Game::GetCommandPos());
			Target=&t;
		}
		Caller->PushActionExecuteCommand(ACTION_NEWLIST,"FwGeraet_raus",Target,101,false);
		Caller->PushActionExecuteCommand(ACTION_INSERT,"ma_pumpe",Caller,0,false);
	}
};

object SetPylone : CommandScript
{
	SetPylone()
	{
		SetCursor("Pylone");
		SetIcon("Pylone");
		SetGroupLeader(false);
		SetValidTargets(ACTOR_FLOOR | ACTOR_VIRTUAL);
	}

	bool CheckPossible(GameObject *Caller)
	{
		if (Caller->GetUserData()==103)
			SetPriority(1000);
		else
			SetPriority(0);
		return fzlocal::has_equip(Caller,13);
	}

	bool CheckGroupVisibility(GameObject *Caller)
	{
		if (Caller->GetType() != ACTOR_PERSON)
			return false;
		Person p(Caller);
		bool zeig=(!Caller->IsEquipped() && fzlocal::has_equip(Caller,13));
		return zeig;
	}

	bool CheckTarget(GameObject *Caller, Actor *Target, int childID)
	{

		if (!Caller->IsValid() || (Caller->GetID()==Target->GetID()))
			return false;

		Person p(Caller);
		if (p.IsValid() && (p.IsCarryingPerson()||p.IsLinkedWithPerson()|| p.GetFirehoseID()!=0 || p.IsPulling() || p.GetEnteredCarID() != -1))
			return false;
		
		switch (p.GetPersonType())
		{
			case PT_FIREFIGHTER_NORMAL:
			case PT_FIREFIGHTER_MASK:
			case PT_POLICEMEN:
				break;
			default:
				return false;
		}
			
	    	VehicleList vl(Caller->GetName());
		Vehicle v=vl.GetVehicle(0);
		if (fzlocal::has_equip(&v,13))
			return true;
		else 	
			return false;
	}

	void PushActions(GameObject *Caller, Actor *Target, int childID)
	{
		int code=103;
		if (Input::LCtrlPressed())
			code|=1024;
		if (Target->GetType()==ACTOR_FLOOR || Target->GetType()==ACTOR_STREET)
		{
			GameObject t=bungarext::hierhin(Game::GetCommandPos());
			Target=&t;
		}
		Caller->PushActionExecuteCommand(ACTION_NEWLIST,"FwGeraet_raus",Target,code,false);
	}
};

object AutoUmleiten : CommandScript
{
	AutoUmleiten()
	{
		SetCursor("umleiten");
		SetIcon("umleiten");
		SetRestrictions(RESTRICT_SELFEXECUTE);
		SetGroupID(3);
	}

	   bool CheckGroupVisibility(GameObject *Caller)
	   {
		return !Caller->IsFlagSet(FLAG_TL);
	   }

	bool CheckPossible(GameObject *Caller)
	{
		Vehicle v(Caller);
		return true;
	}

	bool CheckTarget(GameObject *Caller, Actor *Target, int childID)
	{
		Vehicle v(Caller);
		if (!Caller->IsValid() || (Caller->GetID()!=Target->GetID()))
			return false;
		return true;
	}

	void PushActions(GameObject *Caller, Actor *Target, int childID)
	{
		Caller->PushActionRedirect(ACTION_NEWLIST);
	}
};

object SetSelbstschutz : CommandScript
{
	SetSelbstschutz()
	{
		SetCursor("wateron");
		SetIcon("wateron");
		SetRestrictions(RESTRICT_SELFEXECUTE);
	}

	bool CheckPossible(GameObject *Caller)
	{
		return true;
	}

	bool CheckTarget(GameObject *Caller, Actor *Target, int childID)
	{
		Vehicle v(Caller);
		if (!Caller->IsValid() || (Caller->GetID()!=Target->GetID()))
			return false;
		return true;
	}

	void PushActions(GameObject *Caller, Actor *Target, int childID)
	{
		fzlocal::selbstschutz(Caller,!Caller->IsChildEnabled("selbstsch01"));
	}
};

object SetZelt : CommandScript
{
	SetZelt()
	{
		SetCursor("segzelt");
		SetIcon("segzelt");
		SetValidTargets(ACTOR_FLOOR | ACTOR_VIRTUAL);
	}

	bool CheckPossible(GameObject *Caller)
	{
		return fzlocal::has_equip(Caller,17);
	}


	bool CheckGroupVisibility(GameObject *Caller)
	{
		if (Caller->GetType() != ACTOR_PERSON)
			return false;
		Person p(Caller);
		return !Caller->IsEquipped() && fzlocal::has_equip(Caller,17);
	}

	bool CheckTarget(GameObject *Caller, Actor *Target, int childID)
	{

		if (!Caller->IsValid() || (Caller->GetID()==Target->GetID()))
			return false;

		Person p(Caller);
		return (p.IsValid() && !p.IsCarryingPerson() && !p.IsLinkedWithPerson() && p.GetFirehoseID()==0 && ! p.IsPulling() && p.GetEnteredCarID() == -1);
	}

	void PushActions(GameObject *Caller, Actor *Target, int childID)
	{
		if (childID==1)
		{
			ActorList zl("wm_zelt");
			Vehicle v(Caller);
			PersonList pl=v.GetPassengers();
			Person p=pl.GetPerson(0);
			p.PushActionLeaveCar(ACTION_NEWLIST,Caller);
			p.PushActionExecuteCommand(ACTION_APPEND,"FwGeraet_raus",zl.GetActor(0),108,false);		
		} else  {
			if (Target->GetType()==ACTOR_FLOOR || Target->GetType()==ACTOR_STREET)
			{
				GameObject t=bungarext::hierhin(Game::GetCommandPos());
				Target=&t;
			}
			Caller->PushActionExecuteCommand(ACTION_NEWLIST,"FwGeraet_raus",Target,108,false);
		}
	}


};

object SetLima : CommandScript
{
	SetLima()
	{
		SetCursor("lima");
		SetIcon("lima");
		SetGroupLeader(false);
		SetValidTargets(ACTOR_FLOOR | ACTOR_VIRTUAL|ACTOR_STREET);
	}

	bool CheckPossible(GameObject *Caller)
	{
		return fzlocal::has_equip(Caller,14);
	}

	bool CheckGroupVisibility(GameObject *Caller)
	{
		if (Caller->GetType() != ACTOR_PERSON)
			return false;
		Person p(Caller);
		bool zeig=(!Caller->IsEquipped() && fzlocal::has_equip(Caller,14));
		return zeig;
	}

	bool CheckTarget(GameObject *Caller, Actor *Target, int childID)
	{

		if (!Caller->IsValid() || (Caller->GetID()==Target->GetID()))
			return false;

		Person p(Caller);
		if (p.IsValid() && (p.IsCarryingPerson()||p.IsLinkedWithPerson()|| p.GetFirehoseID()!=0 || p.IsPulling() || p.GetEnteredCarID() != -1))
			return false;
		
		switch (p.GetPersonType())
		{
			case PT_FIREFIGHTER_NORMAL:
			case PT_FIREFIGHTER_MASK:
			case PT_SHOOTER:
			case PT_POLICEMEN:
				break;
			default:
				return false;
		}
			
	    	VehicleList vl(Caller->GetName());
		Vehicle v=vl.GetVehicle(0);
		if (fzlocal::has_equip(&v,14))
			return true;
		else 	
			return false;
	}

	void PushActions(GameObject *Caller, Actor *Target, int childID)
	{
		if (Target->GetType()==ACTOR_FLOOR || Target->GetType()==ACTOR_STREET)
		{
			GameObject t=bungarext::hierhin(Game::GetCommandPos());
			Target=&t;
		}
		Caller->PushActionExecuteCommand(ACTION_NEWLIST,"FwGeraet_raus",Target,104,false);
	}
};

object SetLuefter : CommandScript
{
	SetLuefter()
	{
		SetCursor("luefter");
		SetIcon("luefter");
		SetGroupID(CGROUP_GETEQUIPMENT);
		SetGroupLeader(false);
		SetValidTargets(ACTOR_OPEN_HOUSE);
	}

	bool CheckPossible(GameObject *Caller)
	{
		return fzlocal::has_equip(Caller,22);
	}

	bool CheckGroupVisibility(GameObject *Caller)
	{
		if (Caller->GetType() != ACTOR_PERSON)
			return false;
		Person p(Caller);
		bool zeig=(!Caller->IsEquipped() && fzlocal::has_equip(Caller,22));
		return zeig;
	}

	bool CheckTarget(GameObject *Caller, Actor *Target, int childID)
	{

		if (!Caller->IsValid() || (Caller->GetID()==Target->GetID()))
			return false;

		Person p(Caller);
		if (p.IsCarryingPerson()||p.IsLinkedWithPerson()|| p.GetFirehoseID()!=0 || p.IsPulling() || p.GetEnteredCarID() != -1)
			return false;
		
		if (fzlocal::has_equip(Caller,22))
			return true;
		else 	
			return false;
	}

	void PushActions(GameObject *Caller, Actor *Target, int childID)
	{
		Caller->PushActionExecuteCommand(ACTION_NEWLIST,"FwGeraet_raus",Target,112,false);
		Person p(Caller);
		if (p.GetPersonType()!=PT_FIREFIGHTER_MASK)
		{
			p.PushActionExecuteCommand(ACTION_INSERT,"ChangeToMask",Caller,101,false);
		}
	}
};

object ggv_abdichten : CommandScript
{

	ggv_abdichten()
	{
		SetCursor("abdichten");
		SetIcon("abdichten");
		SetGroupID(CGROUP_GETEQUIPMENT);
		SetGroupLeader(false);
		SetValidTargets(ACTOR_VEHICLE);
	}

	bool CheckGroupVisibility(GameObject *Caller)
	{
		if (Caller->GetType() != ACTOR_PERSON)
			return false;
		Person p(Caller);
		bool zeig=(!Caller->IsEquipped() && fzlocal::has_equip(Caller,19));
		return zeig;
	}

	bool CheckPossible(GameObject *Caller)
	{
		return fzlocal::has_equip(Caller,19);
	}

	bool CheckTarget(GameObject *Caller, Actor *Target, int childID)
	{

		if (!Caller->IsValid())
			return false;

		Person p(Caller);
		if (p.IsValid() && (p.IsCarryingPerson()||p.IsLinkedWithPerson()|| p.GetFirehoseID()!=0 || p.IsPulling() || p.GetEnteredCarID() != -1))
			return false;
		
		switch (p.GetPersonType())
		{
			case PT_FIREFIGHTER_NORMAL:
			case PT_FIREFIGHTER_MASK:
			case PT_FIREFIGHTER_ABC:
				break;
			default:
				return false;
		}
			
		bool avail=fzlocal::has_equip(Caller,19);

		if (avail && (Target->GetType()==ACTOR_VEHICLE))
		{
			Vehicle v(Target);
			bool leck=((v.GetEnergy() < v.GetMaxEnergy()) && (v.GetUserData() != 4)) && v.HasCommand("gefahrgut");
			avail=leck;
		}
		return avail;
	}

	void PushActions(GameObject *Caller, Actor *Target, int childID)
	{
		Caller->PushActionExecuteCommand(ACTION_NEWLIST,"FwGeraet_raus",Target,109,false);
	}
};

object Get_Hebekissen : CommandScript
{

	Get_Hebekissen()
	{
		SetCursor("abdichten");
		SetIcon("abdichten");
		SetGroupID(CGROUP_GETEQUIPMENT);
		SetGroupLeader(false);
		SetValidTargets(ACTOR_VEHICLE);
	}

	bool CheckGroupVisibility(GameObject *Caller)
	{
		if (Caller->GetType() != ACTOR_PERSON)
			return false;
		Person p(Caller);
		bool zeig=(!Caller->IsEquipped() && fzlocal::has_equip(Caller,24));
		return zeig;
	}

	bool CheckPossible(GameObject *Caller)
	{
		return fzlocal::has_equip(Caller,24) && !Caller->IsEquipped() && Caller->GetUserData()==0;
	}

	bool CheckTarget(GameObject *Caller, Actor *Target, int childID)
	{

		if (!Caller->IsValid())
			return false;

		Person p(Caller);
		if (p.IsValid() && (p.IsCarryingPerson()||p.IsLinkedWithPerson()|| p.GetFirehoseID()!=0 || p.IsPulling() || p.GetEnteredCarID() != -1))
			return false;
		
		switch (p.GetPersonType())
		{
			case PT_FIREFIGHTER_NORMAL:
			case PT_FIREFIGHTER_MASK:
				break;
			default:
				return false;
		}
			
		bool avail=fzlocal::has_equip(Caller,24) && Target->GetType()==ACTOR_VEHICLE;
		if (avail)
		{
			Vehicle v(Target);
			avail=!v.HasEnclosedPerson();
		}
		return avail;
	}

	void PushActions(GameObject *Caller, Actor *Target, int childID)
	{
		Caller->PushActionExecuteCommand(ACTION_NEWLIST,"FwGeraet_raus",Target,116,false);
	}
};

object GetGZ : CommandScript
{
	GetGZ()
	{
		SetCursor("Geiger");
		SetIcon("Geiger");
		SetGroupID(CGROUP_GETEQUIPMENT);
		SetGroupLeader(false);
	}

	bool CheckGroupVisibility(GameObject *Caller)
	{
		if (Caller->GetType() != ACTOR_PERSON)
			return false;
		Person p(Caller);
		bool zeig=(!Caller->IsEquipped() && fzlocal::has_equip(Caller,16));
		return zeig;
	}

	bool CheckPossible(GameObject *Caller)
	{
		return fzlocal::has_equip(Caller,16);
	}

	bool CheckTarget(GameObject *Caller, Actor *Target, int childID)
	{

		if (!Caller->IsValid())
			return false;

		Person p(Caller);
		if (p.IsValid() && (p.IsCarryingPerson()||p.IsLinkedWithPerson()|| p.GetFirehoseID()!=0 || p.IsPulling() || p.GetEnteredCarID() != -1))
			return false;
		
		switch (p.GetPersonType())
		{
			case PT_FIREFIGHTER_NORMAL:
			case PT_FIREFIGHTER_MASK:
			case PT_FIREFIGHTER_ABC:
				break;
			default:
				return false;
		}
			
		if (fzlocal::has_equip(Caller,16))
			return true;
		else 	
			return false;
	}

	void PushActions(GameObject *Caller, Actor *Target, int childID)
	{
		Caller->PushActionExecuteCommand(ACTION_NEWLIST,"FwGeraet_raus",Target,106,false);
	}
};

object GetMM : CommandScript
{
	GetMM()
	{
		SetCursor("Gasmultimeter");
		SetIcon("Gasmultimeter");
		SetGroupID(CGROUP_GETEQUIPMENT);
		SetGroupLeader(false);
	}

	bool CheckGroupVisibility(GameObject *Caller)
	{
		if (Caller->GetType() != ACTOR_PERSON)
			return false;
		Person p(Caller);
		bool zeig=(!Caller->IsEquipped() && fzlocal::has_equip(Caller,17));
		return zeig;
	}

	bool CheckPossible(GameObject *Caller)
	{
		return fzlocal::has_equip(Caller,17);
	}

	bool CheckTarget(GameObject *Caller, Actor *Target, int childID)
	{

		if (!Caller->IsValid())
			return false;

		Person p(Caller);
		if (p.IsValid() && (p.IsCarryingPerson()||p.IsLinkedWithPerson()|| p.GetFirehoseID()!=0 || p.IsPulling() || p.GetEnteredCarID() != -1))
			return false;
		
		switch (p.GetPersonType())
		{
			case PT_FIREFIGHTER_NORMAL:
			case PT_FIREFIGHTER_MASK:
			case PT_FIREFIGHTER_ABC:
				break;
			default:
				return false;
		}
			
		if (fzlocal::has_equip(Caller,17))
			return true;
		else 	
			return false;
	}

	void PushActions(GameObject *Caller, Actor *Target, int childID)
	{
		Caller->PushActionExecuteCommand(ACTION_NEWLIST,"FwGeraet_raus",Target,107,false);
	}
};

object GetSonderRohr : CommandScript
{
	GetSonderRohr()
	{
		SetCursor("brohr");
		SetIcon("brohr");
		SetGroupID(CGROUP_GETEQUIPMENT);
		SetGroupLeader(false);
	}

	bool CheckGroupVisibility(GameObject *Caller)
	{
		if (Caller->GetType() != ACTOR_PERSON)
			return false;
		Person p(Caller);
		bool zeig=(!Caller->IsEquipped());
		return zeig;
	}

	bool CheckPossible(GameObject *Caller)
	{
		return true;
	}

	bool CheckTarget(GameObject *Caller, Actor *Target, int childID)
	{

		if (!Caller->IsValid() || (childID && childID<1000))
			return false;

		int sr=7;

		Person p(Caller);
		if (p.IsValid() && (p.IsCarryingPerson()||p.IsLinkedWithPerson()|| p.GetFirehoseID()!=0 || p.IsPulling() || p.GetEnteredCarID() != -1))
			return false;
		
		switch (p.GetPersonType())
		{
			case PT_FIREFIGHTER_NORMAL:
			case PT_FIREFIGHTER_MASK:
			case PT_FIREFIGHTER_ABC:
				break;
			default:
				return false;
		}
			
		bool avail=false;
		if (Target->GetType()==ACTOR_VEHICLE)
		{
			Vehicle v(Target);
			if (v.IsFirefighter())
				avail=fzlocal::has_equip(Target,sr);
			else 
				avail=false;
		} else
			if (Caller->GetID() == Target->GetID())
				avail=fzlocal::has_equip(Caller,sr);
	
		return avail;
	}

	void PushActions(GameObject *Caller, Actor *Target, int childID)
	{
		// System::Log("GetSonderRohr %u %s",childID,Caller->GetName());
		int srohr=7; // B-Rohr
		int sdata=111;
		if (childID>0 && childID<1000)
			srohr=childID;
		if (srohr==8)
			sdata=118;

		if (Target->GetType()!=ACTOR_VEHICLE)
		{
			VehicleList vl(Caller->GetName());
			Vehicle v(vl.GetVehicle(0));
		} else
			Vehicle v(Target);
	
		if (fzlocal::take_equip(&v,srohr))
			Caller->PushActionGetEquipment(ACTION_INSERT, &v, EQUIP_FIREHOSE);
		Caller->PushActionExecuteCommand(ACTION_INSERT,"rollo_go",&v,7,false);
		Caller->SetUserData(sdata);
	}
};

object SetTS : CommandScript
{
	SetTS()
	{
		SetCursor("tragks");
		SetIcon("tragks");
		SetGroupLeader(false);
		SetValidTargets(ACTOR_FLOOR | ACTOR_VIRTUAL);
	}

	bool CheckPossible(GameObject *Caller)
	{
		return fzlocal::has_equip(Caller,12);
	}

	bool CheckGroupVisibility(GameObject *Caller)
	{
		if (Caller->GetType() != ACTOR_PERSON)
			return false;
		Person p(Caller);
		bool zeig=(!Caller->IsEquipped() && fzlocal::has_equip(Caller,12));
		return zeig;
	}

	bool CheckTarget(GameObject *Caller, Actor *Target, int childID)
	{

		if (!Caller->IsValid())
			return false;

		Person p(Caller);
		if (p.IsValid() && (p.IsCarryingPerson()||p.IsLinkedWithPerson()|| p.GetFirehoseID()!=0 || p.IsPulling() || p.GetEnteredCarID() != -1))
			return false;
		
		switch (p.GetPersonType())
		{
			case PT_FIREFIGHTER_NORMAL:
			case PT_FIREFIGHTER_MASK:
				break;
			default:
				return false;
		}
			
		if (fzlocal::has_equip(Caller,12))
			return true;
		else 	
			return false;
	}

	void PushActions(GameObject *Caller, Actor *Target, int childID)
	{
		if (Target->GetType()==ACTOR_FLOOR || Target->GetType()==ACTOR_STREET)
		{
			GameObject t=bungarext::hierhin(Game::GetCommandPos());
			Target=&t;
		}
		Caller->PushActionExecuteCommand(ACTION_NEWLIST,"FwGeraet_raus",Caller,102,false);
	}
};

object taucher_ausruesten : CommandScript
{
	
	taucher_ausruesten()
	{
		SetIcon("ChangeToDiver");
		SetCursor("ChangeToDiver");
		SetRestrictions(RESTRICT_SELFEXECUTE);
	}

	bool CheckPossible(GameObject *Caller)
	{
		Vehicle v(Caller);
		return fzlocal::has_equip(Caller,2) && v.GetNumPassengers()>0;
	}

	bool CheckTarget(GameObject *Caller, Actor *Target, int ChildID)
	{
		return true;
	}

	void PushActions(GameObject *Caller, Actor *Target, int ChildID)
	{
		Vehicle boot(Caller);
		PersonList pl=boot.GetPassengers();
		Person p=pl.GetPerson(0);
		if (!p.HasCommand("Dive") && fzlocal::take_equip(Caller,2)) {
			boot.RemovePassenger(&p);
			boot.PushActionExecuteCommand(ACTION_NEWLIST,"CreateNewPerson",&boot,14,0);
			p.PushActionDeleteOwner(false);
		}
	}		
};

object rollo_go : CommandScript
{

	rollo_go()
	{
	}

	void PushActions(GameObject *Caller, Actor *Target, int x)
	{
		Vehicle fz(Target);
		int id=fzlocal::fzid(Target);
		System::Log("GO ROLLO Person %s Fz %s Nr %u Code %u",Caller->GetName(),fz.GetName(),id,x);
		Caller->PushActionTurnTo(ACTION_INSERT, Target);		
		if (fzrollo[id][0]==char(70)) {
			switch (x)
			{
				case 13:
				// case 10:
				case 23:
				case 24:
					break;
				case 18:
				case 12:
					Caller->PushActionMove(ACTION_INSERT, &fz, TARGET_REARDOOR);
					break;
				case 15:
					Caller->PushActionMove(ACTION_INSERT, fz.GetChildPosition("schnella"));
					break;	
				default:	
					Caller->PushActionMove(ACTION_INSERT, &fz, TARGET_EQUIPMENTDOOR);
					break;
			}
		} else {
			char *rollo="GX";
			rollo[1]=fzrollo[id][x];
			Caller->PushActionExecuteCommand(ACTION_INSERTAFTERFIRST,"grollo",&fz,int(fzrollo[id][x])-48,false);
			Caller->PushActionMove(ACTION_INSERT, fz.GetChildPosition(rollo));
			System::Log("GO ROLLO Fz %s %u",fz.GetName(),fzrollo[id][x]);
			System::Log("GO ROLLO Fz %s Rollo %s .. x war %u",fz.GetName(),rollo,x);
		}
	}
};



object geraet_entnehmen : CommandScript
{
	bool nur_entnahme=false;

	geraet_entnehmen()
	{
	}

	bool CheckTarget(GameObject *Caller, Actor *Target, int childID)
	{
		nur_entnahme=true;
		return true;
	}

	void PushActions(GameObject *Caller, Actor *Target, int childID)
	{
		GameObject obj(Target);
		Vehicle v(Caller);
		bool erg;

		switch (childID)
		{
			case 8:
				erg=fzlocal::take_equip(Caller,17);
				break;
			case 13:
			case 23:
				erg=true;
				break;
			case 2:
				if (fzlocal::has_equip(Caller,10))
					v.SetChildEnabled("pumpe",false);
			case 16:
				if (childID==16)
					childID=14;
			default:
				erg=fzlocal::take_equip(Caller,childID+10);
				break;
		}

		if (!erg)
		{
			System::Log("Geraet %u NICHT DA! Fz %s Unit %s",childID,Caller->GetName(),Target->GetName() );
			obj.SetUserData(0);
			obj.PushActionWait(ACTION_NEWLIST,0.1);
		} else {
			if (nur_entnahme)
				Target->SetUserData(childID+200);
			else
				Target->SetUserData(childID+100);
			System::Log("Geraet entnommen %u %u %s",childID, Target->GetUserData(),Target->GetName());
		}
		nur_entnahme=false;
	}
};

object geraet_einladen : CommandScript
{
	geraet_einladen()
	{
	}

	bool CheckTarget(GameObject *Caller, Actor *Target, int childID)
	{
	}

	void PushActions(GameObject *Caller, Actor *Target, int childID)
	{
		bool erg=true;
		Vehicle v(Target);
		if (childID==16)
			childID=14;
		if (childID==8)
			erg=fzlocal::put_equip(Target,17);
		else
			erg=fzlocal::put_equip(Target,childID+10);
		if (childID==2)
			v.SetChildEnabled("pumpe",true);
		Person p(Caller);
		p.RemoveObjectInRightHand();
	}
};

/// Patrouillenfunktion

int go_pat=-1;

object Fahre_Patrouille : CommandScript
{

	bool manu=false;

	Fahre_Patrouille()
	{
		SetIcon("auf_streife");
		SetCursor("auf_streife");
		SetRestrictions (RESTRICT_SELFEXECUTE);
	}

	bool CheckPossible(GameObject *Caller)
	{
		Vehicle v(Caller);
		return Input::LCtrlPressed() && v.GetNumPassengers()>0 && !Caller->HasCommand("fs") && !fzlocal::nachbar(Caller,3);
	}

	bool CheckTarget(GameObject *Caller, Actor *Target, int ChildID)
	{
		manu=Caller->GetID()==Target->GetID();
		return manu;
	}
	
	void PushActions(GameObject *Caller, Actor *Target, int ChildID)
	{
		// System::Log("Fz auf Streife schicken %s",Target->GetName());
		//if (MissionMode)
		//	return;	// Keine Streife wenn nicht freeplay.map
		Vehicle stw(Target);
		bool ontheroad=(fzstatus[fzlocal::fzid(&stw)]&14)>0;
		
		if (!fzlocal::IsTyp(&stw,FZ_POL|FZ_STREIFE) || (ontheroad && !manu) || stw.IsSmoking() || stw.IsDestroyed() || fzlocal::IsTyp(&stw,FZ_POL|FZ_SEK))
		 	return;

		Vector Pos;
		ActorList al;
		Actor a;

		float warten=ChildID*1.0;

		int fzid=fzlocal::fzid(&stw);
		int ptype=101;
		if (fzlocal::IsTyp(&stw,FZ_POL|FZ_KRIPO))
		{
			ptype=103;
		}

		fzid=fzid%6;
		
		stw.PushActionWait(ACTION_NEWLIST,warten);
		if (!ontheroad)
		{
			stw.PushActionExecuteCommand(ACTION_APPEND,"mannschaft_rufen",&stw,ptype,false);
			stw.PushActionExecuteCommand(ACTION_APPEND,"fzfrei",&stw,1,false);
			if (stw.IsHidden())
				stw.PushActionExecuteCommand(ACTION_APPEND,"nachbar_holen",&stw,0,false);
		} else {
			stw.PushActionExecuteCommand(ACTION_APPEND,"fzfrei",&stw,0,false);
			stw.PushActionExecuteCommand(ACTION_APPEND,"WT_SoSi",&stw,1,false);
		}

		stw.EnableHeadLights(true);

		stw.PushActionExecuteCommand(ACTION_APPEND,"normale_fahrt",&stw,0,false);

		bool ende=false;
		int pfad;
		int dot;
		Vector Pos;
		if (go_pat<0)
			go_pat=MAXPAT-1;
		else {
			for (int q=0;q<4;q++)
			{
				pfad=int(skennung[go_pat][q]);
				if (pfad>32)
				{
					pfad=pfad-64;
					ende=pfad>32;
					if (ende)
						pfad=pfad-32;
		
					char * bhf="             ";
					char * zugname="traffic_car0%u";
					int j=snprintf(bhf,13,zugname,pfad);
					PathList pl(bhf);
					if (pl.GetNumPaths()>0)
					{
						Path path(pl.GetPath(0));
						if (ende)
							Pos=path.GetPoint(path.GetNumPoints()-1);
						else
							Pos=path.GetPoint(0);
						stw.PushActionMove(ACTION_APPEND,Pos,false);
					}
				}
			}
		}
		stw.PushActionExecuteCommand(ACTION_APPEND,"gohome_winterberg",&stw,0,false);
		manu=false;
		go_pat--;
	}
};

object Patrouille_frei : CommandScript
{
	Patrouille_frei()
	{
	}

	bool CheckTarget(GameObject *Caller, Actor *Target, int ChildID)
	{
		return true;
	}
	
	void PushActions(GameObject *Caller, Actor *Target, int ChildID)
	{
		Vehicle stw(Target);
		stw.PushActionExecuteCommand(ACTION_APPEND,"Fahre_Patrouille",&stw,ChildID,false);
	}
};

///
/// Nachbarfz vor Werkstattfahrt sichtbar machen
///

object drehen : CommandScript
{
	drehen()
	{
	}

	void PushActions(GameObject *Caller, Actor *Target, int childID)
	{
		GameObject tg(Target);
		if (childID>0)
		{
			tg.SetRotation(Caller);
			Caller->PushActionRotateTarget(ACTION_INSERT,Target,0,childID*1.0,0,0.5);
		} else if (childID<0) {
			tg.PushActionRotateTarget(ACTION_INSERT,Caller,0,childID*-1.0,0,0.5);
		} else
			Caller->SetRotation(&tg);
	}
};


bool deluxe=false;

object setver : CommandScript
{
	setver()
	{
		SetGroupID(20);
	}

	void PushActions(GameObject *Caller, Actor *Target, int ChildID)
	{
		deluxe=(Caller->GetUserData() == 11);
		sirs=Game::GetGameObjectsWithPrefix("sir8");	
		if (sirs.GetNumObjects()==0)
			sirs=Game::GetGameObjectsWithPrefix("Sir8");
	}
};

bool isdeluxe()
{
	return deluxe;
}

object waehle_Klinik : CommandScript
{
	waehle_Klinik()
	{
		SetPriority(2000);
	}

	void PushActions(GameObject *Caller, Actor *Target, int ChildID)
	{
		int platz=Math::rand()%12+1;

		// System::Log("Klinik ausgewaehlt Platz %u CID %u %s",platz,ChildID,ppos[platz].GetName());
	
		switch (ChildID)
		{
			case 0:	// Waehle ZielKlinik fuer externe KH-Anfahrt
				Caller->SetPosition(ppos[platz].GetPosition());
				Caller->SetUserData(Math::rand()%80+80+platz*10000);
				break;
			case 1: //definiere Ziel für FluchtFz
				Caller->SetUserData(ppos[platz].GetID());
				break;
		}
	}
};

object verzoegern : CommandScript
{
	verzoegern()
	{
	}

	void PushActions(GameObject *Caller, Actor *Target, int ChildID)
	{
		Vehicle v(Caller);
		int p=Target->GetUserData()/10000;
		int dist=Target->GetUserData()-p*10000;
		float warte=verzfakt*10/v.GetSpeed() * dist/20;
		// System::Log("Extern verzoegern %s %s %u %u",Caller->GetName(),Target->GetName(),int(warte),Target->GetUserData());
		if (ChildID==0)
		{
			Caller->PushActionExecuteCommand(ACTION_INSERT,"nachbar_holen",Target,1,false);
		}
		Caller->PushActionWait(ACTION_INSERT,warte);
		Caller->SetFlag(FLAG_P_NEU);
	}
};

object materialtausch : CommandScript
{

	materialtausch()
	{
	}


	void PushActions(GameObject *Caller, Actor *Target, int childID)
	{
		Mission::PlayHint("Material wird getauscht");
		Vehicle v(Caller);
		PersonList pl=v.GetPassengers();
		Person p=pl.GetPerson(1);
		p.PushActionLeaveCar(ACTION_NEWLIST,Caller);
		p.PushActionMove(ACTION_APPEND,Caller,TARGET_EQUIPMENTDOOR);
		p.PushActionGetEquipment(ACTION_APPEND,Caller,EQUIP_FIREHOSE);
		ActorList al("halle2");
		p.PushActionMove(ACTION_APPEND,al.GetActor(0),TARGET_ANY);
		p.PushActionShowHide(ACTION_APPEND,true);
		p.PushActionWait(ACTION_APPEND,5.0);
		p.PushActionShowHide(ACTION_APPEND,false);
		fzlocal::lager_fuellen();
		p.PushActionExecuteCommand(ACTION_APPEND,"aufsitzen",Caller,0,false);
	}
};


object tank_fuellen: CommandScript
{

	tank_fuellen()
	{
	}

	void PushActions(GameObject *Caller, Actor *Target, int childID)
	{
		if (Caller->GetType()==ACTOR_VEHICLE)
		{
			char *id="          ";
			if (Caller->HasChild("pumpe"))
			{
				snprintf(id,10,"PU%u",Caller->GetID());
				PersonList pl(id);
				Person p=pl.GetPerson(0);
				p.ClearActions();
				if (fzlocal::tankinhalt(Target)>0)
				{
					snprintf(id,10,"TA%u",Caller->GetID());
					PersonList pl(id);
					// System::Log("Tank fuellen %s %u %ul",Caller->GetName(),pl.GetNumPersons());
					Person p=pl.GetPerson(0);
				} else
					return;
			} else
				return;

		} else
			Person p(Caller);
		p.SetMaxHealth(fzlocal::tankinhalt(Target));
		p.SetHealth(fzlocal::tankinhalt(Target));
		p.SetClassified(true);
		snprintf(id,10,"PU%u",Caller->GetID());
		PersonList pl(id);
		Person p=pl.GetPerson(0);
		p.ClearActions();
	}
};


// Use-Script greift auch auf FzFlags zu, deswegen hier integriert ab sofort
//













object Use : CommandScript
{
	Use()
	{
		SetValidTargets(ACTOR_OBJECT | ACTOR_HOUSE | ACTOR_OPEN_HOUSE | ACTOR_VEHICLE);
		SetRestrictions(RESTRICT_USABLE);
		SetPriority(700);
		SetSelfClickActivation(true);
	}

	bool CheckPossible(GameObject *Caller)
	{
		if (!Caller->IsValid() || Caller->GetType() != ACTOR_PERSON)
			return false;
		return Game::ExistsObjectWithFlagSet(OF_USABLE);
	}
	
	bool CheckTarget(GameObject *Caller, Actor *Target, int ChildID)
	{
		bool doit;

		if (!Caller->IsValid() || !Target->IsValid() || Caller->GetID()==Target->GetID())
			return false;
		
		GameObject obj(Target);
		if (!obj.IsValid()) 
			return false;

		int code=fzstatus[fzlocal::fzid(Caller)]&usetecmask;

		switch (code)
		{
			case FZ_TEC|FZ_ELEKTRO:
				doit=(StrCompare(obj.GetPrototypeFileName(), "mod:Prototypes/Objects/Road Signs/trafficlight01.e4p") == 0);
				doit=doit||(StrCompare(obj.GetPrototypeFileName(), "mod:Prototypes/Objects/Road Signs/trafficlight02.e4p") == 0);
				doit=doit || obj.HasCommand("siemens_target");
				break;
			case FZ_TEC|FZ_BAHN:
				doit=(StrCompare(obj.GetPrototypeFileName(), "mod:Prototypes/Objects/Railway/levelcrossing01.e4p") == 0);
				break;
			case FZ_TEC|FZ_SWT:
				doit=obj.HasCommand("wawe_target");
				break;
			case FZ_POL|FZ_KMRD :
				doit=(StrCompare(obj.GetPrototypeFileName(), "mod:Prototypes/Objects/Misc/bomb.e4p") == 0);
				doit=doit || obj.HasCommand("kmrd_target");
				break;
			default:
				doit=!Game::IsFreeplay() && !Game::IsMultiplayer();
		}
		return doit;
	}
	
	void PushActions(GameObject *Caller, Actor *Target, int ChildID)
	{
		GameObject obj(Target);
		Caller->PushActionMove(ACTION_NEWLIST, Target, TARGET_USE);
		Caller->PushActionTurnTo(ACTION_APPEND, Target);
		if (obj.HasCommand("kmrd_target"))
			if (Target->GetType()==ACTOR_VEHICLE)
				Caller->PushActionRepair(ACTION_APPEND, Target);
			else
				Caller->PushActionUse(ACTION_APPEND, Target);
		else
			Caller->PushActionUse(ACTION_APPEND, Target);
		obj.PushActionExecuteCommand(ACTION_APPEND,"ggv_check",Caller,4,false);
		VehicleList vl(Caller->GetName());
		Person p(Caller);
		if (p.GetPersonType()==PT_ENGINEER && !obj.HasCommand("kmrd_target") )
			Caller->PushActionExecuteCommand(ACTION_APPEND,"gohome_wenn_fertig",vl.GetVehicle(0),0,false);
	}
};

// Repair-Script greift auf FZFlags zu -> hier integriert








object Repair : CommandScript
{
	Repair()
	{
		SetValidTargets(ACTOR_VEHICLE);
		SetPossibleCallers(ACTOR_PERSON);
		// SetPossibleExists(CPE_REPAIRABLE_CAR);
		SetPriority(600);
		SetSelfClickActivation(true);
	}
	
	bool CheckTarget(GameObject *Caller, Actor *Target, int childID)
	{
		if(!Caller->IsValid() || !Target->IsValid() || Target->GetID() == Caller->GetID())
			return false;

		GameObject obj(Target);
		Person p(Caller);

		if (!obj.IsValid()) 
			return false;
		
		if (fzlocal::IsTyp(Caller,FZ_POL|FZ_KMRD))
			return obj.HasCommand("kmrd_target") || (StrCompare(obj.GetPrototypeFileName(), "mod:Prototypes/Objects/Misc/bomb.e4p") == 0);
		else
			if(Target->GetType() == ACTOR_VEHICLE)
			{
				Vehicle vehicle(Target);
				if (!vehicle.IsValid() || ((vehicle.GetVehicleType() == VT_POLICE_PHC || vehicle.GetVehicleType() == VT_AMBULANCE_RHC || vehicle.GetVehicleType() == VT_THW_FGRT_BH) && !vehicle.IsOnGround()))
					return false;
				if (!vehicle.IsCivilCar() && vehicle.GetEnergy() > 0.1f * vehicle.GetMaxEnergy() && vehicle.GetEnergy() < vehicle.GetMaxEnergy())
					return true;
			}
		
		return false;
	}

	void PushActions(GameObject *Caller, Actor *Target, int childID)
	{
		Caller->PushActionMove(ACTION_NEWLIST, Target, TARGET_ANY);
		Caller->PushActionTurnTo(ACTION_APPEND, Target);
		Caller->PushActionRepair(ACTION_APPEND, Target);
		GameObject obj(Target);
		obj.PushActionExecuteCommand(ACTION_APPEND,"ggv_check",Caller,4,false);
	}	
};

// Mannschaft rufen, zur Beschleunigung und Entzerrung hier mit integriert

object mannschaft_rufen : CommandScript
{
	
	bool ignore_pull=false;

	mannschaft_rufen()
	{
		SetPriority(500);
	}

	bool CheckTarget(GameObject *Caller, Actor *Target, int ChildID)
	{
		ignore_pull=true;
		return true;
	}

	void rufe_pers(Vehicle fz, Actor *Target, int pc, int n)
	{
		ActorList place;
		int alarm=100;

		if (n>999)
		{
			n-=1000;
			alarm=300;
		}

		if (n==0)
			System::Log("Rufe NULL Personen für %s Typ %u",fz.GetName(),pc);
					
		for (int i=0; i<n; i++)
		{
			fz.PushActionExecuteCommand(ACTION_INSERT,"CreateNewPerson",Target,alarm+pc,false);			
			fz.PushActionWait(ACTION_INSERT,0.5f);
		}
	}

	void PushActions(GameObject *Caller, Actor *Target, int ChildID)
	{

		if (Caller->GetType()==ACTOR_VEHICLE)
			Vehicle fz(Caller);
		else
			Vehicle fz(Target);

		// System::Log("Mannschaft rufen für %s Code %u Auf Funk %u Ignore_Pull %u",fz.GetName(),ChildID,int(fz.IsFlagSet(FLAG_FUNK)),int(ignore_pull));

		bool rufen=!fz.IsFlagSet(FLAG_FUNK) || ignore_pull;

		// if (fz.HasCommand("wird_alarmiert"))
		// {
		//	Caller->PushActionWait(ACTION_INSERT,1.0);
		//	Caller->PushActionExecuteCommand(ACTION_INSERTAFTERFIRST,"mannschaft_rufen",Target,ChildID,ignore_pull);
		// } else 
		
		if (rufen)  // hidden setzt nicht FLAG_FUNK ausser Kraft !, mal sehen
		{
			ActorList place;
			int n,free;
			int ptype=0;
			bool freiwillige=false;
			bool fuehrung=fzlocal::IsTyp(&fz,FZ_FUEHRUNG) || (fz.IsFlagSet(FLAG_NA) && fz.IsPolice());
								
			fz.AssignCommand("ich_bin_nicht_frei");
			fz.PushActionWait(ACTION_INSERT,1000.0);
					
			free=fz.GetFreePassengers();
			n=free;
			
			// System::Log("Mannschaft rufen %u %s Fuehrung : %u",ChildID,fz.GetName(),int(fuehrung));

			// Zuordnung des Personals zu den Codes
			// Codes in Anlehnung an die Alarmcodes aus RufeWinterberg

			switch (ChildID)
			{	
				case 0:
					break;
				// Feuerwehr
				case 501:	// freiwillige
					ptype=50;
					freiwillige=true;
					n=n+n/2;
					break;
				case 502:
					ptype=51;
					n=2;
					break;
				case 307:
					ptype=2;
					n=4;
					break;
				case 301:
					rufe_pers(fz,Target,91,1);
					ptype=90;
					n=1;
					break;

				// Rettungsdienst
				case 603:
					ptype=9;
					n=1;
					if (free>0)
						rufe_pers(fz,Caller,12,1);			
					break;
				case 619:
					rufe_pers(fz,Caller,97,1);			
				case 610:
					if (fz.IsFlagSet(FLAG_NA) && free>0)
						rufe_pers(fz,Caller,81,1);			
				case 611:
					ptype=91;
					if (fz.GetVehicleType()!=VT_AMBULANCE_NEF)
						n=2;
					else	
						n=1;
					break;
				case 622:
					rufe_pers(fz,Caller,52,1);
					rufe_pers(fz,Caller,8,1);
					ptype=9;
					n=1;
					break;			
				case 621:
					rufe_pers(fz,Caller,8,1);
					ptype=35;
					n=1;
					break;			
				case 630:
					rufe_pers(fz,Caller,21,n);
					ptype=32;
					n=fz.GetFreeTransports();
					break;			
				case 650:
				case 652:
					ptype=18;
					if (fz.GetVehicleType()==VT_AMBULANCE_RTW)
					{
						n=n-1;
						ptype=34;
					}
					break;
				case 651:
					ptype=19;
					break;
				case 84060:
					rufe_pers(fz,Target,88,1);
					rufe_pers(fz,Target,85,1);
					rufe_pers(fz,Target,84,2);
					ptype=0;
					n=0;
					break;			
				case 84064:
					rufe_pers(fz,Target,89,1);
					rufe_pers(fz,Target,86,1);
					rufe_pers(fz,Target,87,1);
					ptype=0;
					n=0;
					break;			

				// Polizei
				case 101:
				case 102:
					PersonList pl(fz.GetName());
					switch (fz.GetVehicleType())
					{
						case VT_POLICE_MTW:
							if (fz.IsFlagSet(FLAG_NA))
								ptype=3;
							else
								ptype=4;
							break;
						case VT_POLICE_WAW:
							ptype=4;
							break;
						case VT_POLICE_STW:
							if (ChildID==101)
								n=2;
							ptype=3;
							break;
						case VT_POLICE_PHC:
							ptype=4;
							break;
						default:
							ptype=3;
							break;
					}
					n=n-pl.GetNumPersons();
					break;
				case 103:
					PersonList pl(fz.GetName());
					n=2;
					n=n-pl.GetNumPersons();
					ptype=33;
					break;

				// TEC

				// alte Codes;
				case 19297:
					ptype=12;
					n=1001;
					break;
				case 19223:
					ptype=34;
					n=1;
					break;
				case 19296:
					ptype=8;
					n=1001;
					fz.SetFlag(FLAG_NA);
					break;
				case 19292:
					ptype=81;
					n=1;
					fz.SetFlag(FLAG_NA);
					break;
				case 19293:
					ptype=12;
					n=1;
					break;
				default:
					if (ChildID>59900)
					{
						ptype=ChildID-59900;
						n=1; fuehrung=false;
						if (ptype==61)
							rufe_pers(fz,Target,77,1);
					} else {
						ptype=ChildID;
						if (ptype>99) {
							n=ptype/100;
							ptype=ptype%100;
						}
					}
					break;
			}
			if (fuehrung) {
				n--;
				rufe_pers(fz,Caller,1,1);
				// System::Log("TL rufen");
			}
			if (n>0)
			{
				rufe_pers(fz,Caller,ptype,n);
			}
			fz.SetFlag(FLAG_P_NEU);			
			if (fz.HasCommand("abwarten"))
				fz.PushActionWait(ACTION_INSERT,fz.GetUserData());
		} 
		ignore_pull=false;
	}
};


// FZA


//
// Class FZLOCAL -> stellt Funktionen zum Zugriff auf fzspezifische Datenbank bereit
//

char fzeinsatz[MAX_FZ][25];
char fzrollo[MAX_FZ][25];
int fzidx[MAX_FZ];
const char *bmask="%s0000000000000000000000000";
const char *bel="                                                                                   ";
const char *basebel="                                                                                   ";
int lager[25];

class fzlocal:CommandScript
{
	public:


const char *xmlval (char *var,int i,int l)
{
	char *buf="         ";
	const char *xmldata="123456789 123456789 123456789 123456789 123456789 123456789 123456789 12345";
	snprintf(buf,9,"%s%u",var,1000+i);
	if (!Game::GetGameString(buf,xmldata,l))
		xmldata="ende";
	return xmldata;	
}

const char *kennung(int i)
{
	return xmlval("FZKEN",i,7);
}

const char *alarm(int i,bool dusa)
{
	char *altext="          ";
	char *buf="                                                                                                   ";
	if (dusa)
		snprintf(altext,10,"WBDUSA%u",i);
	else
		snprintf(altext,10,"WBFAE%u",i);
	Game::GetGameString(altext,buf,80);
	return buf;
}

const char *Signal(int i, bool s, bool l)
{
	int so=16+i;
	bool cw=i==-4;
	if (cw)
		so=36;
	else if (s&&l)
		so=so&15;
	else if (l && (i<4 || i >10))
		so=so & 15 |32;
	// System::Log("SoSi waehlen %u %s",so,fzsosi[so]);
	return fzsosi[so];
}

void fza_look(GameObject *Caller,int i, bool sel)
{
	Actor a=Game::GetActor(fzactor[i]);
	bool driveit=Input::LShiftPressed();
	GameObject o(&a);
	o.Select();
	Caller->Deselect();
	if (driveit)
		Caller->PushActionExecuteCommand(ACTION_INSERT,"driving_through_winterberg",&a,0,true);
	else if (sel)
	{
		Vector to=o.GetPosition();
		Vector from=to; from.x=to.x-800;from.z=1200;from.y=to.y;
		Camera::Set(from);
		Camera::LookAt(from,to);
	}
}

const char *stellplatz(int i)
{
	return pkennung[i];
}

int richtung(int i)
{
	int x=int(fzcode[i][3])-48;
	return x;
}

bool inplace(Actor *Caller)
{
	const char * fz;
	fz=Caller->GetName();
	bool ok=fz[14]=="i";
	return ok;
}

bool nachbar(Actor *Caller,int test)
{
	const char * fz;
	fz=Caller->GetName();
	bool ok=(int(fz[15]) & test)>0;
	return ok;
}

bool isffw (Actor *Caller)
{
	const char * fz;
	fz=Caller->GetName();
	bool ok=(int(fz[15]) & 4)==4;
	return ok;
}


bool isModder (Actor *Caller)
{
	const char * fz;
	fz=Caller->GetName();
	bool ok=int(fz[14])==77;
	return ok;
}

bool ff_check (int wache)
{
	char *fw="        ";
	snprintf(fw,8,"Spind%u",100+wache);
	char *pfad="       ";
	snprintf(pfad,7,"FFW%u",100+wache);
	char *gh="     ";
	snprintf(gh,5,"fw%u",100+wache);
	char *sir="       ";
	snprintf(sir,7,"Sir8%u",100+wache);

	GameObjectList ol(fw);
	OpenHouseList oh(gh);
	PathList pl(pfad);
	GameObjectList sl(sir);
	
	// System::Log("FF Check Wache %u : Spind %u Haus %u Pfad %u Sirene %u",wache,ol.GetNumObjects(), oh.GetNumOpenHouses(), pl.GetNumPaths(),sl.GetNumObjects());

	bool ok=ol.GetNumObjects()>0 && oh.GetNumOpenHouses()>0 && pl.GetNumPaths()>0 && sl.GetNumObjects()>0;
	return ok;
}

int fzid(Actor *Caller)
{
	const char * fz;
	fz=Caller->GetName();
	int id=int(fz[11])-32;
	if (id<0)
	{
		id+=256;
	}
	return id;
}

int fzprio(int i)
{
	return fzpriori[i];
}

int fzort(Actor *Caller)
{
	const char * fz;
	fz=Caller->GetName();
	int id=int(fz[7])-32;
	return id;
}

int fzsosi(Actor *Caller)
{
	const char * fz;
	fz=Caller->GetName();
	int id=int(fz[16]);
	return id;
}

void wache_anlegen(Vehicle *vec)
{
	char *name="1234";
	snprintf(name,4,"%s",vec->GetName());
	ActorList landing(name);
	// System::Log("Legeplatz suchen %s %u",name,landing.GetNumActors());
	if (landing.GetNumActors()>0) {
		for (int x=0;landing.GetActor(x)->GetType()!=ACTOR_WAITINGPOINT && x<landing.GetNumActors();x++);			
		if (x<landing.GetNumActors())
			vec->PushActionExecuteCommand(ACTION_APPEND,"ShipAnchor",landing.GetActor(x),1,false);
	}
}

float verz(GameObject *Caller)
{
	int i=fzort(Caller);
	Vehicle v(Caller);
	float warte;

	if (i<51)
		warte=0;
	else 
		warte=(verzfakt * 10/v.GetSpeed()) * verz[i-50];
	return warte;
}

void status_setzen (Vehicle *v, int code)
{
	int i=fzid(v);
	fzstatus[i]=(fzstatus[i]&FZ_NOSTAT_MASK)|code;
	// System::Log("Fz Status aktualisieren %u %s",fzstatus[i]&15,v->GetName());
}

void fz_beladen(Actor *fz,bool wib,bool wache)
{
	// System::Log ("Fz beladen %s , fixe Ladung %s",fz->GetName(),fzladfix);
	int i=fzid(fz);
	int id=i;
	int x=snprintf(basebel,25,bmask,fzbasisequip);
	char *bel="0000000000000000000000000";
	char *rol="0000000000000000000000000";
	rol=xmlval("FZROL",i,25);
	bel=xmlval("FZLAD",i,25);
	wib=wib && wache && !MissionMode;
	bool druffmit=false;
	// System::Log ("Fz Ladeverteilung %s : %s ! Winerberg Wache %u",fz->GetName(),rol, int (wib));
	for (int x=0;x<25;x++)
	{
		fzrollo[i][x]=rol[x];
		druffmit=wache || int(fzladfix[x])>48;
		if (druffmit)
		{
			if (wib)
				wib_lager (int(fzeinsatz[id][x])-48,int(bel[x])-48,x);	
			if (bel[x]=="0")
				fzeinsatz[id][x]=basebel[x];
			else
				fzeinsatz[id][x]=bel[x];
		}
	}

	if (wib)
		wib_lager_check(fz);
}


void wib_lager (int rest, int soll, int dev)
{
	// System::Log("Wib Lager entnehmen %u %u %u %u",dev,lager[dev],rest,soll);
	lager[dev]=lager[dev]+rest-soll;
}

void wib_lager_check (Actor *fz)
{
	// System::Log("Wib Lager checken");
	for (int x=0;x<25;x++)
		if (lager[x]<1)
		{
			GameObject o(fz);
			// System::Log("Wib Lager muss aufgefuellt werden %u -%u",x,-lager[x]);
			o.PushActionExecuteCommand(ACTION_INSERT,"rufe_ssw",fz,0,false);
			x=25;
		}
}

void lager_fuellen()
{
	for (int x=0;x<25;x++)
		lager[x]=1000;
	lager[0]=25;
	lager[3]=12;
	lager[21]=8;
}

bool has_equip(Actor *fz, int x)
{
	int id=fzid(fz);
	if (id >= MAX_FZ)
		return false;
	if (id<1)
	{
		return false;
	}
	if ((int(fzeinsatz[id][x])-48) > 0)
		return true;
	else
		return false;
}

bool take_equip(Actor *fz, int x)
{
	int idt=fzid(fz);
	if ((int(fzeinsatz[idt][x])-48) > 0)
	{
		int anz=int (fzeinsatz[idt][x])-49;
		fzeinsatz[idt][x]=char(anz+48);
		return true;
	} else 
		return false;		
}

bool put_equip(Actor *fz, int x)
{
	int id=fzid(fz);
	int anz=int (fzeinsatz[id][x])-47;
	fzeinsatz[id][x]=char(anz+48);
	return true;
}

bool IsTyp(Actor *Caller, int maske)
{
	int i=fzid(Caller);
	return ((fzstatus[i]&maske)==maske);
}

void FzDrehen (GameObject *Caller, GameObject *vorlage)
{
	float rot[9];
	float childRot[9];
	vorlage->GetRotation(rot[0], rot[1], rot[2], rot[3], rot[4], rot[5], rot[6], rot[7], rot[8]);
	Math::EulerToMatrix(180.0f, 0.f, 0.f, childRot);
	Math::MultiplyMatrices(childRot, rot);
	Caller->SetRotation(childRot[0], childRot[1], childRot[2], childRot[3], childRot[4], childRot[5], childRot[6], childRot[7], childRot[8]);
}

float tankinhalt (Actor *Caller)
{
	Vehicle v(Caller);
	float inhalt;
	if (v.IsFirefighter() && v.HasChild("pumpe"))
	{
		int id=fzid(Caller);
		inhalt=int(fzeinsatz[id][4])-64;
		if (inhalt<0)
			inhalt+=256;
		inhalt=inhalt*100.0;
	} else 
		inhalt=0;
	return inhalt;
}

int bma_id (Actor *bma)
{
	int id=atoi(bma->GetName());
	if (id==0)
		id=bma->GetUserData();
	// System::Log("BMA %s hat ID %u",bma->GetName(),id);
	return id;
}

GameObject finde_wache (GameObject* Fzg)
{
	// System::Log("Finde Wache fuer PV Wache %s Code %u",Fzg->GetName(),Fzg->GetUserData());
	GameObjectList ol(Fzg->GetName());
	for (int i=ol.GetNumObjects();i>0;i--)
		if (ol.GetObject(i-1)->GetType()==ACTOR_OBJECT) {
			GameObject r=ol.GetObject(i-1);
			i=0;
		}
	// System::Log("PV Wache gefunden %s code %u",r.GetName(),r.GetID());
	return r;
}

/// Distanzbestimmung

float Distanz(Vehicle pv, Actor *Target)
{
	GameObject obj(Target);
	float d1=pv.DistanceXY(&obj);
	if (d1<0)
		d1=d1*-1.0;
	return d1;
}

float fzspeed(Actor *fz)
{
	const char * fzcode[1];
	fzcode[0]=fz->GetName();
	int speed=int(fzcode[0][13])-64;
	if (speed>26)
	{
		speed=speed-32;
	}
	float fzspeed=speed*speedfac;
	return fzspeed;
}

void selbstschutz(GameObject *o,bool an)
{
	char *buf ="           ";
	char *mask="selbstsc%u";
	for (int i=1;i<25;i++)
	{
		snprintf(buf,11,mask,100+i);
		buf[8]=char(104);
		o->SetChildEnabled(buf,an);
	}
}

};

class bungarext : CommandScript
{

	GameObject hierhin (Vector cp)
	{
		GameObject obj=Game::CreateObject("mod:Prototypes/Objects/Equipment/marker.e4p","bungar");
		obj.SetPosition(cp);
		obj.AssignCommand("alarmdummy");
		obj.PushActionDisappear(ACTION_NEWLIST,25.0,150.0,true);
		return obj;
	}
	
	void debung (Actor *bung)
	{
		if (bung->HasNamePrefix("bungar"))
		{
			GameObject db(bung);
			db.PushActionDeleteOwner(ACTION_NEWLIST);
		}
	}

	int actor_init (char * name)
	{
		int erg;
		// System::Log("Actor Init %s",name);
		ActorList al(name);
		if (al.GetNumActors()>0)
			erg=al.GetActor(0)->GetID();
		else 
			erg=-1;
		// System::Log("Actor Init %s : %u",name,erg);
		return erg;
	}

	Actor actor_get (char * name)
	{
		Actor erg;
		// System::Log("Actor Get %s",name);
		ActorList al(name);
		if (al.GetNumActors()>0)
			erg=al.GetActor(0);
		return erg;
	}

	GameObject obj_get (char * name)
	{
		GameObject erg;
		// System::Log("Actor Get %s",name);
		GameObjectList al(name);
		if (al.GetNumObjects()>0)
			erg=al.GetObject(0);
		return erg;
	}

};

//
// Localizer : ab hier lokale Infos -> Abschnitt kann bei Anpassungen komplett ausgetauscht werden
//

		char * fzbasisequip[]="000000000000000000001000";

		const int MAX_PLATZ=50;
		const char * pkennung[MAX_PLATZ];

		GameObject ppos[50];
		GameObject fallback;
		GameObject autohaus;

		const char * skennung[10];


float verzfakt=30.0;
const int maxverz=50;
float verz[maxverz];
		
		const char * fzsosi [48];
		// Pressluft
		fzsosi[1]="mod:Audio/FX/Sirens/martin4.wav";
		fzsosi[2]="mod:Audio/FX/Sirens/lf16.wav";
		fzsosi[3]="mod:Audio/FX/Sirens/tlf818.wav";
		fzsosi[4]="mod:Audio/FX/Sirens/rw.wav";
		fzsosi[5]="mod:Audio/FX/Sirens/dlk_horn_orig.wav";
		fzsosi[6]="mod:Audio/FX/Sirens/gtlf.wav";
		fzsosi[7]="mod:Audio/FX/Sirens/lfz.wav";
		fzsosi[8]="mod:Audio/FX/Sirens/rtwbb.wav";
		fzsosi[9]="mod:Audio/FX/Sirens/dlk.wav";
		fzsosi[10]="mod:Audio/FX/Sirens/dekon.wav";
		fzsosi[11]="mod:Audio/FX/Sirens/martin4.wav";
		fzsosi[12]="mod:Audio/FX/Sirens/presslsim.wav";
		fzsosi[13]="mod:Audio/FX/Sirens/EMsiren05.wav";
		// erst die E-Hörner, Stadtsignal
		fzsosi[17]="mod:Audio/FX/Sirens/rtk_stadt.wav";
		fzsosi[18]="mod:Audio/FX/Sirens/tlf_stadt.wav";
		fzsosi[19]="mod:Audio/FX/Sirens/topas2_ehorn.wav";
		fzsosi[20]="mod:Audio/FX/Sirens/stw.wav";
		fzsosi[21]="mod:Audio/FX/Sirens/ehorn.wav";
		fzsosi[22]="mod:Audio/FX/Sirens/bosch.wav";
		fzsosi[23]="mod:Audio/FX/Sirens/elw.wav";
		fzsosi[24]="mod:Audio/FX/Sirens/itw.wav";
		fzsosi[27]="mod:Audio/FX/Sirens/tlf_stadt.wav";
		fzsosi[28]="mod:Audio/FX/Sirens/s620.wav";
		// EHorn Landschaltung
		fzsosi[33]="mod:Audio/FX/Sirens/rtk_land.wav";
		fzsosi[34]="mod:Audio/FX/Sirens/tlf_land.wav";
		fzsosi[35]="mod:Audio/FX/Sirens/topas1_ehorn.wav";
		fzsosi[36]="mod:Audio/FX/Voices/civil_warn.wav"; // Kein Sosi, hier ist die Warndurchsage versteckt ;)
		fzsosi[43]="mod:Audio/FX/Sirens/tlf_land.wav";
		fzsosi[44]="mod:Audio/FX/Sirens/l620.wav";


const char * metronam="tenne";
const char * mekkaname="khanfahrt";

int fzstatus[MAX_FZ];
int fzobj[MAX_FZ];

// fzstatus übernimmt Statusinfos fuer die einzelnen Fz
// die 4 LSB zeigen den Fz-Status an, dergestalt dass eine &-Abfrage auf das Bit einen True-Wert ergibt, wenn
// der Status gueltig ist
// Bit 0 = Fz ist auf Funk
// Bit 1 = Fz ist disponiert auf Anfahrt
// Bit 2 = Fz ist belegt
// Bit 3 = ..
// die Bits 4 bis .. klassifzieren das Fz
// Bit 4 : Notarztbesetzt
// Bit 5 : kann Patienten transportieren
// Bit 6 : Fluggeraet
// Bit 7 : Führungsfz
// Bit 8 : LöschFz
// Bit 9 : Hubretter
// Bit 10 : Hilfeleistungssatz
// Bit 11 : Taucher
// Bit 12 : führt Wasser
// Bit 13 : GTLF
// Bit 14 : 
// Bit 15 : 
// Bit 16 : Pol
// Bit 17 : MTW
// Bit 18 : KriPo
// Bit 19 : SEK
// Bit 20 : 

const int FZ_FUNK=1;
const int FZ_ALARM=2;
const int FZ_ANFAHRT=4;
const int FZ_BELEGT=8;
const int FZ_DEFEKT=12;

const int FLAG_FUNK=OF_HAS_FIREAXE * 2;
const int FLAG_SOSI=OF_HAS_FIREAXE * 4;
const int FLAG_TL=OF_HAS_FIREAXE * 8;
const int FLAG_NA=OF_HAS_FIREAXE * 16;
const int FLAG_P_NEU=OF_HAS_FIREAXE * 32;
const int FLAG_NOMOVE=OF_HAS_FIREAXE * 64;

//
// BOS Diskriminatoren
//
const int FZ_FW = 16;
const int FZ_POL = 32;
const int FZ_RD = 64;
const int FZ_TEC = 128;
//
// Fz Klassen Diskriminatoren
//
const int FZ_FUEHRUNG=FZ_TEC*2; // ELW2 codiert als TEC/ELW
const int FZ_T=FZ_FUEHRUNG*2;
const int FZ_S=FZ_T*2;
const int FZ_G=FZ_S*2;
const int FZ_PA=FZ_G*2;
const int FZ_CSA=FZ_PA*2;
const int FZ_TAU=FZ_CSA*2;
const int FZ_BW=FZ_TAU*2;
const int FZ_TYPE_BASE=2*FZ_BW;
//
// Fz Typ Diskriminatoren
// Klasse 3 : RD
//
const int FZ_RTW=FZ_TYPE_BASE;
const int FZ_NA=FZ_RTW*2;
const int FZ_RTH=FZ_NA*2;
const int FZ_ITH=FZ_RTH*2;
const int FZ_SAR=FZ_ITH*2;
const int FZ_BSW=FZ_SAR*2;
const int FZ_RHS=FZ_BSW*2;
const int FZ_RF=FZ_RHS*2;
const int FZ_OP=FZ_RF*2;
//
// Klasse 2
// Polizei
//
const int FZ_STW=FZ_TYPE_BASE;
const int FZ_KRIPO=FZ_STW*2;
const int FZ_MTW=FZ_KRIPO*2;
const int FZ_WAWE=FZ_MTW*2;
const int FZ_PHC=FZ_WAWE*2;
const int FZ_SEK=FZ_PHC*2;
const int FZ_KMRD=FZ_SEK*2;
const int FZ_STREIFE=FZ_KMRD*2;
// 
// Klasse 4
// TEC
//
const int FZ_BAHN=FZ_TYPE_BASE;
const int FZ_SWT=FZ_BAHN*2;
const int FZ_ELEKTRO=FZ_SWT*2;
const int FZ_KRAN=FZ_ELEKTRO*2;
const int FZ_ASF=FZ_KRAN*2;
const int FZ_FWB=FZ_ASF*2;
//
// Klasse 1
// Feuerwehr
//
const int FZ_LF=FZ_TYPE_BASE;
const int FZ_TLF=FZ_LF*2;
const int FZ_DLK=FZ_TLF*2;
const int FZ_THL=FZ_DLK*2;
const int FZ_GTLF=FZ_THL*2;
const int FZ_DEKON=FZ_GTLF*2;
const int FZ_GWAS=FZ_DEKON*2;
const int FZ_GWN=FZ_GWAS*2;
const int FZ_SIMBA=FZ_GWN*2;
//
const int FZ_NOSTAT_MASK=2*FZ_OP-16;
//
const int usetecmask=FZ_POL|FZ_TEC|FZ_ELEKTRO|FZ_BAHN|FZ_SWT|FZ_KMRD;
//

object fza101 : CommandScript
{

   fza101()
   {	
	SetIcon("rd1012");
	SetCursor("rd101");
	SetGroupID(1);
	SetGroupLeader(false);
	SetRestrictions(RESTRICT_SELFEXECUTE);
   }

   bool CheckGroupVisibility(GameObject *Caller)
   {
	int stat=fzstatus[1]&13; return stat>0 && stat<12;
   }

	bool CheckTarget(GameObject *Caller, Actor *Target, int ChildID)
	{
		return true;
	}

   void PushActions(GameObject *Caller, Actor *Target, int childID)
   {
	fzlocal::fza_look(Caller,1,Input::LCtrlPressed());
   }
};

object fza102 : CommandScript
{

   fza102()
   {	
	SetIcon("rd1022");
	SetCursor("rd102");
	SetGroupID(2);
	SetGroupLeader(false);
	SetRestrictions(RESTRICT_SELFEXECUTE);
   }

   bool CheckGroupVisibility(GameObject *Caller)
   {
	int stat=fzstatus[2]&13; return stat>0 && stat<12;
   }

	bool CheckTarget(GameObject *Caller, Actor *Target, int ChildID)
	{
		return true;
	}

   void PushActions(GameObject *Caller, Actor *Target, int childID)
   {
	fzlocal::fza_look(Caller,2,Input::LCtrlPressed());
   }
};

object fza103 : CommandScript
{

   fza103()
   {	
	SetIcon("winterberg");
	SetCursor("winterberg");
	SetGroupID(3);
	SetGroupLeader(false);
	SetRestrictions(RESTRICT_SELFEXECUTE);
   }

   bool CheckGroupVisibility(GameObject *Caller)
   {
	int stat=fzstatus[3]&13; return stat>0 && stat<12;
   }

	bool CheckTarget(GameObject *Caller, Actor *Target, int ChildID)
	{
		return true;
	}

   void PushActions(GameObject *Caller, Actor *Target, int childID)
   {
	fzlocal::fza_look(Caller,3,Input::LCtrlPressed());
   }
};

object fza104 : CommandScript
{

   fza104()
   {	
	SetIcon("niedersfeld");
	SetCursor("niedersfeld");
	SetGroupID(4);
	SetGroupLeader(false);
	SetRestrictions(RESTRICT_SELFEXECUTE);
   }

   bool CheckGroupVisibility(GameObject *Caller)
   {
	int stat=fzstatus[4]&13; return stat>0 && stat<12;
   }

	bool CheckTarget(GameObject *Caller, Actor *Target, int ChildID)
	{
		return true;
	}

   void PushActions(GameObject *Caller, Actor *Target, int childID)
   {
	fzlocal::fza_look(Caller,4,Input::LCtrlPressed());
   }
};

object fza105 : CommandScript
{

   fza105()
   {	
	SetIcon("winterberg");
	SetCursor("winterberg");
	SetGroupID(5);
	SetGroupLeader(false);
	SetRestrictions(RESTRICT_SELFEXECUTE);
   }

   bool CheckGroupVisibility(GameObject *Caller)
   {
	int stat=fzstatus[5]&13; return stat>0 && stat<12;
   }

	bool CheckTarget(GameObject *Caller, Actor *Target, int ChildID)
	{
		return true;
	}

   void PushActions(GameObject *Caller, Actor *Target, int childID)
   {
	fzlocal::fza_look(Caller,5,Input::LCtrlPressed());
   }
};

object fza106 : CommandScript
{

   fza106()
   {	
	SetIcon("rufe_dlk");
	SetCursor("rufe_dlk");
	SetGroupID(6);
	SetGroupLeader(false);
	SetRestrictions(RESTRICT_SELFEXECUTE);
   }

   bool CheckGroupVisibility(GameObject *Caller)
   {
	int stat=fzstatus[6]&13; return stat>0 && stat<12;
   }

	bool CheckTarget(GameObject *Caller, Actor *Target, int ChildID)
	{
		return true;
	}

   void PushActions(GameObject *Caller, Actor *Target, int childID)
   {
	fzlocal::fza_look(Caller,6,Input::LCtrlPressed());
   }
};

object fza107 : CommandScript
{

   fza107()
   {	
	SetIcon("rufe_streife");
	SetCursor("rufe_streife");
	SetGroupID(7);
	SetGroupLeader(false);
	SetRestrictions(RESTRICT_SELFEXECUTE);
   }

   bool CheckGroupVisibility(GameObject *Caller)
   {
	int stat=fzstatus[7]&13; return stat>0 && stat<12;
   }

	bool CheckTarget(GameObject *Caller, Actor *Target, int ChildID)
	{
		return true;
	}

   void PushActions(GameObject *Caller, Actor *Target, int childID)
   {
	fzlocal::fza_look(Caller,7,Input::LCtrlPressed());
   }
};

object fza108 : CommandScript
{

   fza108()
   {	
	SetIcon("rufe_streife");
	SetCursor("rufe_streife");
	SetGroupID(8);
	SetGroupLeader(false);
	SetRestrictions(RESTRICT_SELFEXECUTE);
   }

   bool CheckGroupVisibility(GameObject *Caller)
   {
	int stat=fzstatus[8]&13; return stat>0 && stat<12;
   }

	bool CheckTarget(GameObject *Caller, Actor *Target, int ChildID)
	{
		return true;
	}

   void PushActions(GameObject *Caller, Actor *Target, int childID)
   {
	fzlocal::fza_look(Caller,8,Input::LCtrlPressed());
   }
};

object fza109 : CommandScript
{

   fza109()
   {	
	SetIcon("rufe_streife");
	SetCursor("rufe_streife");
	SetGroupID(9);
	SetGroupLeader(false);
	SetRestrictions(RESTRICT_SELFEXECUTE);
   }

   bool CheckGroupVisibility(GameObject *Caller)
   {
	int stat=fzstatus[9]&13; return stat>0 && stat<12;
   }

	bool CheckTarget(GameObject *Caller, Actor *Target, int ChildID)
	{
		return true;
	}

   void PushActions(GameObject *Caller, Actor *Target, int childID)
   {
	fzlocal::fza_look(Caller,9,Input::LCtrlPressed());
   }
};

object fza110 : CommandScript
{

   fza110()
   {	
	SetIcon("rufe_mtw");
	SetCursor("rufe_mtw");
	SetGroupID(10);
	SetGroupLeader(false);
	SetRestrictions(RESTRICT_SELFEXECUTE);
   }

   bool CheckGroupVisibility(GameObject *Caller)
   {
	int stat=fzstatus[10]&13; return stat>0 && stat<12;
   }

	bool CheckTarget(GameObject *Caller, Actor *Target, int ChildID)
	{
		return true;
	}

   void PushActions(GameObject *Caller, Actor *Target, int childID)
   {
	fzlocal::fza_look(Caller,10,Input::LCtrlPressed());
   }
};

object fza111 : CommandScript
{

   fza111()
   {	
	SetIcon("adac");
	SetCursor("adac");
	SetGroupID(11);
	SetGroupLeader(false);
	SetRestrictions(RESTRICT_SELFEXECUTE);
   }

   bool CheckGroupVisibility(GameObject *Caller)
   {
	int stat=fzstatus[11]&13; return stat>0 && stat<12;
   }

	bool CheckTarget(GameObject *Caller, Actor *Target, int ChildID)
	{
		return true;
	}

   void PushActions(GameObject *Caller, Actor *Target, int childID)
   {
	fzlocal::fza_look(Caller,11,Input::LCtrlPressed());
   }
};

object fza112 : CommandScript
{

   fza112()
   {	
	SetIcon("rd1122");
	SetCursor("rd112");
	SetGroupID(12);
	SetGroupLeader(false);
	SetRestrictions(RESTRICT_SELFEXECUTE);
   }

   bool CheckGroupVisibility(GameObject *Caller)
   {
	int stat=fzstatus[12]&13; return stat>0 && stat<12;
   }

	bool CheckTarget(GameObject *Caller, Actor *Target, int ChildID)
	{
		return true;
	}

   void PushActions(GameObject *Caller, Actor *Target, int childID)
   {
	fzlocal::fza_look(Caller,12,Input::LCtrlPressed());
   }
};

object fza113 : CommandScript
{

   fza113()
   {	
	SetIcon("rufe_siemens");
	SetCursor("rufe_siemens");
	SetGroupID(13);
	SetGroupLeader(false);
	SetRestrictions(RESTRICT_SELFEXECUTE);
   }

   bool CheckGroupVisibility(GameObject *Caller)
   {
	int stat=fzstatus[13]&13; return stat>0 && stat<12;
   }

	bool CheckTarget(GameObject *Caller, Actor *Target, int ChildID)
	{
		return true;
	}

   void PushActions(GameObject *Caller, Actor *Target, int childID)
   {
	fzlocal::fza_look(Caller,13,Input::LCtrlPressed());
   }
};

object fza114 : CommandScript
{

   fza114()
   {	
	SetIcon("rd1142");
	SetCursor("rd114");
	SetGroupID(14);
	SetGroupLeader(false);
	SetRestrictions(RESTRICT_SELFEXECUTE);
   }

   bool CheckGroupVisibility(GameObject *Caller)
   {
	int stat=fzstatus[14]&13; return stat>0 && stat<12;
   }

	bool CheckTarget(GameObject *Caller, Actor *Target, int ChildID)
	{
		return true;
	}

   void PushActions(GameObject *Caller, Actor *Target, int childID)
   {
	fzlocal::fza_look(Caller,14,Input::LCtrlPressed());
   }
};

object fza115 : CommandScript
{

   fza115()
   {	
	SetIcon("gwm");
	SetCursor("gwm");
	SetGroupID(15);
	SetGroupLeader(false);
	SetRestrictions(RESTRICT_SELFEXECUTE);
   }

   bool CheckGroupVisibility(GameObject *Caller)
   {
	int stat=fzstatus[15]&13; return stat>0 && stat<12;
   }

	bool CheckTarget(GameObject *Caller, Actor *Target, int ChildID)
	{
		return true;
	}

   void PushActions(GameObject *Caller, Actor *Target, int childID)
   {
	fzlocal::fza_look(Caller,15,Input::LCtrlPressed());
   }
};

object fza116 : CommandScript
{

   fza116()
   {	
	SetIcon("rufe_kran");
	SetCursor("rufe_kran");
	SetGroupID(16);
	SetGroupLeader(false);
	SetRestrictions(RESTRICT_SELFEXECUTE);
   }

   bool CheckGroupVisibility(GameObject *Caller)
   {
	int stat=fzstatus[16]&13; return stat>0 && stat<12;
   }

	bool CheckTarget(GameObject *Caller, Actor *Target, int ChildID)
	{
		return true;
	}

   void PushActions(GameObject *Caller, Actor *Target, int childID)
   {
	fzlocal::fza_look(Caller,16,Input::LCtrlPressed());
   }
};

object fza117 : CommandScript
{

   fza117()
   {	
	SetIcon("schwarz");
	SetCursor("schwarz");
	SetGroupID(17);
	SetGroupLeader(false);
	SetRestrictions(RESTRICT_SELFEXECUTE);
   }

   bool CheckGroupVisibility(GameObject *Caller)
   {
	int stat=fzstatus[17]&13; return stat>0 && stat<12;
   }

	bool CheckTarget(GameObject *Caller, Actor *Target, int ChildID)
	{
		return true;
	}

   void PushActions(GameObject *Caller, Actor *Target, int childID)
   {
	fzlocal::fza_look(Caller,17,Input::LCtrlPressed());
   }
};

object fza118 : CommandScript
{

   fza118()
   {	
	SetIcon("rufe_hummel");
	SetCursor("rufe_hummel");
	SetGroupID(18);
	SetGroupLeader(false);
	SetRestrictions(RESTRICT_SELFEXECUTE);
   }

   bool CheckGroupVisibility(GameObject *Caller)
   {
	int stat=fzstatus[18]&13; return stat>0 && stat<12;
   }

	bool CheckTarget(GameObject *Caller, Actor *Target, int ChildID)
	{
		return true;
	}

   void PushActions(GameObject *Caller, Actor *Target, int childID)
   {
	fzlocal::fza_look(Caller,18,Input::LCtrlPressed());
   }
};

object fza119 : CommandScript
{

   fza119()
   {	
	SetIcon("zueschen");
	SetCursor("zueschen");
	SetGroupID(19);
	SetGroupLeader(false);
	SetRestrictions(RESTRICT_SELFEXECUTE);
   }

   bool CheckGroupVisibility(GameObject *Caller)
   {
	int stat=fzstatus[19]&13; return stat>0 && stat<12;
   }

	bool CheckTarget(GameObject *Caller, Actor *Target, int ChildID)
	{
		return true;
	}

   void PushActions(GameObject *Caller, Actor *Target, int childID)
   {
	fzlocal::fza_look(Caller,19,Input::LCtrlPressed());
   }
};

object fza120 : CommandScript
{

   fza120()
   {	
	SetIcon("rufe_gtlf");
	SetCursor("rufe_gtlf");
	SetGroupID(20);
	SetGroupLeader(false);
	SetRestrictions(RESTRICT_SELFEXECUTE);
   }

   bool CheckGroupVisibility(GameObject *Caller)
   {
	int stat=fzstatus[20]&13; return stat>0 && stat<12;
   }

	bool CheckTarget(GameObject *Caller, Actor *Target, int ChildID)
	{
		return true;
	}

   void PushActions(GameObject *Caller, Actor *Target, int childID)
   {
	fzlocal::fza_look(Caller,20,Input::LCtrlPressed());
   }
};

object fza121 : CommandScript
{

   fza121()
   {	
	SetIcon("rd1212");
	SetCursor("rd121");
	SetGroupID(21);
	SetGroupLeader(false);
	SetRestrictions(RESTRICT_SELFEXECUTE);
   }

   bool CheckGroupVisibility(GameObject *Caller)
   {
	int stat=fzstatus[21]&13; return stat>0 && stat<12;
   }

	bool CheckTarget(GameObject *Caller, Actor *Target, int ChildID)
	{
		return true;
	}

   void PushActions(GameObject *Caller, Actor *Target, int childID)
   {
	fzlocal::fza_look(Caller,21,Input::LCtrlPressed());
   }
};

object fza122 : CommandScript
{

   fza122()
   {	
	SetIcon("rd1222");
	SetCursor("rd122");
	SetGroupID(22);
	SetGroupLeader(false);
	SetRestrictions(RESTRICT_SELFEXECUTE);
   }

   bool CheckGroupVisibility(GameObject *Caller)
   {
	int stat=fzstatus[22]&13; return stat>0 && stat<12;
   }

	bool CheckTarget(GameObject *Caller, Actor *Target, int ChildID)
	{
		return true;
	}

   void PushActions(GameObject *Caller, Actor *Target, int childID)
   {
	fzlocal::fza_look(Caller,22,Input::LCtrlPressed());
   }
};

object fza123 : CommandScript
{

   fza123()
   {	
	SetIcon("rd1232");
	SetCursor("rd123");
	SetGroupID(23);
	SetGroupLeader(false);
	SetRestrictions(RESTRICT_SELFEXECUTE);
   }

   bool CheckGroupVisibility(GameObject *Caller)
   {
	int stat=fzstatus[23]&13; return stat>0 && stat<12;
   }

	bool CheckTarget(GameObject *Caller, Actor *Target, int ChildID)
	{
		return true;
	}

   void PushActions(GameObject *Caller, Actor *Target, int childID)
   {
	fzlocal::fza_look(Caller,23,Input::LCtrlPressed());
   }
};

object fza124 : CommandScript
{

   fza124()
   {	
	SetIcon("rd1242");
	SetCursor("rd124");
	SetGroupID(24);
	SetGroupLeader(false);
	SetRestrictions(RESTRICT_SELFEXECUTE);
   }

   bool CheckGroupVisibility(GameObject *Caller)
   {
	int stat=fzstatus[24]&13; return stat>0 && stat<12;
   }

	bool CheckTarget(GameObject *Caller, Actor *Target, int ChildID)
	{
		return true;
	}

   void PushActions(GameObject *Caller, Actor *Target, int childID)
   {
	fzlocal::fza_look(Caller,24,Input::LCtrlPressed());
   }
};

object fza125 : CommandScript
{

   fza125()
   {	
	SetIcon("rd1252");
	SetCursor("rd125");
	SetGroupID(25);
	SetGroupLeader(false);
	SetRestrictions(RESTRICT_SELFEXECUTE);
   }

   bool CheckGroupVisibility(GameObject *Caller)
   {
	int stat=fzstatus[25]&13; return stat>0 && stat<12;
   }

	bool CheckTarget(GameObject *Caller, Actor *Target, int ChildID)
	{
		return true;
	}

   void PushActions(GameObject *Caller, Actor *Target, int childID)
   {
	fzlocal::fza_look(Caller,25,Input::LCtrlPressed());
   }
};

object fza126 : CommandScript
{

   fza126()
   {	
	SetIcon("rd1262");
	SetCursor("rd126");
	SetGroupID(26);
	SetGroupLeader(false);
	SetRestrictions(RESTRICT_SELFEXECUTE);
   }

   bool CheckGroupVisibility(GameObject *Caller)
   {
	int stat=fzstatus[26]&13; return stat>0 && stat<12;
   }

	bool CheckTarget(GameObject *Caller, Actor *Target, int ChildID)
	{
		return true;
	}

   void PushActions(GameObject *Caller, Actor *Target, int childID)
   {
	fzlocal::fza_look(Caller,26,Input::LCtrlPressed());
   }
};

object fza127 : CommandScript
{

   fza127()
   {	
	SetIcon("rd1272");
	SetCursor("rd127");
	SetGroupID(27);
	SetGroupLeader(false);
	SetRestrictions(RESTRICT_SELFEXECUTE);
   }

   bool CheckGroupVisibility(GameObject *Caller)
   {
	int stat=fzstatus[27]&13; return stat>0 && stat<12;
   }

	bool CheckTarget(GameObject *Caller, Actor *Target, int ChildID)
	{
		return true;
	}

   void PushActions(GameObject *Caller, Actor *Target, int childID)
   {
	fzlocal::fza_look(Caller,27,Input::LCtrlPressed());
   }
};

object fza128 : CommandScript
{

   fza128()
   {	
	SetIcon("groenebach");
	SetCursor("groenebach");
	SetGroupID(28);
	SetGroupLeader(false);
	SetRestrictions(RESTRICT_SELFEXECUTE);
   }

   bool CheckGroupVisibility(GameObject *Caller)
   {
	int stat=fzstatus[28]&13; return stat>0 && stat<12;
   }

	bool CheckTarget(GameObject *Caller, Actor *Target, int ChildID)
	{
		return true;
	}

   void PushActions(GameObject *Caller, Actor *Target, int childID)
   {
	fzlocal::fza_look(Caller,28,Input::LCtrlPressed());
   }
};

object fza129 : CommandScript
{

   fza129()
   {	
	SetIcon("langewiese");
	SetCursor("langewiese");
	SetGroupID(29);
	SetGroupLeader(false);
	SetRestrictions(RESTRICT_SELFEXECUTE);
   }

   bool CheckGroupVisibility(GameObject *Caller)
   {
	int stat=fzstatus[29]&13; return stat>0 && stat<12;
   }

	bool CheckTarget(GameObject *Caller, Actor *Target, int ChildID)
	{
		return true;
	}

   void PushActions(GameObject *Caller, Actor *Target, int childID)
   {
	fzlocal::fza_look(Caller,29,Input::LCtrlPressed());
   }
};

object fza130 : CommandScript
{

   fza130()
   {	
	SetIcon("zueschen");
	SetCursor("zueschen");
	SetGroupID(30);
	SetGroupLeader(false);
	SetRestrictions(RESTRICT_SELFEXECUTE);
   }

   bool CheckGroupVisibility(GameObject *Caller)
   {
	int stat=fzstatus[30]&13; return stat>0 && stat<12;
   }

	bool CheckTarget(GameObject *Caller, Actor *Target, int ChildID)
	{
		return true;
	}

   void PushActions(GameObject *Caller, Actor *Target, int childID)
   {
	fzlocal::fza_look(Caller,30,Input::LCtrlPressed());
   }
};

object fza131 : CommandScript
{

   fza131()
   {	
	SetIcon("siedlhsn");
	SetCursor("siedlhsn");
	SetGroupID(31);
	SetGroupLeader(false);
	SetRestrictions(RESTRICT_SELFEXECUTE);
   }

   bool CheckGroupVisibility(GameObject *Caller)
   {
	int stat=fzstatus[31]&13; return stat>0 && stat<12;
   }

	bool CheckTarget(GameObject *Caller, Actor *Target, int ChildID)
	{
		return true;
	}

   void PushActions(GameObject *Caller, Actor *Target, int childID)
   {
	fzlocal::fza_look(Caller,31,Input::LCtrlPressed());
   }
};

object fza132 : CommandScript
{

   fza132()
   {	
	SetIcon("rd132");
	SetCursor("rd132");
	SetGroupID(32);
	SetGroupLeader(false);
	SetRestrictions(RESTRICT_SELFEXECUTE);
   }

   bool CheckGroupVisibility(GameObject *Caller)
   {
	int stat=fzstatus[32]&13; return stat>0 && stat<12;
   }

	bool CheckTarget(GameObject *Caller, Actor *Target, int ChildID)
	{
		return true;
	}

   void PushActions(GameObject *Caller, Actor *Target, int childID)
   {
	fzlocal::fza_look(Caller,32,Input::LCtrlPressed());
   }
};

object fza133 : CommandScript
{

   fza133()
   {	
	SetIcon("rufe_nfm");
	SetCursor("rufe_nfm");
	SetGroupID(33);
	SetGroupLeader(false);
	SetRestrictions(RESTRICT_SELFEXECUTE);
   }

   bool CheckGroupVisibility(GameObject *Caller)
   {
	int stat=fzstatus[33]&13; return stat>0 && stat<12;
   }

	bool CheckTarget(GameObject *Caller, Actor *Target, int ChildID)
	{
		return true;
	}

   void PushActions(GameObject *Caller, Actor *Target, int childID)
   {
	fzlocal::fza_look(Caller,33,Input::LCtrlPressed());
   }
};

object fza134 : CommandScript
{

   fza134()
   {	
	SetIcon("rufe_bomber");
	SetCursor("rufe_bomber");
	SetGroupID(34);
	SetGroupLeader(false);
	SetRestrictions(RESTRICT_SELFEXECUTE);
   }

   bool CheckGroupVisibility(GameObject *Caller)
   {
	int stat=fzstatus[34]&13; return stat>0 && stat<12;
   }

	bool CheckTarget(GameObject *Caller, Actor *Target, int ChildID)
	{
		return true;
	}

   void PushActions(GameObject *Caller, Actor *Target, int childID)
   {
	fzlocal::fza_look(Caller,34,Input::LCtrlPressed());
   }
};

object fza135 : CommandScript
{

   fza135()
   {	
	SetIcon("SEG");
	SetCursor("SEG");
	SetGroupID(35);
	SetGroupLeader(false);
	SetRestrictions(RESTRICT_SELFEXECUTE);
   }

   bool CheckGroupVisibility(GameObject *Caller)
   {
	int stat=fzstatus[35]&13; return stat>0 && stat<12;
   }

	bool CheckTarget(GameObject *Caller, Actor *Target, int ChildID)
	{
		return true;
	}

   void PushActions(GameObject *Caller, Actor *Target, int childID)
   {
	fzlocal::fza_look(Caller,35,Input::LCtrlPressed());
   }
};

object fza136 : CommandScript
{

   fza136()
   {	
	SetIcon("SEG");
	SetCursor("SEG");
	SetGroupID(36);
	SetGroupLeader(false);
	SetRestrictions(RESTRICT_SELFEXECUTE);
   }

   bool CheckGroupVisibility(GameObject *Caller)
   {
	int stat=fzstatus[36]&13; return stat>0 && stat<12;
   }

	bool CheckTarget(GameObject *Caller, Actor *Target, int ChildID)
	{
		return true;
	}

   void PushActions(GameObject *Caller, Actor *Target, int childID)
   {
	fzlocal::fza_look(Caller,36,Input::LCtrlPressed());
   }
};

object fza137 : CommandScript
{

   fza137()
   {	
	SetIcon("SEG");
	SetCursor("SEG");
	SetGroupID(37);
	SetGroupLeader(false);
	SetRestrictions(RESTRICT_SELFEXECUTE);
   }

   bool CheckGroupVisibility(GameObject *Caller)
   {
	int stat=fzstatus[37]&13; return stat>0 && stat<12;
   }

	bool CheckTarget(GameObject *Caller, Actor *Target, int ChildID)
	{
		return true;
	}

   void PushActions(GameObject *Caller, Actor *Target, int childID)
   {
	fzlocal::fza_look(Caller,37,Input::LCtrlPressed());
   }
};

object fza138 : CommandScript
{

   fza138()
   {	
	SetIcon("siedlhsn");
	SetCursor("siedlhsn");
	SetGroupID(38);
	SetGroupLeader(false);
	SetRestrictions(RESTRICT_SELFEXECUTE);
   }

   bool CheckGroupVisibility(GameObject *Caller)
   {
	int stat=fzstatus[38]&13; return stat>0 && stat<12;
   }

	bool CheckTarget(GameObject *Caller, Actor *Target, int ChildID)
	{
		return true;
	}

   void PushActions(GameObject *Caller, Actor *Target, int childID)
   {
	fzlocal::fza_look(Caller,38,Input::LCtrlPressed());
   }
};

object fza139 : CommandScript
{

   fza139()
   {	
	SetIcon("lkw");
	SetCursor("lkw");
	SetGroupID(39);
	SetGroupLeader(false);
	SetRestrictions(RESTRICT_SELFEXECUTE);
   }

   bool CheckGroupVisibility(GameObject *Caller)
   {
	int stat=fzstatus[39]&13; return stat>0 && stat<12;
   }

	bool CheckTarget(GameObject *Caller, Actor *Target, int ChildID)
	{
		return true;
	}

   void PushActions(GameObject *Caller, Actor *Target, int childID)
   {
	fzlocal::fza_look(Caller,39,Input::LCtrlPressed());
   }
};

object fza140 : CommandScript
{

   fza140()
   {	
	SetIcon("zug");
	SetCursor("zug");
	SetGroupID(40);
	SetGroupLeader(false);
	SetRestrictions(RESTRICT_SELFEXECUTE);
   }

   bool CheckGroupVisibility(GameObject *Caller)
   {
	int stat=fzstatus[40]&13; return stat>0 && stat<12;
   }

	bool CheckTarget(GameObject *Caller, Actor *Target, int ChildID)
	{
		return true;
	}

   void PushActions(GameObject *Caller, Actor *Target, int childID)
   {
	fzlocal::fza_look(Caller,40,Input::LCtrlPressed());
   }
};

object fza141 : CommandScript
{

   fza141()
   {	
	SetIcon("rufe_dekon");
	SetCursor("rufe_dekon");
	SetGroupID(41);
	SetGroupLeader(false);
	SetRestrictions(RESTRICT_SELFEXECUTE);
   }

   bool CheckGroupVisibility(GameObject *Caller)
   {
	int stat=fzstatus[41]&13; return stat>0 && stat<12;
   }

	bool CheckTarget(GameObject *Caller, Actor *Target, int ChildID)
	{
		return true;
	}

   void PushActions(GameObject *Caller, Actor *Target, int childID)
   {
	fzlocal::fza_look(Caller,41,Input::LCtrlPressed());
   }
};

object fza142 : CommandScript
{

   fza142()
   {	
	SetIcon("elkeringhsn");
	SetCursor("elkeringhsn");
	SetGroupID(42);
	SetGroupLeader(false);
	SetRestrictions(RESTRICT_SELFEXECUTE);
   }

   bool CheckGroupVisibility(GameObject *Caller)
   {
	int stat=fzstatus[42]&13; return stat>0 && stat<12;
   }

	bool CheckTarget(GameObject *Caller, Actor *Target, int ChildID)
	{
		return true;
	}

   void PushActions(GameObject *Caller, Actor *Target, int childID)
   {
	fzlocal::fza_look(Caller,42,Input::LCtrlPressed());
   }
};

object fza143 : CommandScript
{

   fza143()
   {	
	SetIcon("altenfeld");
	SetCursor("altenfeld");
	SetGroupID(43);
	SetGroupLeader(false);
	SetRestrictions(RESTRICT_SELFEXECUTE);
   }

   bool CheckGroupVisibility(GameObject *Caller)
   {
	int stat=fzstatus[43]&13; return stat>0 && stat<12;
   }

	bool CheckTarget(GameObject *Caller, Actor *Target, int ChildID)
	{
		return true;
	}

   void PushActions(GameObject *Caller, Actor *Target, int childID)
   {
	fzlocal::fza_look(Caller,43,Input::LCtrlPressed());
   }
};

object fza144 : CommandScript
{

   fza144()
   {	
	SetIcon("rufe_lf");
	SetCursor("rufe_lf");
	SetGroupID(44);
	SetGroupLeader(false);
	SetRestrictions(RESTRICT_SELFEXECUTE);
   }

   bool CheckGroupVisibility(GameObject *Caller)
   {
	int stat=fzstatus[44]&13; return stat>0 && stat<12;
   }

	bool CheckTarget(GameObject *Caller, Actor *Target, int ChildID)
	{
		return true;
	}

   void PushActions(GameObject *Caller, Actor *Target, int childID)
   {
	fzlocal::fza_look(Caller,44,Input::LCtrlPressed());
   }
};

object fza145 : CommandScript
{

   fza145()
   {	
	SetIcon("altastenberg");
	SetCursor("altastenberg");
	SetGroupID(45);
	SetGroupLeader(false);
	SetRestrictions(RESTRICT_SELFEXECUTE);
   }

   bool CheckGroupVisibility(GameObject *Caller)
   {
	int stat=fzstatus[45]&13; return stat>0 && stat<12;
   }

	bool CheckTarget(GameObject *Caller, Actor *Target, int ChildID)
	{
		return true;
	}

   void PushActions(GameObject *Caller, Actor *Target, int childID)
   {
	fzlocal::fza_look(Caller,45,Input::LCtrlPressed());
   }
};

object fza146 : CommandScript
{

   fza146()
   {	
	SetIcon("rufe_dlk");
	SetCursor("rufe_dlk");
	SetGroupID(46);
	SetGroupLeader(false);
	SetRestrictions(RESTRICT_SELFEXECUTE);
   }

   bool CheckGroupVisibility(GameObject *Caller)
   {
	int stat=fzstatus[46]&13; return stat>0 && stat<12;
   }

	bool CheckTarget(GameObject *Caller, Actor *Target, int ChildID)
	{
		return true;
	}

   void PushActions(GameObject *Caller, Actor *Target, int childID)
   {
	fzlocal::fza_look(Caller,46,Input::LCtrlPressed());
   }
};

object fza147 : CommandScript
{

   fza147()
   {	
	SetIcon("neuastenberg");
	SetCursor("neuastenberg");
	SetGroupID(47);
	SetGroupLeader(false);
	SetRestrictions(RESTRICT_SELFEXECUTE);
   }

   bool CheckGroupVisibility(GameObject *Caller)
   {
	int stat=fzstatus[47]&13; return stat>0 && stat<12;
   }

	bool CheckTarget(GameObject *Caller, Actor *Target, int ChildID)
	{
		return true;
	}

   void PushActions(GameObject *Caller, Actor *Target, int childID)
   {
	fzlocal::fza_look(Caller,47,Input::LCtrlPressed());
   }
};

object fza148 : CommandScript
{

   fza148()
   {	
	SetIcon("rd1482");
	SetCursor("rd148");
	SetGroupID(48);
	SetGroupLeader(false);
	SetRestrictions(RESTRICT_SELFEXECUTE);
   }

   bool CheckGroupVisibility(GameObject *Caller)
   {
	int stat=fzstatus[48]&13; return stat>0 && stat<12;
   }

	bool CheckTarget(GameObject *Caller, Actor *Target, int ChildID)
	{
		return true;
	}

   void PushActions(GameObject *Caller, Actor *Target, int childID)
   {
	fzlocal::fza_look(Caller,48,Input::LCtrlPressed());
   }
};

object fza149 : CommandScript
{

   fza149()
   {	
	SetIcon("niedersfeld");
	SetCursor("niedersfeld");
	SetGroupID(49);
	SetGroupLeader(false);
	SetRestrictions(RESTRICT_SELFEXECUTE);
   }

   bool CheckGroupVisibility(GameObject *Caller)
   {
	int stat=fzstatus[49]&13; return stat>0 && stat<12;
   }

	bool CheckTarget(GameObject *Caller, Actor *Target, int ChildID)
	{
		return true;
	}

   void PushActions(GameObject *Caller, Actor *Target, int childID)
   {
	fzlocal::fza_look(Caller,49,Input::LCtrlPressed());
   }
};

object fza150 : CommandScript
{

   fza150()
   {	
	SetIcon("rufe_lf");
	SetCursor("rufe_lf");
	SetGroupID(50);
	SetGroupLeader(false);
	SetRestrictions(RESTRICT_SELFEXECUTE);
   }

   bool CheckGroupVisibility(GameObject *Caller)
   {
	int stat=fzstatus[50]&13; return stat>0 && stat<12;
   }

	bool CheckTarget(GameObject *Caller, Actor *Target, int ChildID)
	{
		return true;
	}

   void PushActions(GameObject *Caller, Actor *Target, int childID)
   {
	fzlocal::fza_look(Caller,50,Input::LCtrlPressed());
   }
};

object fza151 : CommandScript
{

   fza151()
   {	
	SetIcon("niedersfeld");
	SetCursor("niedersfeld");
	SetGroupID(51);
	SetGroupLeader(false);
	SetRestrictions(RESTRICT_SELFEXECUTE);
   }

   bool CheckGroupVisibility(GameObject *Caller)
   {
	int stat=fzstatus[51]&13; return stat>0 && stat<12;
   }

	bool CheckTarget(GameObject *Caller, Actor *Target, int ChildID)
	{
		return true;
	}

   void PushActions(GameObject *Caller, Actor *Target, int childID)
   {
	fzlocal::fza_look(Caller,51,Input::LCtrlPressed());
   }
};

object fza152 : CommandScript
{

   fza152()
   {	
	SetIcon("siedlhsn");
	SetCursor("siedlhsn");
	SetGroupID(52);
	SetGroupLeader(false);
	SetRestrictions(RESTRICT_SELFEXECUTE);
   }

   bool CheckGroupVisibility(GameObject *Caller)
   {
	int stat=fzstatus[52]&13; return stat>0 && stat<12;
   }

	bool CheckTarget(GameObject *Caller, Actor *Target, int ChildID)
	{
		return true;
	}

   void PushActions(GameObject *Caller, Actor *Target, int childID)
   {
	fzlocal::fza_look(Caller,52,Input::LCtrlPressed());
   }
};

object fza153 : CommandScript
{

   fza153()
   {	
	SetIcon("zueschen");
	SetCursor("zueschen");
	SetGroupID(53);
	SetGroupLeader(false);
	SetRestrictions(RESTRICT_SELFEXECUTE);
   }

   bool CheckGroupVisibility(GameObject *Caller)
   {
	int stat=fzstatus[53]&13; return stat>0 && stat<12;
   }

	bool CheckTarget(GameObject *Caller, Actor *Target, int ChildID)
	{
		return true;
	}

   void PushActions(GameObject *Caller, Actor *Target, int childID)
   {
	fzlocal::fza_look(Caller,53,Input::LCtrlPressed());
   }
};

object fza154 : CommandScript
{

   fza154()
   {	
	SetIcon("hildfeld");
	SetCursor("hildfeld");
	SetGroupID(54);
	SetGroupLeader(false);
	SetRestrictions(RESTRICT_SELFEXECUTE);
   }

   bool CheckGroupVisibility(GameObject *Caller)
   {
	int stat=fzstatus[54]&13; return stat>0 && stat<12;
   }

	bool CheckTarget(GameObject *Caller, Actor *Target, int ChildID)
	{
		return true;
	}

   void PushActions(GameObject *Caller, Actor *Target, int childID)
   {
	fzlocal::fza_look(Caller,54,Input::LCtrlPressed());
   }
};

object fza155 : CommandScript
{

   fza155()
   {	
	SetIcon("silbach");
	SetCursor("silbach");
	SetGroupID(55);
	SetGroupLeader(false);
	SetRestrictions(RESTRICT_SELFEXECUTE);
   }

   bool CheckGroupVisibility(GameObject *Caller)
   {
	int stat=fzstatus[55]&13; return stat>0 && stat<12;
   }

	bool CheckTarget(GameObject *Caller, Actor *Target, int ChildID)
	{
		return true;
	}

   void PushActions(GameObject *Caller, Actor *Target, int childID)
   {
	fzlocal::fza_look(Caller,55,Input::LCtrlPressed());
   }
};

object fza156 : CommandScript
{

   fza156()
   {	
	SetIcon("kripo");
	SetCursor("kripo");
	SetGroupID(56);
	SetGroupLeader(false);
	SetRestrictions(RESTRICT_SELFEXECUTE);
   }

   bool CheckGroupVisibility(GameObject *Caller)
   {
	int stat=fzstatus[56]&13; return stat>0 && stat<12;
   }

	bool CheckTarget(GameObject *Caller, Actor *Target, int ChildID)
	{
		return true;
	}

   void PushActions(GameObject *Caller, Actor *Target, int childID)
   {
	fzlocal::fza_look(Caller,56,Input::LCtrlPressed());
   }
};

object fza157 : CommandScript
{

   fza157()
   {	
	SetIcon("wasserw");
	SetCursor("wasserw");
	SetGroupID(57);
	SetGroupLeader(false);
	SetRestrictions(RESTRICT_SELFEXECUTE);
   }

   bool CheckGroupVisibility(GameObject *Caller)
   {
	int stat=fzstatus[57]&13; return stat>0 && stat<12;
   }

	bool CheckTarget(GameObject *Caller, Actor *Target, int ChildID)
	{
		return true;
	}

   void PushActions(GameObject *Caller, Actor *Target, int childID)
   {
	fzlocal::fza_look(Caller,57,Input::LCtrlPressed());
   }
};

object fza158 : CommandScript
{

   fza158()
   {	
	SetIcon("rd1582");
	SetCursor("rd158");
	SetGroupID(58);
	SetGroupLeader(false);
	SetRestrictions(RESTRICT_SELFEXECUTE);
   }

   bool CheckGroupVisibility(GameObject *Caller)
   {
	int stat=fzstatus[58]&13; return stat>0 && stat<12;
   }

	bool CheckTarget(GameObject *Caller, Actor *Target, int ChildID)
	{
		return true;
	}

   void PushActions(GameObject *Caller, Actor *Target, int childID)
   {
	fzlocal::fza_look(Caller,58,Input::LCtrlPressed());
   }
};

object fza159 : CommandScript
{

   fza159()
   {	
	SetIcon("rufe_streife");
	SetCursor("rufe_streife");
	SetGroupID(59);
	SetGroupLeader(false);
	SetRestrictions(RESTRICT_SELFEXECUTE);
   }

   bool CheckGroupVisibility(GameObject *Caller)
   {
	int stat=fzstatus[59]&13; return stat>0 && stat<12;
   }

	bool CheckTarget(GameObject *Caller, Actor *Target, int ChildID)
	{
		return true;
	}

   void PushActions(GameObject *Caller, Actor *Target, int childID)
   {
	fzlocal::fza_look(Caller,59,Input::LCtrlPressed());
   }
};

object fza160 : CommandScript
{

   fza160()
   {	
	SetIcon("rd1602");
	SetCursor("rd160");
	SetGroupID(60);
	SetGroupLeader(false);
	SetRestrictions(RESTRICT_SELFEXECUTE);
   }

   bool CheckGroupVisibility(GameObject *Caller)
   {
	int stat=fzstatus[60]&13; return stat>0 && stat<12;
   }

	bool CheckTarget(GameObject *Caller, Actor *Target, int ChildID)
	{
		return true;
	}

   void PushActions(GameObject *Caller, Actor *Target, int childID)
   {
	fzlocal::fza_look(Caller,60,Input::LCtrlPressed());
   }
};

object fza161 : CommandScript
{

   fza161()
   {	
	SetIcon("rufe_streife");
	SetCursor("rufe_streife");
	SetGroupID(61);
	SetGroupLeader(false);
	SetRestrictions(RESTRICT_SELFEXECUTE);
   }

   bool CheckGroupVisibility(GameObject *Caller)
   {
	int stat=fzstatus[61]&13; return stat>0 && stat<12;
   }

	bool CheckTarget(GameObject *Caller, Actor *Target, int ChildID)
	{
		return true;
	}

   void PushActions(GameObject *Caller, Actor *Target, int childID)
   {
	fzlocal::fza_look(Caller,61,Input::LCtrlPressed());
   }
};

object fza162 : CommandScript
{

   fza162()
   {	
	SetIcon("tel_alarm");
	SetCursor("tel_alarm");
	SetGroupID(62);
	SetGroupLeader(false);
	SetRestrictions(RESTRICT_SELFEXECUTE);
   }

   bool CheckGroupVisibility(GameObject *Caller)
   {
	int stat=fzstatus[62]&13; return stat>0 && stat<12;
   }

	bool CheckTarget(GameObject *Caller, Actor *Target, int ChildID)
	{
		return true;
	}

   void PushActions(GameObject *Caller, Actor *Target, int childID)
   {
	fzlocal::fza_look(Caller,62,Input::LCtrlPressed());
   }
};

object fza163 : CommandScript
{

   fza163()
   {	
	SetIcon("sama8583");
	SetCursor("sama8583");
	SetGroupID(63);
	SetGroupLeader(false);
	SetRestrictions(RESTRICT_SELFEXECUTE);
   }

   bool CheckGroupVisibility(GameObject *Caller)
   {
	int stat=fzstatus[63]&13; return stat>0 && stat<12;
   }

	bool CheckTarget(GameObject *Caller, Actor *Target, int ChildID)
	{
		return true;
	}

   void PushActions(GameObject *Caller, Actor *Target, int childID)
   {
	fzlocal::fza_look(Caller,63,Input::LCtrlPressed());
   }
};

object fza164 : CommandScript
{

   fza164()
   {	
	SetIcon("sama8882");
	SetCursor("sama8882");
	SetGroupID(64);
	SetGroupLeader(false);
	SetRestrictions(RESTRICT_SELFEXECUTE);
   }

   bool CheckGroupVisibility(GameObject *Caller)
   {
	int stat=fzstatus[64]&13; return stat>0 && stat<12;
   }

	bool CheckTarget(GameObject *Caller, Actor *Target, int ChildID)
	{
		return true;
	}

   void PushActions(GameObject *Caller, Actor *Target, int childID)
   {
	fzlocal::fza_look(Caller,64,Input::LCtrlPressed());
   }
};

object fza165 : CommandScript
{

   fza165()
   {	
	SetIcon("rd1652");
	SetCursor("rd165");
	SetGroupID(65);
	SetGroupLeader(false);
	SetRestrictions(RESTRICT_SELFEXECUTE);
   }

   bool CheckGroupVisibility(GameObject *Caller)
   {
	int stat=fzstatus[65]&13; return stat>0 && stat<12;
   }

	bool CheckTarget(GameObject *Caller, Actor *Target, int ChildID)
	{
		return true;
	}

   void PushActions(GameObject *Caller, Actor *Target, int childID)
   {
	fzlocal::fza_look(Caller,65,Input::LCtrlPressed());
   }
};

object fza166 : CommandScript
{

   fza166()
   {	
	SetIcon("rd1662");
	SetCursor("rd166");
	SetGroupID(66);
	SetGroupLeader(false);
	SetRestrictions(RESTRICT_SELFEXECUTE);
   }

   bool CheckGroupVisibility(GameObject *Caller)
   {
	int stat=fzstatus[66]&13; return stat>0 && stat<12;
   }

	bool CheckTarget(GameObject *Caller, Actor *Target, int ChildID)
	{
		return true;
	}

   void PushActions(GameObject *Caller, Actor *Target, int childID)
   {
	fzlocal::fza_look(Caller,66,Input::LCtrlPressed());
   }
};

object fza167 : CommandScript
{

   fza167()
   {	
	SetIcon("rd1672");
	SetCursor("rd167");
	SetGroupID(67);
	SetGroupLeader(false);
	SetRestrictions(RESTRICT_SELFEXECUTE);
   }

   bool CheckGroupVisibility(GameObject *Caller)
   {
	int stat=fzstatus[67]&13; return stat>0 && stat<12;
   }

	bool CheckTarget(GameObject *Caller, Actor *Target, int ChildID)
	{
		return true;
	}

   void PushActions(GameObject *Caller, Actor *Target, int childID)
   {
	fzlocal::fza_look(Caller,67,Input::LCtrlPressed());
   }
};

object fza168 : CommandScript
{

   fza168()
   {	
	SetIcon("wawepol");
	SetCursor("wawepol");
	SetGroupID(68);
	SetGroupLeader(false);
	SetRestrictions(RESTRICT_SELFEXECUTE);
   }

   bool CheckGroupVisibility(GameObject *Caller)
   {
	int stat=fzstatus[68]&13; return stat>0 && stat<12;
   }

	bool CheckTarget(GameObject *Caller, Actor *Target, int ChildID)
	{
		return true;
	}

   void PushActions(GameObject *Caller, Actor *Target, int childID)
   {
	fzlocal::fza_look(Caller,68,Input::LCtrlPressed());
   }
};

object fza169 : CommandScript
{

   fza169()
   {	
	SetIcon("sek");
	SetCursor("sek");
	SetGroupID(69);
	SetGroupLeader(false);
	SetRestrictions(RESTRICT_SELFEXECUTE);
   }

   bool CheckGroupVisibility(GameObject *Caller)
   {
	int stat=fzstatus[69]&13; return stat>0 && stat<12;
   }

	bool CheckTarget(GameObject *Caller, Actor *Target, int ChildID)
	{
		return true;
	}

   void PushActions(GameObject *Caller, Actor *Target, int childID)
   {
	fzlocal::fza_look(Caller,69,Input::LCtrlPressed());
   }
};

object fza170 : CommandScript
{

   fza170()
   {	
	SetIcon("sek");
	SetCursor("sek");
	SetGroupID(70);
	SetGroupLeader(false);
	SetRestrictions(RESTRICT_SELFEXECUTE);
   }

   bool CheckGroupVisibility(GameObject *Caller)
   {
	int stat=fzstatus[70]&13; return stat>0 && stat<12;
   }

	bool CheckTarget(GameObject *Caller, Actor *Target, int ChildID)
	{
		return true;
	}

   void PushActions(GameObject *Caller, Actor *Target, int childID)
   {
	fzlocal::fza_look(Caller,70,Input::LCtrlPressed());
   }
};

object fza171 : CommandScript
{

   fza171()
   {	
	SetIcon("demopol");
	SetCursor("demopol");
	SetGroupID(71);
	SetGroupLeader(false);
	SetRestrictions(RESTRICT_SELFEXECUTE);
   }

   bool CheckGroupVisibility(GameObject *Caller)
   {
	int stat=fzstatus[71]&13; return stat>0 && stat<12;
   }

	bool CheckTarget(GameObject *Caller, Actor *Target, int ChildID)
	{
		return true;
	}

   void PushActions(GameObject *Caller, Actor *Target, int childID)
   {
	fzlocal::fza_look(Caller,71,Input::LCtrlPressed());
   }
};

object fza172 : CommandScript
{

   fza172()
   {	
	SetIcon("demopol");
	SetCursor("demopol");
	SetGroupID(72);
	SetGroupLeader(false);
	SetRestrictions(RESTRICT_SELFEXECUTE);
   }

   bool CheckGroupVisibility(GameObject *Caller)
   {
	int stat=fzstatus[72]&13; return stat>0 && stat<12;
   }

	bool CheckTarget(GameObject *Caller, Actor *Target, int ChildID)
	{
		return true;
	}

   void PushActions(GameObject *Caller, Actor *Target, int childID)
   {
	fzlocal::fza_look(Caller,72,Input::LCtrlPressed());
   }
};

object fza173 : CommandScript
{

   fza173()
   {	
	SetIcon("ith");
	SetCursor("ith");
	SetGroupID(73);
	SetGroupLeader(false);
	SetRestrictions(RESTRICT_SELFEXECUTE);
   }

   bool CheckGroupVisibility(GameObject *Caller)
   {
	int stat=fzstatus[73]&13; return stat>0 && stat<12;
   }

	bool CheckTarget(GameObject *Caller, Actor *Target, int ChildID)
	{
		return true;
	}

   void PushActions(GameObject *Caller, Actor *Target, int childID)
   {
	fzlocal::fza_look(Caller,73,Input::LCtrlPressed());
   }
};

object fza174 : CommandScript
{

   fza174()
   {	
	SetIcon("ith");
	SetCursor("ith");
	SetGroupID(74);
	SetGroupLeader(false);
	SetRestrictions(RESTRICT_SELFEXECUTE);
   }

   bool CheckGroupVisibility(GameObject *Caller)
   {
	int stat=fzstatus[74]&13; return stat>0 && stat<12;
   }

	bool CheckTarget(GameObject *Caller, Actor *Target, int ChildID)
	{
		return true;
	}

   void PushActions(GameObject *Caller, Actor *Target, int childID)
   {
	fzlocal::fza_look(Caller,74,Input::LCtrlPressed());
   }
};

object fza175 : CommandScript
{

   fza175()
   {	
	SetIcon("rd1752");
	SetCursor("rd175");
	SetGroupID(75);
	SetGroupLeader(false);
	SetRestrictions(RESTRICT_SELFEXECUTE);
   }

   bool CheckGroupVisibility(GameObject *Caller)
   {
	int stat=fzstatus[75]&13; return stat>0 && stat<12;
   }

	bool CheckTarget(GameObject *Caller, Actor *Target, int ChildID)
	{
		return true;
	}

   void PushActions(GameObject *Caller, Actor *Target, int childID)
   {
	fzlocal::fza_look(Caller,75,Input::LCtrlPressed());
   }
};

object fza176 : CommandScript
{

   fza176()
   {	
	SetIcon("kripo");
	SetCursor("kripo");
	SetGroupID(76);
	SetGroupLeader(false);
	SetRestrictions(RESTRICT_SELFEXECUTE);
   }

   bool CheckGroupVisibility(GameObject *Caller)
   {
	int stat=fzstatus[76]&13; return stat>0 && stat<12;
   }

	bool CheckTarget(GameObject *Caller, Actor *Target, int ChildID)
	{
		return true;
	}

   void PushActions(GameObject *Caller, Actor *Target, int childID)
   {
	fzlocal::fza_look(Caller,76,Input::LCtrlPressed());
   }
};

object fza177 : CommandScript
{

   fza177()
   {	
	SetIcon("altenfeld");
	SetCursor("altenfeld");
	SetGroupID(77);
	SetGroupLeader(false);
	SetRestrictions(RESTRICT_SELFEXECUTE);
   }

   bool CheckGroupVisibility(GameObject *Caller)
   {
	int stat=fzstatus[77]&13; return stat>0 && stat<12;
   }

	bool CheckTarget(GameObject *Caller, Actor *Target, int ChildID)
	{
		return true;
	}

   void PushActions(GameObject *Caller, Actor *Target, int childID)
   {
	fzlocal::fza_look(Caller,77,Input::LCtrlPressed());
   }
};

object fza178 : CommandScript
{

   fza178()
   {	
	SetIcon("rufe_streife");
	SetCursor("rufe_streife");
	SetGroupID(78);
	SetGroupLeader(false);
	SetRestrictions(RESTRICT_SELFEXECUTE);
   }

   bool CheckGroupVisibility(GameObject *Caller)
   {
	int stat=fzstatus[78]&13; return stat>0 && stat<12;
   }

	bool CheckTarget(GameObject *Caller, Actor *Target, int ChildID)
	{
		return true;
	}

   void PushActions(GameObject *Caller, Actor *Target, int childID)
   {
	fzlocal::fza_look(Caller,78,Input::LCtrlPressed());
   }
};

object fza179 : CommandScript
{

   fza179()
   {	
	SetIcon("rufe_lf");
	SetCursor("rufe_lf");
	SetGroupID(79);
	SetGroupLeader(false);
	SetRestrictions(RESTRICT_SELFEXECUTE);
   }

   bool CheckGroupVisibility(GameObject *Caller)
   {
	int stat=fzstatus[79]&13; return stat>0 && stat<12;
   }

	bool CheckTarget(GameObject *Caller, Actor *Target, int ChildID)
	{
		return true;
	}

   void PushActions(GameObject *Caller, Actor *Target, int childID)
   {
	fzlocal::fza_look(Caller,79,Input::LCtrlPressed());
   }
};

object fza180 : CommandScript
{

   fza180()
   {	
	SetIcon("fluchtwagen");
	SetCursor("fluchtwagen");
	SetGroupID(80);
	SetGroupLeader(false);
	SetRestrictions(RESTRICT_SELFEXECUTE);
   }

   bool CheckGroupVisibility(GameObject *Caller)
   {
	int stat=fzstatus[80]&13; return stat>0 && stat<12;
   }

	bool CheckTarget(GameObject *Caller, Actor *Target, int ChildID)
	{
		return true;
	}

   void PushActions(GameObject *Caller, Actor *Target, int childID)
   {
	fzlocal::fza_look(Caller,80,Input::LCtrlPressed());
   }
};

object fza181 : CommandScript
{

   fza181()
   {	
	SetIcon("gwm");
	SetCursor("gwm");
	SetGroupID(81);
	SetGroupLeader(false);
	SetRestrictions(RESTRICT_SELFEXECUTE);
   }

   bool CheckGroupVisibility(GameObject *Caller)
   {
	int stat=fzstatus[81]&13; return stat>0 && stat<12;
   }

	bool CheckTarget(GameObject *Caller, Actor *Target, int ChildID)
	{
		return true;
	}

   void PushActions(GameObject *Caller, Actor *Target, int childID)
   {
	fzlocal::fza_look(Caller,81,Input::LCtrlPressed());
   }
};

object fza182 : CommandScript
{

   fza182()
   {	
	SetIcon("tel_el");
	SetCursor("tel_el");
	SetGroupID(82);
	SetGroupLeader(false);
	SetRestrictions(RESTRICT_SELFEXECUTE);
   }

   bool CheckGroupVisibility(GameObject *Caller)
   {
	int stat=fzstatus[82]&13; return stat>0 && stat<12;
   }

	bool CheckTarget(GameObject *Caller, Actor *Target, int ChildID)
	{
		return true;
	}

   void PushActions(GameObject *Caller, Actor *Target, int childID)
   {
	fzlocal::fza_look(Caller,82,Input::LCtrlPressed());
   }
};

object fza183 : CommandScript
{

   fza183()
   {	
	SetIcon("ith");
	SetCursor("ith");
	SetGroupID(83);
	SetGroupLeader(false);
	SetRestrictions(RESTRICT_SELFEXECUTE);
   }

   bool CheckGroupVisibility(GameObject *Caller)
   {
	int stat=fzstatus[83]&13; return stat>0 && stat<12;
   }

	bool CheckTarget(GameObject *Caller, Actor *Target, int ChildID)
	{
		return true;
	}

   void PushActions(GameObject *Caller, Actor *Target, int childID)
   {
	fzlocal::fza_look(Caller,83,Input::LCtrlPressed());
   }
};

object fza184 : CommandScript
{

   fza184()
   {	
	SetIcon("rd1842");
	SetCursor("rd184");
	SetGroupID(84);
	SetGroupLeader(false);
	SetRestrictions(RESTRICT_SELFEXECUTE);
   }

   bool CheckGroupVisibility(GameObject *Caller)
   {
	int stat=fzstatus[84]&13; return stat>0 && stat<12;
   }

	bool CheckTarget(GameObject *Caller, Actor *Target, int ChildID)
	{
		return true;
	}

   void PushActions(GameObject *Caller, Actor *Target, int childID)
   {
	fzlocal::fza_look(Caller,84,Input::LCtrlPressed());
   }
};

object fza185 : CommandScript
{

   fza185()
   {	
	SetIcon("rd1852");
	SetCursor("rd185");
	SetGroupID(85);
	SetGroupLeader(false);
	SetRestrictions(RESTRICT_SELFEXECUTE);
   }

   bool CheckGroupVisibility(GameObject *Caller)
   {
	int stat=fzstatus[85]&13; return stat>0 && stat<12;
   }

	bool CheckTarget(GameObject *Caller, Actor *Target, int ChildID)
	{
		return true;
	}

   void PushActions(GameObject *Caller, Actor *Target, int childID)
   {
	fzlocal::fza_look(Caller,85,Input::LCtrlPressed());
   }
};

object fza186 : CommandScript
{

   fza186()
   {	
	SetIcon("rd1862");
	SetCursor("rd186");
	SetGroupID(86);
	SetGroupLeader(false);
	SetRestrictions(RESTRICT_SELFEXECUTE);
   }

   bool CheckGroupVisibility(GameObject *Caller)
   {
	int stat=fzstatus[86]&13; return stat>0 && stat<12;
   }

	bool CheckTarget(GameObject *Caller, Actor *Target, int ChildID)
	{
		return true;
	}

   void PushActions(GameObject *Caller, Actor *Target, int childID)
   {
	fzlocal::fza_look(Caller,86,Input::LCtrlPressed());
   }
};

object fza187 : CommandScript
{

   fza187()
   {	
	SetIcon("rd1872");
	SetCursor("rd187");
	SetGroupID(87);
	SetGroupLeader(false);
	SetRestrictions(RESTRICT_SELFEXECUTE);
   }

   bool CheckGroupVisibility(GameObject *Caller)
   {
	int stat=fzstatus[87]&13; return stat>0 && stat<12;
   }

	bool CheckTarget(GameObject *Caller, Actor *Target, int ChildID)
	{
		return true;
	}

   void PushActions(GameObject *Caller, Actor *Target, int childID)
   {
	fzlocal::fza_look(Caller,87,Input::LCtrlPressed());
   }
};

object fza188 : CommandScript
{

   fza188()
   {	
	SetIcon("rd1882");
	SetCursor("rd188");
	SetGroupID(88);
	SetGroupLeader(false);
	SetRestrictions(RESTRICT_SELFEXECUTE);
   }

   bool CheckGroupVisibility(GameObject *Caller)
   {
	int stat=fzstatus[88]&13; return stat>0 && stat<12;
   }

	bool CheckTarget(GameObject *Caller, Actor *Target, int ChildID)
	{
		return true;
	}

   void PushActions(GameObject *Caller, Actor *Target, int childID)
   {
	fzlocal::fza_look(Caller,88,Input::LCtrlPressed());
   }
};

object fza189 : CommandScript
{

   fza189()
   {	
	SetIcon("rd1892");
	SetCursor("rd189");
	SetGroupID(89);
	SetGroupLeader(false);
	SetRestrictions(RESTRICT_SELFEXECUTE);
   }

   bool CheckGroupVisibility(GameObject *Caller)
   {
	int stat=fzstatus[89]&13; return stat>0 && stat<12;
   }

	bool CheckTarget(GameObject *Caller, Actor *Target, int ChildID)
	{
		return true;
	}

   void PushActions(GameObject *Caller, Actor *Target, int childID)
   {
	fzlocal::fza_look(Caller,89,Input::LCtrlPressed());
   }
};

object fza190 : CommandScript
{

   fza190()
   {	
	SetIcon("rd1902");
	SetCursor("rd190");
	SetGroupID(90);
	SetGroupLeader(false);
	SetRestrictions(RESTRICT_SELFEXECUTE);
   }

   bool CheckGroupVisibility(GameObject *Caller)
   {
	int stat=fzstatus[90]&13; return stat>0 && stat<12;
   }

	bool CheckTarget(GameObject *Caller, Actor *Target, int ChildID)
	{
		return true;
	}

   void PushActions(GameObject *Caller, Actor *Target, int childID)
   {
	fzlocal::fza_look(Caller,90,Input::LCtrlPressed());
   }
};

object fza191 : CommandScript
{

   fza191()
   {	
	SetIcon("rd1912");
	SetCursor("rd191");
	SetGroupID(91);
	SetGroupLeader(false);
	SetRestrictions(RESTRICT_SELFEXECUTE);
   }

   bool CheckGroupVisibility(GameObject *Caller)
   {
	int stat=fzstatus[91]&13; return stat>0 && stat<12;
   }

	bool CheckTarget(GameObject *Caller, Actor *Target, int ChildID)
	{
		return true;
	}

   void PushActions(GameObject *Caller, Actor *Target, int childID)
   {
	fzlocal::fza_look(Caller,91,Input::LCtrlPressed());
   }
};

object fza192 : CommandScript
{

   fza192()
   {	
	SetIcon("rd1922");
	SetCursor("rd192");
	SetGroupID(92);
	SetGroupLeader(false);
	SetRestrictions(RESTRICT_SELFEXECUTE);
   }

   bool CheckGroupVisibility(GameObject *Caller)
   {
	int stat=fzstatus[92]&13; return stat>0 && stat<12;
   }

	bool CheckTarget(GameObject *Caller, Actor *Target, int ChildID)
	{
		return true;
	}

   void PushActions(GameObject *Caller, Actor *Target, int childID)
   {
	fzlocal::fza_look(Caller,92,Input::LCtrlPressed());
   }
};

object fza193 : CommandScript
{

   fza193()
   {	
	SetIcon("rd1932");
	SetCursor("rd193");
	SetGroupID(93);
	SetGroupLeader(false);
	SetRestrictions(RESTRICT_SELFEXECUTE);
   }

   bool CheckGroupVisibility(GameObject *Caller)
   {
	int stat=fzstatus[93]&13; return stat>0 && stat<12;
   }

	bool CheckTarget(GameObject *Caller, Actor *Target, int ChildID)
	{
		return true;
	}

   void PushActions(GameObject *Caller, Actor *Target, int childID)
   {
	fzlocal::fza_look(Caller,93,Input::LCtrlPressed());
   }
};

object fza194 : CommandScript
{

   fza194()
   {	
	SetIcon("rd1942");
	SetCursor("rd194");
	SetGroupID(94);
	SetGroupLeader(false);
	SetRestrictions(RESTRICT_SELFEXECUTE);
   }

   bool CheckGroupVisibility(GameObject *Caller)
   {
	int stat=fzstatus[94]&13; return stat>0 && stat<12;
   }

	bool CheckTarget(GameObject *Caller, Actor *Target, int ChildID)
	{
		return true;
	}

   void PushActions(GameObject *Caller, Actor *Target, int childID)
   {
	fzlocal::fza_look(Caller,94,Input::LCtrlPressed());
   }
};

object fza195 : CommandScript
{

   fza195()
   {	
	SetIcon("retthund");
	SetCursor("retthund");
	SetGroupID(95);
	SetGroupLeader(false);
	SetRestrictions(RESTRICT_SELFEXECUTE);
   }

   bool CheckGroupVisibility(GameObject *Caller)
   {
	int stat=fzstatus[95]&13; return stat>0 && stat<12;
   }

	bool CheckTarget(GameObject *Caller, Actor *Target, int ChildID)
	{
		return true;
	}

   void PushActions(GameObject *Caller, Actor *Target, int childID)
   {
	fzlocal::fza_look(Caller,95,Input::LCtrlPressed());
   }
};

object fza196 : CommandScript
{

   fza196()
   {	
	SetIcon("rufe_bomber");
	SetCursor("rufe_bomber");
	SetGroupID(96);
	SetGroupLeader(false);
	SetRestrictions(RESTRICT_SELFEXECUTE);
   }

   bool CheckGroupVisibility(GameObject *Caller)
   {
	int stat=fzstatus[96]&13; return stat>0 && stat<12;
   }

	bool CheckTarget(GameObject *Caller, Actor *Target, int ChildID)
	{
		return true;
	}

   void PushActions(GameObject *Caller, Actor *Target, int childID)
   {
	fzlocal::fza_look(Caller,96,Input::LCtrlPressed());
   }
};

object fza197 : CommandScript
{

   fza197()
   {	
	SetIcon("rufe_bomber");
	SetCursor("rufe_bomber");
	SetGroupID(97);
	SetGroupLeader(false);
	SetRestrictions(RESTRICT_SELFEXECUTE);
   }

   bool CheckGroupVisibility(GameObject *Caller)
   {
	int stat=fzstatus[97]&13; return stat>0 && stat<12;
   }

	bool CheckTarget(GameObject *Caller, Actor *Target, int ChildID)
	{
		return true;
	}

   void PushActions(GameObject *Caller, Actor *Target, int childID)
   {
	fzlocal::fza_look(Caller,97,Input::LCtrlPressed());
   }
};

object fza198 : CommandScript
{

   fza198()
   {	
	SetIcon("rufe_dlk");
	SetCursor("rufe_dlk");
	SetGroupID(98);
	SetGroupLeader(false);
	SetRestrictions(RESTRICT_SELFEXECUTE);
   }

   bool CheckGroupVisibility(GameObject *Caller)
   {
	int stat=fzstatus[98]&13; return stat>0 && stat<12;
   }

	bool CheckTarget(GameObject *Caller, Actor *Target, int ChildID)
	{
		return true;
	}

   void PushActions(GameObject *Caller, Actor *Target, int childID)
   {
	fzlocal::fza_look(Caller,98,Input::LCtrlPressed());
   }
};

object fza199 : CommandScript
{

   fza199()
   {	
	SetIcon("simba");
	SetCursor("simba");
	SetGroupID(99);
	SetGroupLeader(false);
	SetRestrictions(RESTRICT_SELFEXECUTE);
   }

   bool CheckGroupVisibility(GameObject *Caller)
   {
	int stat=fzstatus[99]&13; return stat>0 && stat<12;
   }

	bool CheckTarget(GameObject *Caller, Actor *Target, int ChildID)
	{
		return true;
	}

   void PushActions(GameObject *Caller, Actor *Target, int childID)
   {
	fzlocal::fza_look(Caller,99,Input::LCtrlPressed());
   }
};

object fza200 : CommandScript
{

   fza200()
   {	
	SetIcon("rufe_lf");
	SetCursor("rufe_lf");
	SetGroupID(101);
	SetGroupLeader(false);
	SetRestrictions(RESTRICT_SELFEXECUTE);
   }

   bool CheckGroupVisibility(GameObject *Caller)
   {
	int stat=fzstatus[100]&13; return stat>0 && stat<12;
   }

	bool CheckTarget(GameObject *Caller, Actor *Target, int ChildID)
	{
		return true;
	}

   void PushActions(GameObject *Caller, Actor *Target, int childID)
   {
	fzlocal::fza_look(Caller,100,Input::LCtrlPressed());
   }
};

object fza201 : CommandScript
{

   fza201()
   {	
	SetIcon("superdoc");
	SetCursor("superdoc");
	SetGroupID(102);
	SetGroupLeader(false);
	SetRestrictions(RESTRICT_SELFEXECUTE);
   }

   bool CheckGroupVisibility(GameObject *Caller)
   {
	int stat=fzstatus[101]&13; return stat>0 && stat<12;
   }

	bool CheckTarget(GameObject *Caller, Actor *Target, int ChildID)
	{
		return true;
	}

   void PushActions(GameObject *Caller, Actor *Target, int childID)
   {
	fzlocal::fza_look(Caller,101,Input::LCtrlPressed());
   }
};

object fza202 : CommandScript
{

   fza202()
   {	
	SetIcon("rufe_streife");
	SetCursor("rufe_streife");
	SetGroupID(103);
	SetGroupLeader(false);
	SetRestrictions(RESTRICT_SELFEXECUTE);
   }

   bool CheckGroupVisibility(GameObject *Caller)
   {
	int stat=fzstatus[102]&13; return stat>0 && stat<12;
   }

	bool CheckTarget(GameObject *Caller, Actor *Target, int ChildID)
	{
		return true;
	}

   void PushActions(GameObject *Caller, Actor *Target, int childID)
   {
	fzlocal::fza_look(Caller,102,Input::LCtrlPressed());
   }
};

object fza203 : CommandScript
{

   fza203()
   {	
	SetIcon("rufe_lf");
	SetCursor("rufe_lf");
	SetGroupID(104);
	SetGroupLeader(false);
	SetRestrictions(RESTRICT_SELFEXECUTE);
   }

   bool CheckGroupVisibility(GameObject *Caller)
   {
	int stat=fzstatus[103]&13; return stat>0 && stat<12;
   }

	bool CheckTarget(GameObject *Caller, Actor *Target, int ChildID)
	{
		return true;
	}

   void PushActions(GameObject *Caller, Actor *Target, int childID)
   {
	fzlocal::fza_look(Caller,103,Input::LCtrlPressed());
   }
};

object fza204 : CommandScript
{

   fza204()
   {	
	SetIcon("fluchtwagen");
	SetCursor("fluchtwagen");
	SetGroupID(105);
	SetGroupLeader(false);
	SetRestrictions(RESTRICT_SELFEXECUTE);
   }

   bool CheckGroupVisibility(GameObject *Caller)
   {
	int stat=fzstatus[104]&13; return stat>0 && stat<12;
   }

	bool CheckTarget(GameObject *Caller, Actor *Target, int ChildID)
	{
		return true;
	}

   void PushActions(GameObject *Caller, Actor *Target, int childID)
   {
	fzlocal::fza_look(Caller,104,Input::LCtrlPressed());
   }
};

object fza205 : CommandScript
{

   fza205()
   {	
	SetIcon("rd2052");
	SetCursor("rd205");
	SetGroupID(106);
	SetGroupLeader(false);
	SetRestrictions(RESTRICT_SELFEXECUTE);
   }

   bool CheckGroupVisibility(GameObject *Caller)
   {
	int stat=fzstatus[105]&13; return stat>0 && stat<12;
   }

	bool CheckTarget(GameObject *Caller, Actor *Target, int ChildID)
	{
		return true;
	}

   void PushActions(GameObject *Caller, Actor *Target, int childID)
   {
	fzlocal::fza_look(Caller,105,Input::LCtrlPressed());
   }
};

object fza206 : CommandScript
{

   fza206()
   {	
	SetIcon("rufe_streife");
	SetCursor("rufe_streife");
	SetGroupID(107);
	SetGroupLeader(false);
	SetRestrictions(RESTRICT_SELFEXECUTE);
   }

   bool CheckGroupVisibility(GameObject *Caller)
   {
	int stat=fzstatus[106]&13; return stat>0 && stat<12;
   }

	bool CheckTarget(GameObject *Caller, Actor *Target, int ChildID)
	{
		return true;
	}

   void PushActions(GameObject *Caller, Actor *Target, int childID)
   {
	fzlocal::fza_look(Caller,106,Input::LCtrlPressed());
   }
};

object fza207 : CommandScript
{

   fza207()
   {	
	SetIcon("rufe_streife");
	SetCursor("rufe_streife");
	SetGroupID(108);
	SetGroupLeader(false);
	SetRestrictions(RESTRICT_SELFEXECUTE);
   }

   bool CheckGroupVisibility(GameObject *Caller)
   {
	int stat=fzstatus[107]&13; return stat>0 && stat<12;
   }

	bool CheckTarget(GameObject *Caller, Actor *Target, int ChildID)
	{
		return true;
	}

   void PushActions(GameObject *Caller, Actor *Target, int childID)
   {
	fzlocal::fza_look(Caller,107,Input::LCtrlPressed());
   }
};

object fza208 : CommandScript
{

   fza208()
   {	
	SetIcon("rd2082");
	SetCursor("rd208");
	SetGroupID(109);
	SetGroupLeader(false);
	SetRestrictions(RESTRICT_SELFEXECUTE);
   }

   bool CheckGroupVisibility(GameObject *Caller)
   {
	int stat=fzstatus[108]&13; return stat>0 && stat<12;
   }

	bool CheckTarget(GameObject *Caller, Actor *Target, int ChildID)
	{
		return true;
	}

   void PushActions(GameObject *Caller, Actor *Target, int childID)
   {
	fzlocal::fza_look(Caller,108,Input::LCtrlPressed());
   }
};

object fza209 : CommandScript
{

   fza209()
   {	
	SetIcon("feldj");
	SetCursor("feldj");
	SetGroupID(110);
	SetGroupLeader(false);
	SetRestrictions(RESTRICT_SELFEXECUTE);
   }

   bool CheckGroupVisibility(GameObject *Caller)
   {
	int stat=fzstatus[109]&13; return stat>0 && stat<12;
   }

	bool CheckTarget(GameObject *Caller, Actor *Target, int ChildID)
	{
		return true;
	}

   void PushActions(GameObject *Caller, Actor *Target, int childID)
   {
	fzlocal::fza_look(Caller,109,Input::LCtrlPressed());
   }
};

object fza210 : CommandScript
{

   fza210()
   {	
	SetIcon("rufe_lf");
	SetCursor("rufe_lf");
	SetGroupID(111);
	SetGroupLeader(false);
	SetRestrictions(RESTRICT_SELFEXECUTE);
   }

   bool CheckGroupVisibility(GameObject *Caller)
   {
	int stat=fzstatus[110]&13; return stat>0 && stat<12;
   }

	bool CheckTarget(GameObject *Caller, Actor *Target, int ChildID)
	{
		return true;
	}

   void PushActions(GameObject *Caller, Actor *Target, int childID)
   {
	fzlocal::fza_look(Caller,110,Input::LCtrlPressed());
   }
};

object fza211 : CommandScript
{

   fza211()
   {	
	SetIcon("rufe_mtw");
	SetCursor("rufe_mtw");
	SetGroupID(112);
	SetGroupLeader(false);
	SetRestrictions(RESTRICT_SELFEXECUTE);
   }

   bool CheckGroupVisibility(GameObject *Caller)
   {
	int stat=fzstatus[111]&13; return stat>0 && stat<12;
   }

	bool CheckTarget(GameObject *Caller, Actor *Target, int ChildID)
	{
		return true;
	}

   void PushActions(GameObject *Caller, Actor *Target, int childID)
   {
	fzlocal::fza_look(Caller,111,Input::LCtrlPressed());
   }
};

object fza212 : CommandScript
{

   fza212()
   {	
	SetIcon("rufe_lf");
	SetCursor("rufe_lf");
	SetGroupID(113);
	SetGroupLeader(false);
	SetRestrictions(RESTRICT_SELFEXECUTE);
   }

   bool CheckGroupVisibility(GameObject *Caller)
   {
	int stat=fzstatus[112]&13; return stat>0 && stat<12;
   }

	bool CheckTarget(GameObject *Caller, Actor *Target, int ChildID)
	{
		return true;
	}

   void PushActions(GameObject *Caller, Actor *Target, int childID)
   {
	fzlocal::fza_look(Caller,112,Input::LCtrlPressed());
   }
};

object fza213 : CommandScript
{

   fza213()
   {	
	SetIcon("kripo");
	SetCursor("kripo");
	SetGroupID(114);
	SetGroupLeader(false);
	SetRestrictions(RESTRICT_SELFEXECUTE);
   }

   bool CheckGroupVisibility(GameObject *Caller)
   {
	int stat=fzstatus[113]&13; return stat>0 && stat<12;
   }

	bool CheckTarget(GameObject *Caller, Actor *Target, int ChildID)
	{
		return true;
	}

   void PushActions(GameObject *Caller, Actor *Target, int childID)
   {
	fzlocal::fza_look(Caller,113,Input::LCtrlPressed());
   }
};

object fza214 : CommandScript
{

   fza214()
   {	
	SetIcon("kripo");
	SetCursor("kripo");
	SetGroupID(115);
	SetGroupLeader(false);
	SetRestrictions(RESTRICT_SELFEXECUTE);
   }

   bool CheckGroupVisibility(GameObject *Caller)
   {
	int stat=fzstatus[114]&13; return stat>0 && stat<12;
   }

	bool CheckTarget(GameObject *Caller, Actor *Target, int ChildID)
	{
		return true;
	}

   void PushActions(GameObject *Caller, Actor *Target, int childID)
   {
	fzlocal::fza_look(Caller,114,Input::LCtrlPressed());
   }
};

object fza215 : CommandScript
{

   fza215()
   {	
	SetIcon("kripo");
	SetCursor("kripo");
	SetGroupID(116);
	SetGroupLeader(false);
	SetRestrictions(RESTRICT_SELFEXECUTE);
   }

   bool CheckGroupVisibility(GameObject *Caller)
   {
	int stat=fzstatus[115]&13; return stat>0 && stat<12;
   }

	bool CheckTarget(GameObject *Caller, Actor *Target, int ChildID)
	{
		return true;
	}

   void PushActions(GameObject *Caller, Actor *Target, int childID)
   {
	fzlocal::fza_look(Caller,115,Input::LCtrlPressed());
   }
};

object fza216 : CommandScript
{

   fza216()
   {	
	SetIcon("dlrg");
	SetCursor("dlrg");
	SetGroupID(117);
	SetGroupLeader(false);
	SetRestrictions(RESTRICT_SELFEXECUTE);
   }

   bool CheckGroupVisibility(GameObject *Caller)
   {
	int stat=fzstatus[116]&13; return stat>0 && stat<12;
   }

	bool CheckTarget(GameObject *Caller, Actor *Target, int ChildID)
	{
		return true;
	}

   void PushActions(GameObject *Caller, Actor *Target, int childID)
   {
	fzlocal::fza_look(Caller,116,Input::LCtrlPressed());
   }
};
